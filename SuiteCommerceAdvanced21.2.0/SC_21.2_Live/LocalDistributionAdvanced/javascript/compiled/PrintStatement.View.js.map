{"version":3,"sources":["PrintStatement.View.ts"],"names":[],"mappings":"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","file":"PrintStatement.View.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"PrintStatement.View\"/>\n\nimport '../../../Commons/Backbone.FormView/JavaScript/Backbone.FormView';\nimport '../../../Commons/jQueryExtras/JavaScript/jQuery.serializeObject';\nimport * as print_statement_tpl from 'print_statement.tpl';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\nimport { Configuration } from '../../SCA/JavaScript/Configuration';\n\nimport BackboneView = require('../../../Commons/BackboneExtras/JavaScript/Backbone.View');\nimport PrintStatementModel = require('./PrintStatement.Model');\nimport Backbone = require('../../../Commons/Utilities/JavaScript/backbone.custom');\n\n// @class PrintStatement.View @extends BackboneView\nconst PrintStatementView: any = BackboneView.extend({\n    // @property {Function} template\n    template: print_statement_tpl,\n\n    // @property {String} title\n    title: Utils.translate('Print a Statement'),\n\n    // @property {String} page_header\n    page_header: Utils.translate('Print a Statement'),\n\n    // @property {Object} attributes\n    attributes: {\n        id: 'PrintStatement',\n        class: 'PrintStatement'\n    },\n\n    // @property {Object} events\n    events: {\n        'submit form': 'printAction',\n        'click [data-action=\"email\"]': 'emailAction',\n        'click i.print-statement-form-input-icon': 'imgPickerAction'\n    },\n\n    // @method initialize\n    initialize: function(options) {\n        this.application = options.application;\n        this.model = options.model || new PrintStatementModel();\n\n        Backbone.Validation.bind(this);\n    },\n\n    beforeShowContent: function beforeShowContent() {\n        const promise = jQuery.Deferred();\n\n        if (SC.ENVIRONMENT.permissions.transactions.tranStatement === 2) {\n            promise.resolve();\n        } else {\n            promise.reject();\n            this.application.getLayout().forbiddenError();\n        }\n\n        return promise;\n    },\n\n    // @method getSelectedMenu\n    getSelectedMenu: function(): string {\n        return 'printstatement';\n    },\n    // @method getBreadcrumbPages\n    getBreadcrumbPages: function() {\n        return {\n            text: Utils.translate('Print Statement'),\n            href: '/printstatement'\n        };\n    },\n    // @method printAction\n    printAction: function(e) {\n        this.printStatement(e, false);\n    },\n    // @method emailAction\n    emailAction: function(e) {\n        const self = this;\n\n        this.printStatement(e, true, function(response) {\n            jQuery.ajax(response.url).done(function() {\n                self.showError(Utils.translate('Email sent successfully'), 'success');\n            });\n        });\n    },\n    // @method imgPickerAction\n    imgPickerAction: function(e) {\n        (<any>jQuery(e.target)\n            .parent()\n            .find('input')).datepicker('show');\n    },\n    // @method printStatement\n    printStatement: function(e, email, callback) {\n        e.preventDefault();\n        this.hideError();\n\n        this.model.set('statementDate', this.$('[name=\"statementDate\"]').val());\n        this.model.set('startDate', this.$('[name=\"startDate\"]').val());\n\n        if (this.model.isValid(true)) {\n            const data = (<any>jQuery(e.target).closest('form')).serializeObject();\n            const statementDate = new Date(data.statementDate.replace(/-/g, '/')).getTime();\n            const startDate = new Date(data.startDate.replace(/-/g, '/')).getTime();\n\n            data.email = email ? true : null;\n\n            if (!((data.startDate && isNaN(startDate)) || isNaN(statementDate))) {\n                data.statementDate = statementDate;\n\n                if (data.startDate) {\n                    data.startDate = startDate;\n                }\n\n                if (email) {\n                    const save_promise = this.saveForm(e, this.model, data);\n                    save_promise && save_promise.done(callback);\n                } else {\n                    data.asset = 'print-statement';\n                    window.open(Utils.getDownloadPdfUrl(data));\n                }\n            }\n        }\n    },\n    // @method getContext @returns PrintStatement.View.Context\n    getContext: function() {\n        // @class PrintStatement.View.Context\n        return {\n            // @property {String} pageHeader\n            pageHeader: this.page_header,\n            // @property {Boolean} showBackToAccount\n            showBackToAccount: Configuration.get('siteSettings.sitetype') === 'STANDARD'\n        };\n    }\n});\n\nexport = PrintStatementView;\n"]}
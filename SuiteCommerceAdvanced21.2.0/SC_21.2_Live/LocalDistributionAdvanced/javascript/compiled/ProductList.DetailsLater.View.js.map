{"version":3,"sources":["ProductList.DetailsLater.View.ts"],"names":[],"mappings":"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","file":"ProductList.DetailsLater.View.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"ProductList.DetailsLater.View\"/>\n\nimport '../../../Commons/BackboneExtras/JavaScript/Backbone.View.render';\n\nimport * as product_list_details_later_tpl from 'product_list_details_later.tpl';\nimport * as products_detail_later_cell_tpl from 'products_detail_later_cell.tpl';\nimport * as backbone_collection_view_row_tpl from 'backbone_collection_view_row.tpl';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\nimport { ProfileModel } from '../../../Commons/Profile/JavaScript/Profile.Model';\n\nimport ProductListDetailsLaterMacroView = require('./ProductList.DetailsLaterMacro.View');\nimport ProductListDetailsView = require('./ProductList.Details.View');\nimport ProductListDeletionView = require('./ProductList.Deletion.View');\nimport BackboneCollectionView = require('../../../Commons/Backbone.CollectionView/JavaScript/Backbone.CollectionView');\nimport LiveOrderModel = require('../../../Commons/LiveOrder/JavaScript/LiveOrder.Model');\nimport BackboneView = require('../../../Commons/BackboneExtras/JavaScript/Backbone.View');\n\nlet product_list_promise;\n\n// @class ProductList.DetailsLater.View @extends Backbone.View\nexport = BackboneView.extend({\n    template: product_list_details_later_tpl,\n\n    events: {\n        // items events\n        'click [data-action=\"add-to-cart\"]': 'addItemToCartHandler',\n        'click [data-action=\"delete-item\"]': 'askDeleteListItem',\n        'change [data-action=\"change-quantity\"]': 'updateItemQuantity',\n        'keyup [data-action=\"change-quantity\"]': 'updateItemQuantity',\n        'click [data-ui-action=\"add\"]': 'addQuantity',\n        'click [data-ui-action=\"minus\"]': 'subQuantity'\n    },\n\n    initialize: function(options) {\n        this.options = options;\n        this.application = options.application;\n        this.cart = LiveOrderModel.getInstance();\n\n        this.model.on('change', this.render, this);\n\n        this.model.get('items').on('add remove change reset', this.render, this);\n\n        this.promise = this.loadProductList();\n    },\n\n    render: function() {\n        if (ProfileModel.getInstance().get('isLoggedIn') === 'T') {\n            this._render();\n            const pushable = this.$el.find('[data-action=\"pushable\"]');\n            pushable.scPush({\n                selector: this.$el.find(\n                    `[data-type=\"sc-pusher\"][data-target=\"${pushable.data('id')}\"]`\n                )\n            });\n        } else {\n            this.$el.empty();\n        }\n\n        return this;\n    },\n\n    loadProductList: function() {\n        const self = this;\n\n        if (!product_list_promise) {\n            ProfileModel.getPromise().done(function() {\n                if (ProfileModel.getInstance().get('isLoggedIn') === 'T') {\n                    const ProductListUtils = self.options.application.ProductListModule.Utils;\n                    product_list_promise = ProductListUtils.getSavedForLaterProductList();\n                    product_list_promise.done(function(attributes) {\n                            self.model.set(attributes);\n                    });\n                        }\n            });\n        }\n\n        return product_list_promise;\n    },\n\n    // @method addItemToCartHandler Add a particular item into the cart\n    addItemToCartHandler: function(e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        const selected_product_list_item_id = this.$(e.target)\n            .closest('article')\n            .data('id');\n        const selected_product_list_item = this.model\n            .get('items')\n            .get(selected_product_list_item_id);\n        const add_to_cart_promise = this.cart.addLine(selected_product_list_item);\n        const whole_promise = jQuery.when(\n            add_to_cart_promise,\n            this.deleteListItem(selected_product_list_item)\n        );\n\n        this.disableElementsOnPromise(\n            whole_promise,\n            this.$(e.target)\n                .closest('article')\n                .find('button')\n        );\n    },\n\n    // @method addQuantity Increase the product's Quantity by 1\n    // @param {HTMLEvent} e\n    addQuantity: function(e) {\n        e.preventDefault();\n\n        const $element = jQuery(e.target);\n        const oldValue = $element\n            .parent()\n            .find('input')\n            .val();\n        const newVal = parseFloat(<any>oldValue) + 1;\n\n        const input = $element.parent().find('input');\n\n        input.val(newVal);\n        input.trigger('change');\n    },\n\n    // @method subQuantity Decreases the product's Quantity by 1\n    // @param {HTMLEvent} e\n    subQuantity: function(e) {\n        e.preventDefault();\n\n        const $element = jQuery(e.target);\n        const oldValue = $element\n            .parent()\n            .find('input')\n            .val();\n        let newVal = parseFloat(<any>oldValue) - 1;\n\n        newVal = Math.max(1, newVal);\n\n        const input = $element.parent().find('input');\n\n        input.val(newVal);\n        input.trigger('change');\n    },\n\n    // @method askDeleteListItem opens a confirmation dialog for deleting an item from the\n    // Saved for Later list.\n    // @param {HTMLEvent} e\n    askDeleteListItem: function(e) {\n        e.stopPropagation();\n\n        this.deleteConfirmationView = new ProductListDeletionView({\n            application: this.application,\n            parentView: this,\n            target: e.target,\n            title: Utils.translate('Delete selected items'),\n            body: Utils.translate('Are you sure you want to remove selected items?'),\n            confirmLabel: Utils.translate('Yes'),\n            confirm_delete_method: 'deleteListItemHandler'\n        });\n\n        this.deleteConfirmationView.showInModal();\n    },\n\n    // @method deleteListItemHandler deletes a single item from the Saved for Later list.\n    // @param {HTMLEvent} e\n    deleteListItemHandler: function(target) {\n        const self = this;\n        const itemid = jQuery(target)\n            .closest('article')\n            .data('id');\n        const product_list_item = this.model.get('items').findWhere({\n            internalid: `${itemid}`\n        });\n        const success = function() {\n            self.deleteConfirmationView.$containerModal\n                .removeClass('fade')\n                .modal('hide')\n                .data('bs.modal', null);\n            self.render();\n            self.showConfirmationMessage(\n                Utils.translate('The item was removed from your product list'),\n                true\n            );\n        };\n\n        self.model.get('items').remove(product_list_item);\n        self.deleteListItem(product_list_item, success);\n    },\n\n    deleteListItem: ProductListDetailsView.prototype.deleteListItem,\n\n    disableElementsOnPromise: ProductListDetailsView.prototype.disableElementsOnPromise,\n\n    updateItemQuantity: ProductListDetailsView.prototype.updateItemQuantity,\n\n    updateItemQuantityHelper: ProductListDetailsView.prototype.updateItemQuantityHelper,\n\n    childViews: {\n        'ProductList.DetailsLater.Collection': function() {\n            return new BackboneCollectionView({\n                collection: this.model.get('items'),\n                childView: ProductListDetailsLaterMacroView,\n                viewsPerRow: 4,\n                cellTemplate: products_detail_later_cell_tpl,\n                rowTemplate: backbone_collection_view_row_tpl,\n                childViewOptions: {\n                    application: this.application\n                }\n            });\n        }\n    },\n\n    // @method getContext @return {ProductList.DetailsLater.View.Context}\n    getContext: function() {\n        const items = this.model.get('items');\n        const itemsLength = items.length;\n        // @class ProductList.DetailsLater.View.Context\n        return {\n            // @property {Integer} itemsLength\n            itemsLength: itemsLength,\n            // @property {Boolean} hasItems\n            hasItems: itemsLength > 0,\n            // @property {Boolean} isEmpty\n            isEmpty: itemsLength === 0,\n            // @property {Boolean} hasMoreThanOneItem\n            hasMoreThanOneItem: itemsLength > 1\n        };\n    }\n});\n"]}
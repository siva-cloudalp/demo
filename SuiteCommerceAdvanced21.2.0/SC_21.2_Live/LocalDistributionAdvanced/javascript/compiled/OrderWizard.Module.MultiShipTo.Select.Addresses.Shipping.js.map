{"version":3,"sources":["OrderWizard.Module.MultiShipTo.Select.Addresses.Shipping.ts"],"names":[],"mappings":"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","file":"OrderWizard.Module.MultiShipTo.Select.Addresses.Shipping.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"OrderWizard.Module.MultiShipTo.Select.Addresses.Shipping\"/>\n/// <reference path=\"../../../Commons/Utilities/JavaScript/UnderscoreExtended.d.ts\" />\n\nimport * as _ from 'underscore';\nimport * as order_wizard_msr_addresses_module_tpl from 'order_wizard_msr_addresses_module.tpl';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\n\nimport OrderWizardModuleAddress = require('./OrderWizard.Module.Address');\n\n// @class OrderWizard.Module.Address @extend Wizard.Module\nconst OrderWizardModuleMultiShipToSelectAddressesShipping: any = OrderWizardModuleAddress.extend({\n    // @property {Function} template\n    template: order_wizard_msr_addresses_module_tpl,\n\n    // @property {String} manage Defines the address being edited by the current view\n    manage: 'shipaddress',\n\n    // @property {String} sameAsManage\n    sameAsManage: 'billaddress',\n\n    // @property {Boolean} isSameAsEnabled\n    isSameAsEnabled: false,\n\n    // @property {Object<errorMessage:String,errorCode:String>} atLeastTwoValidAddressesErrorMessage\n    atLeastTwoValidAddressesErrorMessage: {\n        errorMessage: Utils.translate('You need at least 2 valid shipping addresses'),\n        errorCode: 'ERR_MST_MIN_ADDRESSES'\n    },\n\n    // @property {Array<String>} errors List of errors being handle by this module\n    errors: [\n        'ERR_CHK_INCOMPLETE_ADDRESS',\n        'ERR_CHK_INVALID_ADDRESS',\n        'NOT_ERR_SAVE_ADDR',\n        'ERR_MST_MIN_ADDRESSES'\n    ],\n\n    // @property {Object<errorCode:String>} saveAddressFakeErrorMessage\n    saveAddressFakeErrorMessage: {\n        errorCode: 'NOT_ERR_SAVE_ADDR'\n    },\n\n    // @property {Object} newEvents List of event to add to the base class\n    newEvents: {\n        'click [data-action=\"add-edit-addreses-link\"]': 'showAllAddresses'\n    },\n\n    // @method initialize  We override this method in order to mark\n    // as checked each address that is already checked from back-end\n    initialize: function() {\n        _.extend(this.events, this.newEvents);\n        _.extend(this.childViews, this.extraChildViews);\n        OrderWizardModuleAddress.prototype.initialize.apply(this, arguments);\n\n        const self = this;\n        this.wizard.is_editing_addresses = false;\n\n        this.addresses = this.wizard.options.profile.get('addresses');\n\n        // When by options is specified that when there are enough valid\n        // addresses only show a link, this flag control if render addresses or not\n        self.hide_addresses = true;\n\n        self.showSaveButton = self.options.showSaveButton;\n\n        self.wizard.model.on('ismultishiptoUpdated', this.render, this);\n\n        this.addresses.once('reset', function() {\n            self.hide_addresses = self.hasEnoughValidAddresses();\n        });\n\n        this.addresses.on('destroy remove', function(model) {\n            _.each(self.wizard.model.get('lines').where({ shipaddress: model.id }), function(\n                line: any\n            ) {\n                line.unset('shipaddress');\n                line.unset('shipmethod');\n            });\n        });\n\n        self.atLeastTwoValidAddressesErrorMessage.errorMessage = Utils.translate(\n            'You need at least $(0) valid shipping addresses',\n            this.minValidAddressesQuantity\n        );\n        this.wizard.model.on('ismultishiptoUpdated', _.bind(this.render, this));\n    },\n\n    // As we always want to render the complete list of addresses we never set one address\n    setAddress: jQuery.noop,\n\n    // @property {Number} minValidAddressesQuantity\n    minValidAddressesQuantity: 1,\n\n    // @property {Number} minSkipAddressesQuantity\n    minSkipAddressesQuantity: 2,\n\n    // @method getIsCurrentUserGuest In the case of Multi Ship To we need to return false to support adding multiple addresses with a inline form without generating duplicated values\n    // IF guest user are not supported in Multi Ship To, this should be controlled in the OrderWizard.Module.MultiShipto.EnableLink.js\n    // @return {Boolean}\n    getIsCurrentUserGuest: function() {\n        return false;\n    },\n\n    // @method newAddressCreated When there is no address created at all, and a new one is made this method is called by super with the id if the new address created\n    newAddressCreated: function(id, add_options) {\n        this.trigger('change_enable_continue', true);\n        if (!add_options || add_options.silent) {\n            // This occur on guest or when the first address is created (no previous address exists)\n            // This event is fire in order to update/notify the MST.Addresses.Packages Module to re-render itself\n            // and Address.Billing to show the new addresses created\n            this.wizard.model.trigger('address_added');\n        }\n    },\n\n    // @method showAllAddresses In OPC expand all this module in case it's collapsed in one link\n    showAllAddresses: function(e) {\n        e.preventDefault();\n        this.hide_addresses = false;\n        this.render();\n    },\n\n    // @method isActive Indicate if the current module need to be shown or not.\n    // @return {Boolean}\n    isActive: function() {\n        if (~window.location.hash.indexOf(this.options.edit_addresses_url)) {\n            this.showModule = true;\n        }\n\n        return (\n            this.wizard.isMultiShipTo() &&\n            (this.showModule ||\n                (this.wizard.model.shippingAddressIsRequired() && !this.hasEnoughtSkipAddresses()))\n        );\n    },\n\n    render: function() {\n        if (this.isActive()) {\n            jQuery('.wizard-content .alert-error').hide();\n            return OrderWizardModuleAddress.prototype.render.apply(this, arguments);\n        }\n\n        this.$el.empty();\n\n        if (!this.isMultShipToAddressListMandatory) {\n            this.trigger('change_visible_back', false);\n        }\n        if (this.wizard.is_editing_addresses) {\n            this.wizard.is_editing_addresses = false;\n        }\n    },\n\n    // @method submit Save the current model\n    // @return {jQuery.Deferred}\n    submit: function() {\n        jQuery('.wizard-content .alert-error').hide();\n\n        this.$('.multishipto-save-address-btn').attr('disabled', true);\n\n        const super_result = OrderWizardModuleAddress.prototype.submit.apply(this, arguments);\n        const self = this;\n        const result = jQuery.Deferred();\n\n        super_result.always(function() {\n            self.$('.multishipto-save-address-btn').attr('disabled', false);\n        });\n\n        if (this.addressView) {\n            super_result.then(function() {\n                result.reject(self.saveAddressFakeErrorMessage);\n            }, result.reject);\n\n            return result;\n        }\n\n        return super_result;\n    },\n\n    // @method getValidAddreses Returns the list of valid addresses\n    // @return {Address.Model}\n    getValidAddreses: function() {\n        return this.addresses.where({ isvalid: 'T' });\n    },\n\n    // @method hasEnoughtSkipAddresses Determines if the quantity of valid addresses is enough to skip this module, used by the proxy to not show this step\n    // @return {Boolean}\n    hasEnoughtSkipAddresses: function() {\n        return this.getValidAddreses().length >= this.minSkipAddressesQuantity;\n    },\n\n    // @method hasEnoughValidAddresses Determines if the quantity of valid addresses is enough to validate this module\n    hasEnoughValidAddresses: function() {\n        return this.getValidAddreses().length >= this.minValidAddressesQuantity;\n    },\n\n    // @method isValid This module will be valid only if MSR is NOT enable OR at least one address is valid and selected\n    // @return {jQuery.Deferred}\n    isValid: function() {\n        if (!this.wizard.model.get('ismultishipto') || this.hasEnoughValidAddresses()) {\n            return jQuery.Deferred().resolve();\n        }\n\n        return jQuery.Deferred().reject(this.atLeastTwoValidAddressesErrorMessage);\n    },\n\n    // @method manageError Handle the fake error throw by the Save method\n    manageError: function(error) {\n        if (error && error.errorCode !== 'NOT_ERR_SAVE_ADDR') {\n            OrderWizardModuleAddress.prototype.manageError.apply(this, arguments);\n        }\n    },\n\n    // @method getAddressListOptions Get the object containing the options to be passed to the Address.Details view when rendering the list of available addresses\n    // @return {showSelect:Boolean,showMultiSelect:Boolean,selectMessage:String,hideDefaults:Boolean,showError:Boolean}\n    getAddressListOptions: function() {\n        return {\n            showSelect: false,\n            showMultiSelect: false,\n            selectMessage: this.selectMessage || '',\n            hideDefaults: true,\n            showError: true,\n            hideSelector: true\n        };\n    },\n\n    // @method getContext\n    // @return {OrderWizard.Module.MultiShipTo.Select.Addresses.Shipping.Context}\n    getContext: function() {\n        const has_enough_valid_addresses = this.hasEnoughValidAddresses();\n\n        // @class OrderWizard.Module.MultiShipTo.Select.Addresses.Shipping\n        return {\n            // @property {Boolean} showTitle\n            showTitle: !!(!this.options.hide_title && this.getTitle()),\n            // @property {Stirng} title\n            title: this.getTitle(),\n            // @property {Boolean} showCollapsedView\n            showCollapsedView: !!(\n                this.options.hide_if_valid_addresses &&\n                has_enough_valid_addresses &&\n                this.hide_addresses\n            ),\n            // @property {Boolean} isAddressListLengthGreaterThan0\n            isAddressListLengthGreaterThan0: this.getAddressesToShow().length > 0,\n            // @property {Boolean} showManageValue\n            showManageValue: !!this.manage,\n            // @property {String} manageValue\n            manageValue: this.manage,\n            // @property {Boolean} hasEnoughValidAddresses\n            hasEnoughValidAddresses: has_enough_valid_addresses,\n            // @property {Boolean} showSaveButton\n            showSaveButton: this.showSaveButton\n        };\n        // @class OrderWizard.Module.MultiShipTo.Select.Addresses.Shipping\n    }\n});\n\nexport = OrderWizardModuleMultiShipToSelectAddressesShipping;\n"]}
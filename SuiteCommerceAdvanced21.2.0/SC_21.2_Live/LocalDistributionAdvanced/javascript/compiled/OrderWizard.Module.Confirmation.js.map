{"version":3,"sources":["OrderWizard.Module.Confirmation.ts"],"names":[],"mappings":"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","file":"OrderWizard.Module.Confirmation.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"OrderWizard.Module.Confirmation\"/>\n\nimport * as order_wizard_confirmation_module_tpl from 'order_wizard_confirmation_module.tpl';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport { Configuration } from '../../SCA/JavaScript/Configuration';\nimport { WizardStepModule } from '../../Wizard/JavaScript/Wizard.StepModule';\n\nimport Tracker = require('../../../Commons/Tracker/JavaScript/Tracker');\nimport Backbone = require('../../../Commons/Utilities/JavaScript/backbone.custom');\n\n// @class OrderWizard.Module.Confirmation @extends Wizard.Module\nexport = WizardStepModule.extend({\n    template: order_wizard_confirmation_module_tpl,\n\n    className: 'OrderWizard.Module.Confirmation',\n\n    enhancedEcommercePage: true,\n\n    render: function() {\n        const confirmation = this.model.get('confirmation');\n        // store current order id in the hash so it is available even when the checkout process ends.\n        let new_hash;\n\n        if (!Utils.parseUrlOptions(Backbone.history.fragment).last_order_id) {\n            this.trackTransaction(confirmation);\n\n            new_hash = Utils.addParamsToUrl(Backbone.history.fragment, {\n                last_order_id: confirmation.get('internalid')\n            });\n\n            Backbone.history.navigate(new_hash, {\n                trigger: false\n            });\n        }\n\n        this.confirmation_number =\n            confirmation.get('tranid') || confirmation.get('confirmationnumber');\n        this.order_id = confirmation.get('internalid');\n\n        this._render();\n\n        if (!(this.model.get('confirmation') && this.model.get('confirmation').get('internalid'))) {\n            this.$el.html('<h3>' + Utils.translate('Your Order has been placed') + '</h3>');\n            this.$el.append(\n                '<p>' +\n                    Utils.translate(\n                        'Continue Shopping on our <a href=\"/\" data-touchpoint=\"home\">Home Page</a>. '\n                    ) +\n                    '</p>'\n            );\n        }\n    },\n\n    // @method trackTransaction Convert the LiveOrder.Model into Track.Transaction.Model until we unified it with the Transaction.Model\n    trackTransaction: function(confirmation) {\n        const summary = confirmation.get('summary');\n        const transaction = {\n            confirmationNumber: confirmation.get('tranid'),\n            subTotal: summary && summary.subtotal,\n            total: summary && summary.total,\n            taxTotal: summary && summary.taxtotal,\n            shippingCost: summary && summary.shippingcost,\n            handlingCost: summary && summary.handlingcost,\n            products: new Backbone.Collection(),\n            promocodes: confirmation.get('promocodes')\n        };\n        const transactionModel = new Backbone.Model(transaction);\n\n        confirmation.get('lines').each(function(line) {\n            const options = [];\n\n            line.get('options').each(function(option) {\n                if (option.get('value').label) {\n                    options.push(option.get('value').label);\n                }\n            });\n\n            transactionModel.get('products').add(\n                new Backbone.Model({\n                    name: line.get('item').get('_name'),\n                    id: line.get('item').get('itemid'),\n                    rate: line.get('rate'),\n                    category: '/' + line.get('item').get('urlcomponent'),\n                    options: options.sort().join(', '),\n                    quantity: line.get('quantity')\n                })\n            );\n        });\n\n        Tracker.getInstance().trackTransaction(transactionModel);\n    },\n\n    // @method getContext @return OrderWizard.Module.Confirmation.Context\n    getContext: function() {\n        let continue_url = '/';\n        let touchpoint = true;\n\n        if (\n            Configuration.get('siteSettings.iswsdk') &&\n            Configuration.get('siteSettings.wsdkcancelcarturl')\n        ) {\n            continue_url = Configuration.get('siteSettings.wsdkcancelcarturl');\n            touchpoint = false;\n        }\n\n        // @class OrderWizard.Module.Confirmation.Context\n        return {\n            // @property {String} continueURL\n            continueURL: continue_url,\n            // @property {Boolean} isGuestAndCustomerCenter\n            isGuestAndCustomerCenter: !!(\n                this.wizard.profileModel.get('isGuest') === 'F' &&\n                Configuration.get('siteSettings.touchpoints.customercenter')\n            ),\n            // @property {String} additionalConfirmationMessage\n            additionalConfirmationMessage: this.options.additional_confirmation_message,\n            // @property {Boolean} touchPoint\n            touchPoint: touchpoint,\n            // @property {String} confirmationNumber\n            confirmationNumber: this.confirmation_number,\n            // @property {Number} orderId\n            orderId: this.order_id,\n            // @property {String} pdfUrl\n            pdfUrl: Utils.getDownloadPdfUrl({\n                asset: 'order-details',\n                id: this.order_id\n            })\n        };\n    }\n});\n"]}
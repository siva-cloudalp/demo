{"version":3,"sources":["ItemRelations.Related.Collection.ts"],"names":[],"mappings":"AAAA;;;;;EAKE;;;IASF,IAAM,8BAA8B,GAAG,cAAc,CAAC,MAAM,CAAC;QACzD,UAAU,EAAE,UAAS,OAAO;YACxB,IAAI,CAAC,sBAAsB,GAAG,yCAAmB,CAAC,wBAAwB,CAAC,cAAc,CAAC,CAAC;YAC3F,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC;gBACvC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,QAAQ,EAAE,UAAS,EAAE;oBAClC,OAAO,EAAE,CAAC;gBACd,CAAC,CAAC;gBACJ,CAAC,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QAC7B,CAAC;QAED,+CAA+C;QAC/C,UAAU,EAAE;YACR,OAAO,IAAI,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,EAAE,EAAE,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,CAAC;QACjE,CAAC;QAED,KAAK,EAAE,UAAS,QAAQ;YACpB,IAAM,cAAc,GAAG,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;YAEjD,IAAI,cAAc,CAAC,MAAM,KAAK,CAAC,EAAE;gBAC7B,OAAO,EAAE,CAAC,CAAC,4DAA4D;aAC1E;YAED,IAAI,cAAc,CAAC,MAAM,KAAK,CAAC,EAAE;gBAC7B,OAAa,cAAc,CAAC,CAAC,CAAE,CAAC,mBAAmB,CAAC,CAAC,2BAA2B;aACnF;YAED,6EAA6E;YAC7E,IAAM,IAAI,GAAG,IAAI,CAAC;YAClB,IAAM,KAAK,GAAG,EAAE,CAAC;YAEjB,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,cAAc,EAAE,qBAAqB,CAAC,EAAE,UAAS,aAAa;gBACzE,CAAC,CAAC,IAAI,CAAC,aAAa,EAAE,UAAS,YAAiB;oBAC5C,IACI,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,EAAE,YAAY,CAAC,UAAU,CAAC;wBACnD,CAAC,KAAK,CAAC,YAAY,CAAC,UAAU,CAAC,EACjC;wBACE,KAAK,CAAC,YAAY,CAAC,UAAU,CAAC,GAAG,YAAY,CAAC;qBACjD;gBACL,CAAC,CAAC,CAAC;YACP,CAAC,CAAC,CAAC;YAEH,OAAO,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QAC5B,CAAC;KACJ,CAAC,CAAC;IAEH,OAAS,8BAA8B,CAAC","file":"ItemRelations.Related.Collection.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"ItemRelations.Related.Collection\"/>\n\nimport * as _ from 'underscore';\nimport { MasterOptionsHelper } from '../../SC/JavaScript/MasterOptionsHelper';\n\nimport ItemCollection = require('../../Item/JavaScript/Item.Collection');\n\nconst ItemRelationsRelatedCollection = ItemCollection.extend({\n    initialize: function(options) {\n        this.searchApiMasterOptions = MasterOptionsHelper.getSearchAPIMasterOption('relatedItems');\n        this.itemsIds = _.isArray(options.itemsIds)\n            ? _.sortBy(options.itemsIds, function(id) {\n                  return id;\n              })\n            : [options.itemsIds];\n    },\n\n    // @method fetchItems @return {jQuery.Deferred}\n    fetchItems: function() {\n        return this.fetch({ data: { id: this.itemsIds.join(',') } });\n    },\n\n    parse: function(response) {\n        const original_items = _.compact(response.items);\n\n        if (original_items.length === 0) {\n            return []; // No items. Return an empty array, nothing else to do here.\n        }\n\n        if (original_items.length === 1) {\n            return (<any>original_items[0]).relateditems_detail; // Same order is preserved.\n        }\n\n        // This is to avoid repeated related items among different items. (Cart page)\n        const self = this;\n        const items = {};\n\n        _.each(_.pluck(original_items, 'relateditems_detail'), function(related_items) {\n            _.each(related_items, function(related_item: any) {\n                if (\n                    !_.contains(self.itemsIds, related_item.internalid) &&\n                    !items[related_item.internalid]\n                ) {\n                    items[related_item.internalid] = related_item;\n                }\n            });\n        });\n\n        return _.toArray(items);\n    }\n});\n\nexport = ItemRelationsRelatedCollection;\n"]}
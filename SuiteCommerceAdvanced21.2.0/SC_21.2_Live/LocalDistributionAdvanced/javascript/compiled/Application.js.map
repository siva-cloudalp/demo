{"version":3,"sources":["Application.ts"],"names":[],"mappings":"AAAA;;;;;EAKE;;;;;;;;;;;;IAuBF;QAUI;YAAA,iBAOC;YAhBO,4BAAuB,GAAG,EAAE,CAAC;YAC7B,gBAAW,GAAG,EAAE,CAAC;YAER,YAAO,GAAoC,IAAI,kCAAmB,EAAE,CAAC;YAOlF,6DAA6D;YAC7D,qCAAqC;YACrC,IAAM,EAAE,GAAG,yBAAW,CAAC,KAAK,EAAE,CAAC;YAC/B,EAAE,CAAC,WAAW,GAAG,IAAI,CAAC;YAEtB,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,YAAY,EAAE,cAAY,OAAA,KAAI,CAAC,sBAAsB,EAAE,EAA7B,CAA6B,CAAC,CAAC;QAC/E,CAAC;QAMM,+BAAS,GAAhB;YACI,OAAO,IAAI,CAAC,aAAa,CAAC;QAC9B,CAAC;QAED;;WAEG;QACI,+BAAS,GAAhB,UAAiB,GAAW,EAAE,KAAU;YACpC,yBAAiB,CAAC,IAAI,CAAC,aAAa,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC;QACtD,CAAC;QAEM,+BAAS,GAAhB;YACI,OAAO,IAAI,CAAC,MAAM,CAAC;QACvB,CAAC;QAEM,oCAAc,GAArB,UAAsB,OAA6B;YAC/C,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACnC,CAAC;QAED;;WAEG;QACI,6BAAO,GAAd,UAAe,KAAU;;YAAE,cAAc;iBAAd,UAAc,EAAd,qBAAc,EAAd,IAAc;gBAAd,6BAAc;;YACrC,CAAA,KAAA,IAAI,CAAC,OAAO,CAAA,CAAC,IAAI,2BAAC,KAAK,GAAK,IAAI,GAAE;QACtC,CAAC;QAED;;WAEG;QACI,wBAAE,GAAT,UAAU,KAAU,EAAE,OAAiB;YACnC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;QACpC,CAAC;QAED;;WAEG;QACI,0BAAI,GAAX,UAAY,KAAU,EAAE,OAAkB;YACtC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;QACtC,CAAC;QAED;;WAEG;QACI,yBAAG,GAAV,UAAW,KAAU,EAAE,OAAkB;YACrC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;QACrC,CAAC;QAEM,gCAAU,GAAjB;YACI,OAAO,IAAI,CAAC,OAAO,CAAC;QACxB,CAAC;QAEM,2BAAK,GAAZ,UAAa,OAAc,EAAE,IAAe;YAA5C,iBA6CC;YA5CG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;YACvC,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;YACvB,IAAI,CAAC,iBAAiB,CAAC,sBAAsB,CAAC,IAAI,CAAC,CAAC,CAAC;YAErD,0CAA0C;YAC1C,CAAC,CAAC,IAAI,CACF,IAAI,CAAC,OAAO,EACZ,UAAC,MAAW;gBACR,IAAI,MAAM,IAAI,CAAC,CAAC,UAAU,CAAC,MAAM,CAAC,UAAU,CAAC,EAAE;oBAC3C,IAAI;wBACA,IAAM,gBAAgB,GAAG,MAAM,CAAC,UAAU,CAAC,KAAI,CAAC,CAAC;wBACjD,IAAI,gBAAgB,IAAI,gBAAgB,CAAC,aAAa,EAAE;4BACpD,KAAI,CAAC,iBAAiB,CAAC,gBAAgB,CAAC,CAAC;yBAC5C;6BAAM;4BACH,KAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;yBACvD;qBACJ;oBAAC,OAAO,KAAK,EAAE;wBACZ,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;qBACxB;iBACJ;YACL,CAAC,CACJ,CAAC;YAEF,6CAA6C;YAC7C,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE;gBACnB,MAAM,IAAI,KAAK,CACX,iFAAiF,CACpF,CAAC;aACL;YAED,yEAAyE;YACzE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,oBAAoB,EAAE,IAAI,CAAC,CAAC;YAE9C,MAAM,CAAC,IAAI,OAAX,MAAM,EAAS,IAAI,CAAC,WAAW,EAAE,IAAI,CACjC;gBACI,IAAI,IAAI,EAAE;oBACN,IAAI,CAAC,KAAI,CAAC,CAAC;iBACd;gBACD,oDAAoD;gBACpD,4DAA4D;gBAC5D,KAAI,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,EAAE,KAAI,CAAC,CAAC;gBACtC,KAAI,CAAC,sBAAsB,EAAE,CAAC;YAClC,CAAC,CACJ,CAAC;QACN,CAAC;QAEO,4CAAsB,GAA9B;YACI,yCAAyC;YACzC,IAAI,CAAO,QAAQ,CAAC,OAAQ,CAAC,OAAO,EAAE;gBAClC,OAAO;aACV;YAED,IAAM,QAAQ,GAAG,QAAQ,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;YAChD,IAAM,KAAK,GAAG,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,UAAS,OAAY;gBACjE,OAAO,OAAO,CAAC,QAAQ,IAAI,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAC5D,CAAC,CAAC,CAAC;YAEH,kFAAkF;YAClF,IAAI,CAAC,KAAK,EAAE;gBACR,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;aAC1B;QACL,CAAC;QAEM,uCAAiB,GAAxB,UAAyB,SAAc;YACnC,IAAM,kBAAkB,GAAG,uCAAkB,CAAC,WAAW,EAAE,CAAC;YAC5D,kBAAkB,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;QACpD,CAAC;QAEM,kCAAY,GAAnB,UAAoB,aAAqB;YACrC,IAAM,kBAAkB,GAAG,uCAAkB,CAAC,WAAW,EAAE,CAAC;YAC5D,OAAO,kBAAkB,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC;QAC1D,CAAC;QAEM,kCAAY,GAAnB;YACI,OAAO,KAAK,CAAC;QACjB,CAAC;QAEM,sCAAgB,GAAvB;YACI,OAAO,IAAI,CAAC;QAChB,CAAC;QACL,kBAAC;IAAD,CA3JA,AA2JC,IAAA;IA3JqB,kCAAW","file":"Application.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name = \"Application\"/>\n\nimport * as _ from 'underscore';\nimport * as jQuery from '../../Core/JavaScript/jQuery';\nimport * as Backbone from '../../Core/JavaScript/backbone/BackboneExtras';\nimport { DefaultEventEmitter, EventEmitter } from '../../Core/JavaScript/EventEmitter';\nimport { ComponentContainer } from '../../SC/JavaScript/ComponentContainer';\nimport { ApplicationLayout } from './ApplicationLayout';\nimport { setPathFromObject } from '../../Utilities/JavaScript/Utils';\nimport { Environment } from '../../Core/JavaScript/Environment';\n\nimport GenericLayoutComponent = require('./Generic.LayoutComponent');\n\ninterface ApplicationEvents {\n    beforeStart: (app: Application) => void;\n    afterModulesLoaded: (app: Application) => void;\n    afterStart: (app: Application) => void;\n}\n\nexport type Configuration = any;\n\nexport abstract class Application {\n    private modulesMountToAppResult = [];\n    private appPromises = [];\n    private modules: any[];\n    private readonly emitter: EventEmitter<ApplicationEvents> = new DefaultEventEmitter();\n    protected configuration: any;\n    // This is only to avoid break extensions in 20.2 release. Should be deleted asap\n    protected Configuration: any;\n    protected layout: ApplicationLayout;\n\n    protected constructor() {\n        // This is to avoid a circular dependency with Backbone.View.\n        // getCurrent should be used instead.\n        const SC = Environment.getSC();\n        SC.Application = this;\n\n        jQuery(window).on('hashchange', (): void => this.controlValidNavigation());\n    }\n\n    public abstract resizeImage(url: string, size: string): any;\n\n    public abstract getKeyMapping(): any;\n\n    public getConfig(): Configuration {\n        return this.configuration;\n    }\n\n    /**\n     * @deprecated\n     */\n    public setConfig(key: string, value: any): void {\n        setPathFromObject(this.configuration, key, value);\n    }\n\n    public getLayout(): ApplicationLayout {\n        return this.layout;\n    }\n\n    public waitForPromise(promise: JQuery.Deferred<any>): void {\n        this.appPromises.push(promise);\n    }\n\n    /**\n     * @deprecated\n     */\n    public trigger(event: any, ...args: any[]): void {\n        this.emitter.emit(event, ...args);\n    }\n\n    /**\n     * @deprecated\n     */\n    public on(event: any, listner: Function): void {\n        this.emitter.on(event, listner);\n    }\n\n    /**\n     * @deprecated\n     */\n    public once(event: any, listner?: Function): void {\n        this.emitter.once(event, listner);\n    }\n\n    /**\n     * @deprecated\n     */\n    public off(event: any, listner?: Function): void {\n        this.emitter.off(event, listner);\n    }\n\n    public getEmitter(): EventEmitter<ApplicationEvents> {\n        return this.emitter;\n    }\n\n    public start(modules: any[], done?: Function): void {\n        this.emitter.emit('beforeStart', this);\n        this.modules = modules;\n        this.registerComponent(GenericLayoutComponent(this));\n\n        // we mount each module to our application\n        _.each(\n            this.modules,\n            (module: any): void => {\n                if (module && _.isFunction(module.mountToApp)) {\n                    try {\n                        const mountToAppResult = module.mountToApp(this);\n                        if (mountToAppResult && mountToAppResult.componentName) {\n                            this.registerComponent(mountToAppResult);\n                        } else {\n                            this.modulesMountToAppResult.push(mountToAppResult);\n                        }\n                    } catch (error) {\n                        console.error(error);\n                    }\n                }\n            }\n        );\n\n        // This checks if you have registered modules\n        if (!Backbone.history) {\n            throw new Error(\n                'No Backbone.Router has been initialized (Hint: Are your modules properly set?).'\n            );\n        }\n\n        // @event afterModulesLoaded triggered after all modules have been loaded\n        this.emitter.emit('afterModulesLoaded', this);\n\n        jQuery.when(...this.appPromises).then(\n            (): void => {\n                if (done) {\n                    done(this);\n                }\n                // @event afterStart triggered after the application\n                // finish starting and after the start() callback is called.\n                this.emitter.emit('afterStart', this);\n                this.controlValidNavigation();\n            }\n        );\n    }\n\n    private controlValidNavigation(): void {\n        // find a router for the current fragment\n        if (!(<any>Backbone.history).started) {\n            return;\n        }\n\n        const fragment = Backbone.history.getFragment();\n        const match = _(Backbone.history.handlers).some(function(handler: any): boolean {\n            return handler.callback && handler.route.exec(fragment);\n        });\n\n        // if not found a router for the current fragment the page not found is displayed.\n        if (!match) {\n            this.layout.notFound();\n        }\n    }\n\n    public registerComponent(component: any): void {\n        const componentContainer = ComponentContainer.getInstance();\n        componentContainer.registerComponent(component);\n    }\n\n    public getComponent(componentName: string): any {\n        const componentContainer = ComponentContainer.getInstance();\n        return componentContainer.getComponent(componentName);\n    }\n\n    public isStandalone(): boolean {\n        return false;\n    }\n\n    public isReorderEnabled(): boolean {\n        return true;\n    }\n}\n"]}
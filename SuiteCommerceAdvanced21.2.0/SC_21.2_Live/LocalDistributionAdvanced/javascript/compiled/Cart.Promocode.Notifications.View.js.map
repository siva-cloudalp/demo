{"version":3,"sources":["Cart.Promocode.Notifications.View.ts"],"names":[],"mappings":"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","file":"Cart.Promocode.Notifications.View.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"Cart.Promocode.Notifications.View\"/>\n\nimport * as cart_promocode_notifications from 'cart_promocode_notifications.tpl';\nimport * as Utils from '../../Utilities/JavaScript/Utils';\nimport { GlobalViewsMessageView } from '../../GlobalViews/JavaScript/GlobalViews.Message.View';\n\nimport BackboneView = require('../../BackboneExtras/JavaScript/Backbone.View');\n\n// @class Cart.Promocode.Notification.View @extend Backbone.View\nexport = BackboneView.extend({\n    // @property {Function} template\n    template: cart_promocode_notifications,\n\n    // @method initialize\n    // @return {Void}\n    initialize: function initialize() {\n        this.on('afterCompositeViewRender', this.afterViewRender, this);\n    },\n\n    // @property {ChildViews} childViews\n    childViews: {\n        'Promocode.Notification': function() {\n            let notification;\n\n            if (this.model.get('type') === 'FREEGIFT' && !!this.model.get('freegiftinfo')) {\n                notification = this.getFreeGiftNotification(\n                    this.model.get('freegiftinfo')[0],\n                    this.model.get('freegiftinfo')[1]\n                );\n            } else {\n                notification = this.getNotification();\n            }\n\n            return new GlobalViewsMessageView({\n                message: notification.message,\n                type: notification.type,\n                closable: true\n            });\n        }\n    },\n\n    // @method afterViewRender lets parent model know the promotion\n    // already shwoed its current notification\n    // @return {Void}\n    afterViewRender: function() {\n        this.options.parentModel.trigger(\n            'promocodeNotificationShown',\n            this.model.get('internalid')\n        );\n    },\n\n    // @method getNotification\n    // @return {Notification}\n    getNotification: function() {\n        const notification: any = {};\n\n        if (this.model.get('applicabilitystatus') === 'APPLIED') {\n            notification.type = 'success';\n            notification.message = Utils.translate(\n                'Promotion <strong>$(0)</strong> is now discounting your order.',\n                this.model.get('code')\n            );\n        } else if (this.model.get('applicabilityreason') === 'CRITERIA_NOT_MET') {\n            notification.type = !this.model.get('isautoapplied') ? 'warning' : 'info';\n            notification.message = Utils.translate(\n                'Promotion <strong>$(0)</strong> is not discounting your order. $(1)',\n                this.model.get('code'),\n                this.model.get('errormsg')\n            );\n        } else if (this.model.get('applicabilityreason') === 'DISCARDED_BEST_OFFER') {\n            notification.type = 'info';\n            notification.message = Utils.translate(\n                'We have chosen the best possible offer for you. Promotion <strong>$(0)</strong> is not discounting your order.',\n                this.model.get('code')\n            );\n        }\n\n        return notification;\n    },\n\n    // @method getFreeGiftNotification\n    // @return {Notification}\n    getFreeGiftNotification: function(free_gift_info_old, free_gift_info_current) {\n        if (!free_gift_info_old) {\n            return this.setFreeGifttNotification('success', free_gift_info_current.qtygiven);\n        }\n        if (!free_gift_info_current) {\n            return this.setFreeGifttNotification('warning', free_gift_info_old.qtygiven);\n        }\n        const qty_diff = free_gift_info_current.qtygiven - free_gift_info_old.qtygiven;\n\n        if (qty_diff > 0) {\n            return this.setFreeGifttNotification('success', qty_diff);\n        }\n        return this.setFreeGifttNotification('warning', qty_diff * -1);\n    },\n\n    setFreeGifttNotificationText: function(message_type, gift_quantity) {\n        const notification: any = {};\n        notification.type = message_type;\n\n        if (message_type === 'success') {\n            if (gift_quantity > 1) {\n                notification.message = Utils.translate(\n                    'Congratulations! $(0) FREE $(1) were added to your cart.',\n                    gift_quantity,\n                    this.model.get('freegiftname')\n                );\n            } else {\n                notification.message = Utils.translate(\n                    'Congratulations! $(0) FREE $(1) was added to your cart.',\n                    gift_quantity,\n                    this.model.get('freegiftname')\n                );\n            }\n        } else if (message_type === 'warning') {\n            const errormsg = this.model.get('errormsg') ? this.model.get('errormsg') : '';\n\n            if (gift_quantity > 1) {\n                notification.message = Utils.translate(\n                    '$(0) $(1) were removed from your cart. $(2)',\n                    gift_quantity,\n                    this.model.get('freegiftname'),\n                    errormsg\n                );\n            } else {\n                notification.message = Utils.translate(\n                    '$(0) $(1) was removed from your cart. $(2)',\n                    gift_quantity,\n                    this.model.get('freegiftname'),\n                    errormsg\n                );\n            }\n        }\n\n        return notification;\n    },\n\n    // @method getContext\n    // @return {Cart.Promocode.Notifications.View.context}\n    getContext: function getContext() {\n        // @class Cart.Promocode.Notifications.View.context\n        return {};\n        // @class Cart.Promocode.Notifications.View\n    }\n});\n"]}
{"version":3,"sources":["Header.MiniCart.View.ts"],"names":[],"mappings":"AAAA;;;;;EAKE;;;IAqBF,OAAS,YAAY,CAAC,MAAM,CAAC;QACzB,QAAQ,EAAE,oBAAoB;QAE9B,yFAAyF;QACzF,UAAU,EAAE;YACR,EAAE,EAAE,sBAAsB;YAC1B,wBAAwB,EAAE,sBAAsB;SACnD;QACD,MAAM,EAAE;YACJ,oCAAoC,EAAE,YAAY;SACrD;QAED,UAAU,EAAE,SAAS,UAAU;YAC3B,IAAM,IAAI,GAAG,IAAI,CAAC;YAElB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;YACtB,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC;YAErB,IAAI,CAAC,KAAK,GAAG,cAAc,CAAC,WAAW,EAAE,CAAC;YAE1C,cAAc,CAAC,QAAQ,EAAE,CAAC,IAAI,CAAC;gBAC3B,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;gBACvB,IAAI,CAAC,MAAM,EAAE,CAAC;YAClB,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,QAAQ,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;YAC3C,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC,YAAY,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;QAChE,CAAC;QAED,UAAU,EAAE;YACR,OAAO,CAAC,WAAW,EAAE,CAAC,sBAAsB,EAAE,CAAC;QACnD,CAAC;QAED,MAAM,EAAE,SAAS,MAAM;YACnB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,iBAAiB,EAAE,CAAC;YAElD,YAAY,CAAC,SAAS,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;YAErD,kDAAkD;YAClD,IACI,KAAK,CAAC,cAAc,EAAE;gBACtB,KAAK,CAAC,eAAe,EAAE;gBACvB,EAAE,CAAC,aAAa,CAAC,iBAAiB,KAAK,cAAc,EACvD;gBACE,IAAI,CAAC,CAAC,CAAC,yBAAyB,CAAC,CAAC,IAAI,CAAC,aAAa,EAAE,UAAU,CAAC,CAAC;aACrE;QACL,CAAC;QAED,OAAO,EAAE,SAAS,OAAO;YACrB,IAAI,CAAC,QAAQ,EAAE,CAAC;YAEhB,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;YAC5C,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,YAAY,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;QACjE,CAAC;QAED,UAAU,EAAE;YACR,wBAAwB,EAAE;gBACtB,OAAO,IAAI,yBAAyB,EAAE,CAAC;YAC3C,CAAC;YACD,yBAAyB,EAAE;gBACvB,OAAO,IAAI,sBAAsB,CAAC;oBAC9B,UAAU,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,IAAI,QAAQ,CAAC,UAAU,EAAE;oBACjF,SAAS,EAAE,0BAA0B;oBACrC,WAAW,EAAE,CAAC;iBACjB,CAAC,CAAC;YACP,CAAC;SACJ;QAED,qBAAqB;QACrB,yCAAyC;QACzC,UAAU,EAAE;YACR,IAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;YAE1C,sCAAsC;YACtC,OAAO;gBACH,oCAAoC;gBACpC,KAAK,EAAE,IAAI,CAAC,KAAK;gBACjB,iCAAiC;gBACjC,WAAW,EAAE,IAAI,CAAC,WAAW;gBAC7B,qCAAqC;gBACrC,cAAc,EAAE,IAAI,CAAC,WAAW,KAAK,CAAC;gBACtC,gCAAgC;gBAChC,SAAS,EAAE,IAAI,CAAC,WAAW,GAAG,CAAC;gBAC/B,gCAAgC;gBAChC,SAAS,EAAE,IAAI,CAAC,SAAS;gBACzB,uCAAuC;gBACvC,iBAAiB,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,OAAO,IAAI,OAAO,CAAC,kBAAkB,CAAC,CAAC,CAAC,EAAE;gBAC/E,oCAAoC;gBACpC,cAAc,EAAE,6BAAa,CAAC,GAAG,CAAC,gCAAgC,EAAE,KAAK,CAAC;oBACtE,CAAC,CAAC,6BAAa,CAAC,GAAG,CAAC,mBAAmB,CAAC;oBACxC,CAAC,CAAC,UAAU;gBAChB,qCAAqC;gBACrC,cAAc,EAAE,CAAC,4BAAY,CAAC,WAAW,EAAE,CAAC,UAAU,EAAE;aAC3D,CAAC;YACF,8BAA8B;QAClC,CAAC;KACJ,CAAC,CAAC","file":"Header.MiniCart.View.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"Header.MiniCart.View\"/>\n/// <reference path=\"../../../Commons/Utilities/JavaScript/GlobalDeclarations.d.ts\" />\n\nimport * as header_mini_cart_tpl from 'header_mini_cart.tpl';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport { Configuration } from '../../SCA/JavaScript/Configuration';\nimport { ProfileModel } from '../../../Commons/Profile/JavaScript/Profile.Model';\n\nimport LiveOrderModel = require('../../../Commons/LiveOrder/JavaScript/LiveOrder.Model');\nimport HeaderMiniCartSummaryView = require('./Header.MiniCartSummary.View');\nimport HeaderMiniCartItemCellView = require('./Header.MiniCartItemCell.View');\nimport Tracker = require('../../../Commons/Tracker/JavaScript/Tracker');\nimport BackboneCollectionView = require('../../../Commons/Backbone.CollectionView/JavaScript/Backbone.CollectionView');\nimport BackboneView = require('../../../Commons/BackboneExtras/JavaScript/Backbone.View');\nimport Backbone = require('../../../Commons/Utilities/JavaScript/backbone.custom');\n\n// @module Header\n\n// @class Header.MiniCart.View @extends BackboneView\nexport = BackboneView.extend({\n    template: header_mini_cart_tpl,\n\n    // @property {Object} attributes List of HTML attributes applied by Backbone into the $el\n    attributes: {\n        id: 'Header.MiniCart.View',\n        'data-root-component-id': 'Header.MiniCart.View'\n    },\n    events: {\n        'click [data-touchpoint=\"checkout\"]': 'trackEvent'\n    },\n\n    initialize: function initialize() {\n        const self = this;\n\n        this.isLoading = true;\n        this.itemsInCart = 0;\n\n        this.model = LiveOrderModel.getInstance();\n\n        LiveOrderModel.loadCart().done(function() {\n            self.isLoading = false;\n            self.render();\n        });\n\n        this.model.on('change', this.render, this);\n        this.model.get('lines').on('add remove', this.render, this);\n    },\n\n    trackEvent: function() {\n        Tracker.getInstance().trackProceedToCheckout();\n    },\n\n    render: function render() {\n        this.itemsInCart = this.model.getTotalItemCount();\n\n        BackboneView.prototype.render.apply(this, arguments);\n\n        // on tablet or desktop make the minicart dropdown\n        if (\n            Utils.isTabletDevice() ||\n            Utils.isDesktopDevice() ||\n            SC.CONFIGURATION.addToCartBehavior === 'showMiniCart'\n        ) {\n            this.$('[data-type=\"mini-cart\"]').attr('data-toggle', 'dropdown');\n        }\n    },\n\n    destroy: function destroy() {\n        this._destroy();\n\n        this.model.off('change', this.render, this);\n        this.model.get('lines').off('add remove', this.render, this);\n    },\n\n    childViews: {\n        'Header.MiniCartSummary': function() {\n            return new HeaderMiniCartSummaryView();\n        },\n        'Header.MiniCartItemCell': function() {\n            return new BackboneCollectionView({\n                collection: !this.isLoading ? this.model.get('lines') : new Backbone.Collection(),\n                childView: HeaderMiniCartItemCellView,\n                viewsPerRow: 1\n            });\n        }\n    },\n\n    // @method getContext\n    // @return {Header.MiniCart.View.Context}\n    getContext: function() {\n        const summary = this.model.get('summary');\n\n        // @class Header.MiniCart.View.Context\n        return {\n            // @property {LiveOrder.Model} model\n            model: this.model,\n            // @property {Number} itemsInCart\n            itemsInCart: this.itemsInCart,\n            // @property {Boolean} showPluraLabel\n            showPluraLabel: this.itemsInCart !== 1,\n            // @property {Boolean} showLines\n            showLines: this.itemsInCart > 0,\n            // @property {Boolean} isLoading\n            isLoading: this.isLoading,\n            // @property {String} subtotalFormatted\n            subtotalFormatted: !this.isLoading ? summary && summary.subtotal_formatted : '',\n            // @property {String} cartTouchPoint\n            cartTouchPoint: Configuration.get('modulesConfig.Cart.startRouter', false)\n                ? Configuration.get('currentTouchpoint')\n                : 'viewcart',\n            // @property {Boolean} isPriceEnabled\n            isPriceEnabled: !ProfileModel.getInstance().hidePrices()\n        };\n        // @class Header.MiniCart.View\n    }\n});\n"]}
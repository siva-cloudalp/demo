{"version":3,"sources":["Overview.Home.Standalone.View.ts"],"names":[],"mappings":"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","file":"Overview.Home.Standalone.View.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"Overview.Home.Standalone.View\"/>\n// Overview.Home.Standalone.View.js\n// --------------------\n\nimport * as overview_home_standalone_tpl from 'overview_home_standalone.tpl';\nimport * as notifications_tpl from 'notifications.tpl';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\nimport { Configuration } from '../../SCA/JavaScript/Configuration';\nimport { RecordViewsView } from '../../RecordViews/JavaScript/RecordViews.View';\nimport { AjaxRequestsKiller } from '../../../Commons/AjaxRequestsKiller/JavaScript/AjaxRequestsKiller';\nimport { ProfileModel } from '../../../Commons/Profile/JavaScript/Profile.Model';\n\nimport { GlobalViewsMessageView } from '../../../Commons/GlobalViews/JavaScript/GlobalViews.Message.View';\n\nimport OverviewBannerView = require('./Overview.Banner.View');\nimport OverviewProfileView = require('./Overview.Profile.View');\nimport OverviewPaymentView = require('./Overview.Payment.View');\nimport OverviewShippingView = require('./Overview.Shipping.View');\nimport BackboneCollectionView = require('../../../Commons/Backbone.CollectionView/JavaScript/Backbone.CollectionView');\nimport Session = require('../../../Commons/Session/JavaScript/Session');\nimport Handlebars = require('../../../Commons/Utilities/JavaScript/Handlebars');\nimport InvoicesCollection = require('../../Invoice/JavaScript/Invoice.Collection.js');\nimport Backbone = require('../../../Commons/Utilities/JavaScript/backbone.custom');\nimport TransactionListView = require('../../../Commons/Transaction/JavaScript/Transaction.List.View');\n\n// home page view\nconst OverviewHomeStandaloneView: any = TransactionListView.extend({\n    template: overview_home_standalone_tpl,\n\n    title: Utils.translate('Welcome!'),\n\n    attributes: {\n        id: 'MyAccountOverviewStandalone',\n        class: 'ProfileHomeStandaloneView'\n    },\n\n    events: {},\n\n    initialize: function(options) {\n        const { application, collection, model } = options;\n        this.application = application;\n        this.collection = collection || new InvoicesCollection();\n        this.model = model || ProfileModel.getInstance();\n        this.model.on('change', this.showContent, this);\n\n        this.isSCISIntegrationEnabled = Configuration.get(\n            'siteSettings.isSCISIntegrationEnabled',\n            false\n        );\n        this.customerSupportURL = Configuration.get('overview.customerSupportURL');\n\n        this.addresses = this.model.get('addresses');\n        this.addresses.on('reset destroy change add', this.showContent, this);\n\n        this.paymentmethods = this.model.get('paymentmethods');\n        this.paymentmethods.on('reset destroy change add', this.showContent, this);\n\n        if (!notifications_tpl) {\n            if (Session.get('email_change_verification', false)) {\n                this.email_change_verification = SC.SESSION.email_change_verification;\n                delete SC.SESSION.email_change_verification;\n            }\n        }\n    },\n\n    beforeShowContent: function beforeShowContent() {\n        const promise = jQuery.Deferred();\n        const defaultRecentOrdersQuantity = 10;\n        this.collection\n            .fetch({\n                data: { \n                    page: 1,\n                    order: 1,\n                    sort: 'trandate,internalid',\n                    results_per_page: Configuration.get('overview.homeRecentOrdersQuantity', defaultRecentOrdersQuantity)\n                },\n                error: function(model, jqXhr) {\n                    // this will stop the ErrorManagment module to process this error\n                    // as we are taking care of it\n                    jqXhr.preventDefault = true;\n                },\n                killerId: AjaxRequestsKiller.getKillerId()\n            })\n            .always(() => promise.resolve());\n\n        return promise;\n    },\n\n    // @method getContext @return Overview.Home.View.Context\n    getContext: function() {\n        const isSCISIntegrationEnabled = Configuration.get(\n            'siteSettings.isSCISIntegrationEnabled',\n            false\n        );\n\n        // @class Overview.Home.View.Context\n        return {\n            // @property {Boolean} collectionLengthGreaterThan0\n            collectionLengthGreaterThan0: this.collection.length > 0,\n            // @property {Boolean} hasCustomerSupportURL\n            hasCustomerSupportURL: !!this.customerSupportURL,\n            // @property {String} customerSupportURL\n            customerSupportURL: this.customerSupportURL,\n            // @property {String} firstName\n            firstName: this.model.get('firstname') || this.model.get('name') || '',\n            // @property {Boolean} isSCISIntegrationEnabled\n            isSCISIntegrationEnabled: this.isSCISIntegrationEnabled,\n            // @property {Boolean} purchasesPermissions\n            purchasesPermissions: isSCISIntegrationEnabled\n                ? 'transactions.tranFind.1,transactions.tranPurchases.1'\n                : 'transactions.tranFind.1,transactions.tranSalesOrd.1'\n        };\n    },\n\n    childViews: {\n        'Overview.Banner': function() {\n            return new OverviewBannerView();\n        },\n        'Overview.Profile': function() {\n            return new OverviewProfileView({ model: this.model });\n        },\n        'Overview.Payment': function() {\n            return new OverviewPaymentView({ model: this.defaultPaymentMethod });\n        },\n        'Overview.Shipping': function() {\n            return new OverviewShippingView({ model: this.defaultShippingAddress });\n        },\n        'Overview.Messages': function() {\n            if (this.email_change_verification) {\n                return new GlobalViewsMessageView({\n                    message:\n                        this.email_change_verification === 'true'\n                            ? `${Utils.translate(\n                                  'Your email has been changed successfully to <strong>'\n                              ) + this.model.get('email')}</strong>`\n                            : this.email_change_verification,\n                    type: this.email_change_verification === 'true' ? 'success' : 'error',\n                    closable: true\n                });\n            }\n        },\n        'Invoices.Results': function() {\n            const self = this;\n            let selectedColumns = [];\n            if (!Configuration.get().transactionListColumns.enableInvoice) {\n                selectedColumns.push({\n                    label: 'Date:',\n                    type: 'date',\n                    name: 'date',\n                    id: 'trandate'\n                });\n                selectedColumns.push({\n                    label: 'Amount:',\n                    type: 'currency',\n                    name: 'amount',\n                    id: 'amount_formatted'\n                });\n                selectedColumns.push({\n                    label: 'Status:',\n                    type: 'status',\n                    name: 'name',\n                    id: 'status'\n                });\n            } else {\n                selectedColumns = Configuration.get().transactionListColumns.invoiceOpen;\n            }\n\n            const records_collection = new Backbone.Collection(\n                this.collection.map(function(invoice) {\n                    invoice.status.name =\n                        invoice.get('status').internalid === 'open'\n                            ? new Handlebars.SafeString(\n                                  Utils.translate('<span class=\"invoice-pending\">Pending</span>')\n                              )\n                            : new Handlebars.SafeString(\n                                  Utils.translate('<span class=\"invoice-paid\">Paid</span>')\n                              );\n                    return new Backbone.Model({\n                        touchpoint: 'customercenter',\n                        title: new Handlebars.SafeString(\n                            Utils.translate(\n                                '#<span class=\"tranid\">$(0)</span>',\n                                invoice.get('tranid')\n                            )\n                        ),\n                        detailsURL: `invoices/${invoice.get('internalid')}`,\n                        id: invoice.get('internalid'),\n                        internalid: invoice.get('internalid'),\n                        status: invoice.get('status'),\n                        columns: self._buildColumns(selectedColumns, invoice)\n                    });\n                })\n            );\n\n            return new BackboneCollectionView({\n                childView: RecordViewsView,\n                collection: records_collection,\n                viewsPerRow: 1,\n                childViewOptions: {\n                    referrer: 'invoices'\n                }\n            });\n        }\n    },\n\n    destroy: function() {\n        this.addresses.off(null, null, this);\n        this.paymentmethods.off(null, null, this);\n\n        this.offEventsOfDefaults();\n\n        this._destroy();\n    },\n\n    offEventsOfDefaults: function() {\n        this.defaultPaymentMethod && this.defaultPaymentMethod.off(null, null, this);\n        this.defaultShippingAddress && this.defaultShippingAddress.off(null, null, this);\n    },\n\n    getSelectedMenu: (): string => 'home',\n    getBreadcrumbPages: (): any[] => [],\n    showContent: function() {\n        // off events of defaults\n        this.offEventsOfDefaults();\n\n        // set the defaults\n        this.defaultShippingAddress = this.addresses.findWhere({ defaultshipping: 'T' });\n        this.defaultPaymentMethod = this.paymentmethods.findWhere({ isdefault: 'T' });\n\n        // on events of defaults\n        this.defaultShippingAddress &&\n            this.defaultShippingAddress.on('change', this.showContent, this);\n        this.defaultPaymentMethod && this.defaultPaymentMethod.on('change', this.showContent, this);\n\n        this.title = this.model.get('firstname')\n            ? Utils.translate('Welcome $(0)!', this.model.get('firstname'))\n            : this.title;\n        return this.application.getLayout().showContent(this);\n    }\n});\n\nexport = OverviewHomeStandaloneView;\n"]}
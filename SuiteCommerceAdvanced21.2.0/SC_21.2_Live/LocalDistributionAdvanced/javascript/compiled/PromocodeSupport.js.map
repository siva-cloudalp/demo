{"version":3,"sources":["PromocodeSupport.ts"],"names":[],"mappings":"AAAA;;;;;EAKE;;;IASF,IAAM,gBAAgB,GAAQ;QAC1B,UAAU,EAAE;YACR,sCAAsC;YACtC,qBAAS,CAAC,gBAAgB,CAAC,WAAW,EAAE,UAAS,KAAK;gBAClD,mFAAmF;gBACnF,8DAA8D;gBAC9D,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC,CAAC;gBAE7C,IAAM,SAAS,GAAG,cAAc,CAAC,WAAW,EAAE,CAAC;gBAC/C,IAAM,UAAU,GAAG,SAAS,CAAC,GAAG,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC;gBACrD,IAAM,cAAc,GAAG,UAAU,CAAC,MAAM,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC;gBAC1D,IAAI,GAAG,CAAC;gBAER,kEAAkE;gBAClE,SAAS,CAAC,IAAI,CAAC,EAAE,UAAU,EAAE,cAAc,EAAE,CAAC,CAAC,MAAM,CAAC,SAAS,kBAAkB;oBAC7E,SAAS,CAAC,OAAO,CAAC,kBAAkB,EAAE,SAAS,CAAC,CAAC;gBACrD,CAAC,CAAC,CAAC;gBAEH,GAAG,GAAG,QAAQ,CAAC,OAAO,CAAC,QAAQ;qBAC1B,OAAO,CAAC,aAAa,GAAG,KAAK,EAAE,EAAE,CAAC;qBAClC,OAAO,CAAC,aAAa,GAAG,KAAK,EAAE,EAAE,CAAC,CAAC;gBAExC,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;gBAElE,OAAO,KAAK,CAAC;YACjB,CAAC,CAAC,CAAC;QACP,CAAC;KACJ,CAAC;IACF,OAAS,gBAAgB,CAAC","file":"PromocodeSupport.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"PromocodeSupport\"/>\n\nimport LiveOrderModel = require('../../../Commons/LiveOrder/JavaScript/LiveOrder.Model');\nimport { UrlHelper } from '../../../Commons/UrlHelper/JavaScript/UrlHelper';\n\nimport Backbone = require('../../../Commons/Utilities/JavaScript/backbone.custom');\n\nconst PromocodeSupport: any = {\n    mountToApp: function() {\n        // Method defined in file UrlHelper.js\n        UrlHelper.addTokenListener('promocode', function(value) {\n            // Because this is passed from the URL and there might be spaces and special chars,\n            // we need to fix this so it does not invalidate our promocode\n            value = unescape(value.replace(/[+]/g, ' '));\n\n            const liveorder = LiveOrderModel.getInstance();\n            const promocodes = liveorder.get('promocodes') || [];\n            const new_promocodes = promocodes.concat({ code: value });\n            let url;\n\n            // We get the instance of the ShoppingCart and apply the promocode\n            liveorder.save({ promocodes: new_promocodes }).always(function savePromocodeEnded() {\n                liveorder.trigger('promocodeUpdated', 'applied');\n            });\n\n            url = Backbone.history.fragment\n                .replace('&promocode=' + value, '')\n                .replace('?promocode=' + value, '');\n\n            Backbone.history.navigate(url, { trigger: false, replace: true });\n\n            return false;\n        });\n    }\n};\nexport = PromocodeSupport;\n"]}
{"version":3,"sources":["OrderWizard.Module.ShowPayments.ts"],"names":[],"mappings":"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","file":"OrderWizard.Module.ShowPayments.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"OrderWizard.Module.ShowPayments\"/>\n\nimport * as _ from 'underscore';\nimport * as order_wizard_showpayments_module_tpl from 'order_wizard_showpayments_module.tpl';\nimport { WizardStepModule } from '../../Wizard/JavaScript/Wizard.StepModule';\n\nimport BackboneCollectionView = require('../../../Commons/Backbone.CollectionView/JavaScript/Backbone.CollectionView');\nimport { AddressDetailsView } from '../../../Commons/Address/JavaScript/Address.Details.View';\nimport GlobalViewsFormatPaymentMethodView = require('../../../Commons/GlobalViews/JavaScript/GlobalViews.FormatPaymentMethod.View');\n\n// @class OrderWizard.Module.ShowPayments @extends Wizard.Module\nconst OrderWizardModuleShowPayments: any = WizardStepModule.extend({\n    // @property {Function} template\n    template: order_wizard_showpayments_module_tpl,\n    // @property {String} className\n    className: 'OrderWizard.Module.ShowPayments',\n    // @method initialize\n    initialize: function() {\n        WizardStepModule.prototype.initialize.apply(this, arguments);\n        this.application = this.wizard.application;\n\n        this.profile = this.wizard.options.profile;\n        this.addressSource = this.profile.get('addresses');\n    },\n    // @method getPaymentmethods\n    getPaymentmethods: function() {\n        return _.reject(this.model.get('paymentmethods').models, function(paymentmethod: any) {\n            return paymentmethod.get('type') === 'giftcertificate';\n        });\n    },\n    // @method getGiftCertificates\n    getGiftCertificates: function() {\n        return this.model.get('paymentmethods').where({ type: 'giftcertificate' });\n    },\n    // @method past\n    past: function() {\n        this.model.off('change', this.totalChange, this);\n        this.addressSource.off('change', this.render, this);\n    },\n    // @method present\n    present: function() {\n        this.model.off('change', this.totalChange, this);\n        this.addressSource.off('change', this.render, this);\n\n        this.model.on('change', this.totalChange, this);\n        this.addressSource.on('change', this.render, this);\n    },\n    // @method future\n    future: function() {\n        this.model.off('change', this.totalChange, this);\n        this.addressSource.off('change', this.render, this);\n    },\n    // @method totalChange\n    totalChange: function() {\n        const was = this.model.previous('summary').total;\n        const was_confirmation = this.model.previous('confirmation');\n        const is = this.model.get('summary') && this.model.get('summary').total;\n\n        // Changed from or to 0\n        if (((was === 0 && is !== 0) || (was !== 0 && is === 0)) && !was_confirmation) {\n            this.render();\n        }\n    },\n    // @property {Object} childViews\n    childViews: {\n        'Billing.Address': function() {\n            return new AddressDetailsView({\n                model: this.addressSource.get(this.model.get('billaddress')),\n                hideActions: true,\n                hideDefaults: true,\n                manage: 'billaddress',\n                hideSelector: true\n            });\n        },\n        'GiftCertificates.Collection': function() {\n            return new BackboneCollectionView({\n                collection: this.getGiftCertificates(),\n                viewsPerRow: 1,\n                childView: GlobalViewsFormatPaymentMethodView\n            });\n        },\n        'PaymentMethods.Collection': function() {\n            return new BackboneCollectionView({\n                collection: this.getPaymentmethods(),\n                viewsPerRow: 1,\n                childView: GlobalViewsFormatPaymentMethodView\n            });\n        }\n    },\n    // @method showPayments Indicate if in the rendering process payment method must be shown or not\n    // @return {Boolean}\n    showPayments: function(): boolean {\n        if (this.options.hidePayment) {\n            return false;\n        }\n        return !!(\n            this.getGiftCertificates().length ||\n            this.getPaymentmethods().length ||\n            !this.wizard.hidePayment()\n        );\n    },\n    // @method getContext\n    // @returns {OrderWizard.Module.ShowPayments.Context}\n    getContext: function() {\n        const billing_address = this.addressSource.get(this.model.get('billaddress'));\n        const giftcertificates = this.getGiftCertificates();\n        const edit_url_billing = _.isFunction(this.options.edit_url_billing)\n            ? this.options.edit_url_billing.apply(this)\n            : this.options.edit_url_billing;\n\n        // @class OrderWizard.Module.ShowPayments.Context\n        return {\n            // @property {Boolean} showBilling\n            showBilling: !this.options.hideBilling,\n            // @property {Boolean} showBillingAddress\n            showBillingAddress: !!billing_address,\n            // @property {Boolean} showEditBillingButton\n            showEditBillingButton: !!(billing_address && edit_url_billing),\n            // @property {String} editBillingUrl\n            editBillingUrl: edit_url_billing,\n            // @property {Boolean} showPayments\n            showPayments: this.showPayments(),\n            // @property {Boolean} showGuestEmail\n            showGuestEmail: this.profile.get('isGuest') === 'T',\n            // @property {String} guestEmail\n            guestEmail: this.profile.get('email'),\n            // @property {Boolean} showGiftcertificates\n            showGiftcertificates: !!giftcertificates.length\n        };\n    }\n});\n\nexport = OrderWizardModuleShowPayments;\n"]}
{"version":3,"sources":["OrderWizard.Module.RegisterEmail.ts"],"names":[],"mappings":"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","file":"OrderWizard.Module.RegisterEmail.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"OrderWizard.Module.RegisterEmail\"/>\n/// <reference path=\"../../../Commons/Utilities/JavaScript/UnderscoreExtended.d.ts\" />\n\nimport * as order_wizard_registeremail_module_tpl from 'order_wizard_registeremail_module.tpl';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\nimport { WizardStepModule } from '../../Wizard/JavaScript/Wizard.StepModule';\nimport { ProfileModel } from '../../../Commons/Profile/JavaScript/Profile.Model';\n\nimport Backbone = require('../../../Commons/Utilities/JavaScript/backbone.custom');\n\nexport = WizardStepModule.extend({\n    template: order_wizard_registeremail_module_tpl,\n\n    className: 'OrderWizard.Module.RegisterEmail',\n\n    invalidEmailErrorMessage: {\n        errorCode: 'ERR_CHK_INVALID_EMAIL',\n        errorMessage: Utils.translate('Invalid email address')\n    },\n\n    errors: ['ERR_CHK_INVALID_EMAIL'],\n\n    render: function() {\n        if (!this.isActive()) {\n            return this.$el.empty();\n        }\n\n        this._render();\n\n        if (this.profileModel.get('email') && this.wizard.isPaypalComplete()) {\n            this.trigger('ready', true);\n        }\n    },\n\n    initialize: function() {\n        this.profileModel = ProfileModel.getInstance();\n        WizardStepModule.prototype.initialize.apply(this, arguments);\n    },\n\n    submit: function() {\n        const fake_promise = jQuery.Deferred();\n        const self = this;\n        const email = this.$('input[name=email]').val();\n        const emailsubscribe = this.$('input[name=sign-up-newsletter]').is(':checked') ? 'T' : 'F';\n\n        // if the module is not active or if the module is active and not change the current values we just resolve the promise\n        if (\n            !this.isActive() ||\n            (this.isActive() &&\n                this.profileModel.get('email') === email &&\n                this.profileModel.get('emailsubscribe') === emailsubscribe)\n        ) {\n            return this.isValid();\n        }\n\n        this.profileModel.set({\n            email: email,\n            confirm_email: email\n        });\n\n        this.isValid().then(\n            function() {\n                self.profileModel\n                    .set({\n                        emailsubscribe: emailsubscribe,\n                        skipLoginDontUpdateProfile: ['email', 'confirm_email', 'emailsubscribe']\n                    })\n                    .save()\n                    .then(\n                        function() {\n                            self.profileModel.unset('skipLoginDontUpdateProfile', { silent: true });\n                            self.render();\n                            fake_promise.resolve();\n                        },\n                        function(message) {\n                            fake_promise.reject(message);\n                        }\n                    );\n            },\n            function(message) {\n                fake_promise.reject(message);\n            }\n        );\n\n        return fake_promise;\n    },\n\n    isValid: function(): any {\n        const promise = jQuery.Deferred();\n\n        if ((<any>Backbone).Validation.patterns.email.test(this.profileModel.get('email'))) {\n            return promise.resolve();\n        }\n\n        return promise.reject(this.invalidEmailErrorMessage);\n    },\n\n    showError: function() {\n        this.$('.control-group').removeClass('error');\n        this.$('.control-group').addClass('error');\n        WizardStepModule.prototype.showError.apply(this, arguments);\n    },\n\n    isActive: function(): boolean {\n        const configuration = this.wizard.application.getConfig();\n        const checkoutConfig = configuration.checkout || {};\n        return (\n            (this.profileModel.get('isGuest') === 'T' ||\n                (this.profileModel.get('isGuest') === 'F' &&\n                    this.profileModel.get('isLoggedIn') === 'F' &&\n                    this.profileModel.get('isRecognized') === 'F')) &&\n            (checkoutConfig.skipLogin || !configuration.forms.loginAsGuest.showEmail)\n        );\n    },\n\n    // @method getContext\n    // @return {OrderWizard.Module.RegisterEmail.Context}\n    getContext: function() {\n        // @class OrderWizard.Module.RegisterEmail.Context\n        return {\n            // @property {String} email\n            email: this.profileModel.get('email') || '',\n            // @property {Boolean} isEmailSubcribe\n            isEmailSubcribe: this.profileModel.get('emailsubscribe') === 'T'\n        };\n    }\n});\n"]}
{"version":3,"sources":["OrderHistory.Summary.View.ts"],"names":[],"mappings":"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","file":"OrderHistory.Summary.View.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"OrderHistory.Summary.View\"/>\n\nimport * as _ from 'underscore';\nimport * as order_history_summary_tpl from 'order_history_summary.tpl';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport { Configuration } from '../../SCA/JavaScript/Configuration';\n\nimport CancelView = require('./OrderHistory.Cancel.View');\nimport ReturnAuthorizationGetReturnableLines = require('../../ReturnAuthorization/JavaScript/ReturnAuthorization.GetReturnableLines');\nimport CartPromocodeListView = require('../../../Commons/Cart/JavaScript/Cart.Promocode.List.View');\nimport BackboneView = require('../../../Commons/BackboneExtras/JavaScript/Backbone.View');\n\n// @class OrderHistory.Summary.View @extend Backbone.View\nconst OrderHistorySummaryView: any = BackboneView.extend({\n    // @property {Function} template\n    template: order_history_summary_tpl,\n\n    events: {\n        'click [data-action=\"cancel\"]': 'cancel'\n    },\n\n    initialize: function(options) {\n        this.any_line_purchasable = this.isAnyLinePurchasable();\n        this.all_gift_certificates = this.isAllGiftCertificates();\n        this.show_request_return_button = options.show_request_return_button;\n        this.pdfUrl = options.pdfUrl;\n        this.isBasic = options.is_basic;\n        this.application = options.application;\n    },\n\n    // @method cancel\n    cancel: function() {\n        new CancelView({\n            application: this.application,\n            model: this.model\n        }).showInModal('order');\n    },\n\n    // @method isAnyLinePurchasable\n    isAnyLinePurchasable: function() {\n        if (!this.any_line_purchasable) {\n            this.any_line_purchasable = this.model.get('lines').any(function(line) {\n                return line.get('item').get('_isPurchasable');\n            });\n        }\n\n        return this.any_line_purchasable;\n    },\n\n    // @method getPaidByTerms\n    getPaidByTerms: function() {\n        let terms_id = 0;\n        this.model.get('paymentmethods').each(function(model) {\n            terms_id = model.get('paymentterms') && model.get('paymentterms').internalid;\n        });\n\n        return terms_id;\n    },\n\n    // @method getDownloadPdfUrl @returns {String}\n    getDownloadPdfUrl: function() {\n        let pdfUrl = '';\n        switch (this.model.get('recordtype')) {\n            case 'cashsale':\n                pdfUrl = Utils.getDownloadPdfUrl({\n                    asset: 'cash-sale-details',\n                    id: this.model.get('internalid')\n                });\n                break;\n            case 'salesorder':\n                pdfUrl = Utils.getDownloadPdfUrl({\n                    asset: 'order-details',\n                    id: this.model.get('internalid')\n                });\n                break;\n            case 'invoice':\n                pdfUrl = Utils.getDownloadPdfUrl({\n                    asset: 'invoice-details',\n                    id: this.model.get('internalid')\n                });\n                break;\n        }\n\n        return pdfUrl;\n    },\n\n    // @method isReturnable indicates if the order accepts returns or not\n    isReturnable: function() {\n        if (_.isUndefined(this.isReturnable)) {\n            const not_consider_fulfillments = this.model.get('recordtype') !== 'salesorder';\n            const returnable_calculator = new ReturnAuthorizationGetReturnableLines(this.model, {\n                notConsiderFulfillments: not_consider_fulfillments\n            });\n\n            this.isReturnable = !!(\n                this.model.get('isReturnable') &&\n                returnable_calculator.calculateLines().validLines.length\n            );\n        }\n\n        return this.isReturnable;\n    },\n\n    // @method isAllGiftCertificates\n    isAllGiftCertificates: function() {\n        if (!this.all_gift_certificates) {\n            this.all_gift_certificates = this.model.get('lines').all(function(line) {\n                return line.get('item').get('itemtype') === 'GiftCert';\n            });\n        }\n\n        return this.all_gift_certificates;\n    },\n\n    childViews: {\n        CartPromocodeListView: function() {\n            return new CartPromocodeListView({\n                model: this.model,\n                isReadOnly: true\n            });\n        }\n    },\n\n    // @method getContext @return OrderHistory.Summary.View.Context\n    getContext: function() {\n        const invoice_model = this.model.get('receipts').findWhere({ recordtype: 'invoice' });\n        const have_terms = this.getPaidByTerms();\n\n        // @class OrderHistory.Summary.View.Context\n        return {\n            // @property {OrderHistory.Model} model\n            model: this.model,\n            // @property {Boolean} showReorderAllItemsButton\n            showReorderAllItemsButton:\n                this.application.isReorderEnabled() &&\n                this.any_line_purchasable &&\n                !this.all_gift_certificates,\n            // @property {Array} showSummaryDiscount\n            showSummaryDiscount: !!this.model.get('summary').discounttotal,\n            // @property {Boolean} showSummaryShippingCost\n            showSummaryShippingCost: !!this.model.get('summary').shippingcost,\n            // @property {Boolean} showSummaryPickupCost\n            showSummaryPickupCost: !!this.model.get('lines').where({ linegroup: 'instore' }).length,\n            // @property {Boolean} showSummaryHandlingCost\n            showSummaryHandlingCost: !!this.model.get('summary').handlingcost,\n            // @property {Boolean} showSummaryGiftCertificateTotal\n            showSummaryGiftCertificateTotal: !!this.model.get('summary').giftcertapplied,\n            // @property {Boolean} showSummaryPromocode\n            showSummaryPromocode: !!(\n                this.model.get('promocodes') && this.model.get('promocodes').length\n            ),\n            // @property {Boolean} showViewInvoiceButton\n            showViewInvoiceButton: !!invoice_model && !this.isBasic && !!have_terms,\n            // @property {Object} invoiceModel\n            invoiceModel: invoice_model,\n            // @property {String} pdfUrl\n            pdfUrl: this.getDownloadPdfUrl(),\n            // @property {Boolean} showRequestReturnButton\n            showRequestReturnButton: this.isReturnable(),\n            // @property {Boolean} showCancelButton\n            showCancelButton: this.model.get('isCancelable'),\n            // @property {String} taxLabel\n            taxLabel: Configuration.get('summaryTaxLabel')\n                ? Configuration.get('summaryTaxLabel')\n                : 'Tax'\n        };\n    }\n});\n\nexport = OrderHistorySummaryView;\n"]}
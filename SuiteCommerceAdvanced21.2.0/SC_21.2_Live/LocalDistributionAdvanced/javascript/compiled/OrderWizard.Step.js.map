{"version":3,"sources":["OrderWizard.Step.ts"],"names":[],"mappings":"AAAA;;;;;EAKE;;;IAiBF,iGAAiG;IACjG,IAAM,eAAe,GAAQ,UAAU,CAAC,MAAM,CAAC;QAC3C,kCAAkC;QAClC,UAAU,EAAE,CAAC,6BAAa,CAAC,GAAG,CAAC,yBAAyB,CAAC,CAAC,CAAC,CAAC,oBAAoB,CAAC,CAAC,CAAC,KAAK;QACxF,kCAAkC;QAClC,UAAU,EAAE,CAAC,6BAAa,CAAC,GAAG,CAAC,yBAAyB,CAAC,CAAC,CAAC,CAAC,6CAAoB,CAAC,CAAC,CAAC,KAAK;QACxF,gCAAgC;QAChC,QAAQ,EAAE,qBAAqB;QAC/B,sBAAsB;QACtB,WAAW,EAAE;YACT,IAAI,IAAI,CAAC,kBAAkB,EAAE,EAAE;gBAC3B,OAAO,IAAI,CAAC,WAAW,EAAE,IAAI,IAAI,CAAC,MAAM,CAAC,gBAAgB,EAAE,CAAC;aAC/D;YACD,OAAO,KAAK,CAAC;QACjB,CAAC;QAED,qBAAqB;QACrB,UAAU,EAAE;YACR,UAAU,CAAC,SAAS,CAAC,UAAU,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;QAC3D,CAAC;QAED,SAAS,EAAE,SAAS,SAAS,CAAC,MAAM;YAChC,IAAM,IAAI,GAAG,IAAI,CAAC;YAClB,IAAM,IAAI,GAAG,SAAS,CAAC;YACvB,IAAM,YAAY,GAAG,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC;YAClD,IAAM,UAAU,GAAG;gBACf,eAAe,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI;gBACpC,QAAQ,EAAE,IAAI,CAAC,QAAQ;gBACvB,MAAM,EAAE,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,EAAE,EAAE,CAAC;aACpD,CAAC;YAEF,IAAI,CAAC,CAAC,UAAU,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE;gBACpC,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;gBAClD,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,SAAS;oBAC1B,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,QAAQ;wBACvC,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC;aACpD;YAED,OAAO,YAAY;iBACd,iBAAiB,CAAC,kCAAkC,EAAE,UAAU,CAAC;iBACjE,IAAI,CAAC;gBACF,UAAU,CAAC,SAAS,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;gBAEjD,YAAY,CAAC,iBAAiB,CAAC,iCAAiC,EAAE,UAAU,CAAC,CAAC;YAClF,CAAC,CAAC,CAAC;QACX,CAAC;QAED,MAAM,EAAE,SAAS,MAAM;YACnB,IAAM,IAAI,GAAG,IAAI,CAAC;YAClB,IAAM,IAAI,GAAG,SAAS,CAAC;YACvB,IAAM,YAAY,GAAG,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC;YAClD,IAAM,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC,cAAc,EAAE,CAAC;YAEnD,OAAO,YAAY;iBACd,iBAAiB,CAAC,+BAA+B,EAAE,aAAa,CAAC;iBACjE,IAAI,CAAC;gBACF,OAAO,UAAU,CAAC,SAAS,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;YACzD,CAAC,CAAC;iBACD,IAAI,CAAC,UAAS,KAAK;gBAChB,IAAM,eAAe,GAAG,MAAM,CAAC,8CAA8C,CAAC,CAAC;gBAC/E,IAAM,sBAAsB,GAAG,eAAe,CAAC,OAAO,CAAC,uBAAuB,CAAC,CAAC;gBAEhF,IAAI,sBAAsB,CAAC,MAAM,EAAE;oBAC/B,KAAK,CAAC,cAAc,CAAC,sBAAsB,CAAC,CAAC,CAAC,CAAC,CAAC;iBACnD;YACL,CAAC,CAAC,CAAC;QACX,CAAC;QAED,OAAO,EAAE,SAAS,OAAO;YACrB,IAAM,IAAI,GAAG,IAAI,CAAC;YAClB,IAAM,IAAI,GAAG,SAAS,CAAC;YAEvB,OAAO,UAAU,CAAC,SAAS,CAAC,OAAO;iBAC9B,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC;iBACjB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;iBACjB,IAAI,CAAC,SAAS,IAAI,CAAC,KAAK;gBACrB,OAAO;oBACH,KAAK,EAAE,KAAK;oBACZ,QAAQ,EAAE,IAAI,CAAC,QAAQ;iBAC1B,CAAC;YACN,CAAC,CAAC,CAAC;QACX,CAAC;QAED,YAAY,EAAE,SAAS,YAAY;YAC/B,IAAM,IAAI,GAAG,IAAI,CAAC;YAClB,IAAM,IAAI,GAAG,SAAS,CAAC;YACvB,IAAM,YAAY,GAAG,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC;YAClD,IAAM,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC,kBAAkB,EAAE,CAAC;YAEvD,OAAO,YAAY;iBACd,iBAAiB,CAAC,qCAAqC,EAAE,aAAa,CAAC;iBACvE,IAAI,CAAC;gBACF,OAAO,UAAU,CAAC,SAAS,CAAC,YAAY,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;YAC/D,CAAC,CAAC,CAAC;QACX,CAAC;QAED,aAAa,EAAE,SAAS,aAAa;YACjC,IAAM,IAAI,GAAG,IAAI,CAAC;YAClB,IAAM,IAAI,GAAG,SAAS,CAAC;YAEvB,OAAO,UAAU,CAAC,SAAS,CAAC,aAAa;iBACpC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC;iBACjB,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,SAAS,IAAI,CAAC,KAAK;gBAClC,OAAO;oBACH,KAAK,EAAE,KAAK;oBACZ,QAAQ,EAAE,IAAI,CAAC,QAAQ;iBAC1B,CAAC;YACN,CAAC,CAAC,CAAC;QACX,CAAC;QAED,iBAAiB;QACjB,MAAM,EAAE;YAAS,cAAO;iBAAP,UAAO,EAAP,qBAAO,EAAP,IAAO;gBAAP,yBAAO;;YACpB,IAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC;YAEnD,IAAI,CAAC,YAAY,GAAG,4BAAY,CAAC,WAAW,EAAE,CAAC;YAE/C,UAAU,CAAC,SAAS,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;YAEtC,IAAA,WAAW,GAAK,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,SAAS,EAAE,YAAxC,CAAyC;YAC5D,IACI,IAAI,CAAC,MAAM,CAAC,kBAAkB,EAAE,IAAI,yBAAyB;gBAC7D,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,YAAY,CAAC,KAAK,GAAG,IAAI,kDAAkD;gBACjG,WAAW,CAAC,SAAS,EACvB;gBACE,IAAM,OAAO,GAAG,KAAK,CAAC,SAAS,CAC3B,4TAA4T,CAC/T,CAAC;gBACF,IAAM,mBAAmB,GAAG,IAAI,iDAAsB,CAAC;oBACnD,OAAO,EAAE,OAAO;oBAChB,IAAI,EAAE,MAAM;oBACZ,QAAQ,EAAE,IAAI;iBACjB,CAAC,CAAC;gBAEH,IAAI,CAAC,CAAC,CAAC,oCAAoC,CAAC;qBACvC,KAAK,EAAE;qBACP,MAAM,CAAC,mBAAmB,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC;aACxD;YAED,IAAI,IAAI,CAAC,MAAM,CAAC,WAAW,KAAK,cAAc,EAAE;gBAC5C,OAAO,CAAC,WAAW,EAAE,CAAC,4BAA4B,CAC9C,IAAI,CAAC,MAAM,CAAC,eAAe,EAAE,CAAC,YAAY,GAAG,CAAC,CACjD,CAAC;aACL;YAED,uFAAuF;YACvF,MAAM,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;QAClC,CAAC;QACD,uDAAuD;QACvD,UAAU,EAAE;YACR,kCAAkC;YAClC,OAAO;gBACH,gCAAgC;gBAChC,SAAS,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE;gBAC3B,2BAA2B;gBAC3B,KAAK,EAAE,IAAI,CAAC,OAAO,EAAE;gBACrB,yCAAyC;gBACzC,kBAAkB,EAAE,CAAC,IAAI,CAAC,kBAAkB;gBAC5C,yCAAyC;gBACzC,mBAAmB,EAAE,IAAI,CAAC,sBAAsB,EAAE,IAAI,EAAE;gBACxD,sDAAsD;gBACtD,+BAA+B,EAAE,CAAC,CAAC,IAAI,CAAC,+BAA+B;gBACvE,qCAAqC;gBACrC,cAAc,EAAE,CAAC,CAAC,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,MAAM,CAAC,kBAAkB,EAAE,CAAC;gBAC1E,wCAAwC;gBACxC,iBAAiB,EAAE,CAAC,CAAC,IAAI,CAAC,aAAa;gBACvC,mCAAmC;gBACnC,aAAa,EAAE,CAAC,CAAC,UAAU,CAAC,IAAI,CAAC,aAAa,CAAC;oBAC3C,CAAC,CAAC,IAAI,CAAC,aAAa,EAAE;oBACtB,CAAC,CAAC,IAAI,CAAC,aAAa,IAAI,EAAE;gBAC9B,wCAAwC;gBACxC,kBAAkB,EAAE,CAAC,CAAC,UAAU,CAAC,IAAI,CAAC,kBAAkB,CAAC;oBACrD,CAAC,CAAC,IAAI,CAAC,kBAAkB,EAAE;oBAC3B,CAAC,CAAC,IAAI,CAAC,kBAAkB,IAAI,EAAE;aACtC,CAAC;QACN,CAAC;KACJ,CAAC,CAAC;IAEH,OAAS,eAAe,CAAC","file":"OrderWizard.Step.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"OrderWizard.Step\"/>\n\nimport * as _ from 'underscore';\nimport * as order_wizard_step_tpl from 'order_wizard_step.tpl';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\nimport { FooterSimplifiedView } from '../../Footer/JavaScript/Footer.Simplified.View';\nimport { Configuration } from '../../SCA/JavaScript/Configuration';\nimport { GlobalViewsMessageView } from '../../../Commons/GlobalViews/JavaScript/GlobalViews.Message.View';\nimport { ProfileModel } from '../../../Commons/Profile/JavaScript/Profile.Model';\n\nimport WizardStep = require('../../Wizard/JavaScript/Wizard.Step');\nimport HeaderSimplifiedView = require('../../Header/JavaScript/Header.Simplified.View');\nimport Tracker = require('../../../Commons/Tracker/JavaScript/Tracker');\n\n// @class OrderWizard.Step Step View, Renders all the components of the Step @extends Wizard.Step\nconst OrderWizardStep: any = WizardStep.extend({\n    // @property {Function} headerView\n    headerView: !Configuration.get('useStandardHeaderFooter') ? HeaderSimplifiedView : false,\n    // @property {Function} footerView\n    footerView: !Configuration.get('useStandardHeaderFooter') ? FooterSimplifiedView : false,\n    // @property {Function} template\n    template: order_wizard_step_tpl,\n    // @method stepAdvance\n    stepAdvance: function() {\n        if (this.areAllModulesReady()) {\n            return this.isStepReady() || this.wizard.isPaypalComplete();\n        }\n        return false;\n    },\n\n    // @method initialize\n    initialize: function() {\n        WizardStep.prototype.initialize.apply(this, arguments);\n    },\n\n    addModule: function addModule(module) {\n        const self = this;\n        const args = arguments;\n        const order_wizard = this.wizard.orderWizardModel;\n        const event_data = {\n            step_group_name: self.stepGroup.name,\n            step_url: self.step_url,\n            module: _.isArray(module) ? module : [module, {}]\n        };\n\n        if (_.isFunction(event_data.module[0])) {\n            event_data.module[1] = event_data.module[1] || {};\n            event_data.module[1].module_id =\n                event_data.module[0].prototype.template &&\n                event_data.module[0].prototype.template.Name;\n        }\n\n        return order_wizard\n            .cancelableTrigger('before:OrderWizardStep.addModule', event_data)\n            .done(function() {\n                WizardStep.prototype.addModule.apply(self, args);\n\n                order_wizard.cancelableTrigger('after:OrderWizardStep.addModule', event_data);\n            });\n    },\n\n    submit: function submit() {\n        const self = this;\n        const args = arguments;\n        const order_wizard = this.wizard.orderWizardModel;\n        const next_step_url = this.wizard.getNextStepUrl();\n\n        return order_wizard\n            .cancelableTrigger('before:OrderWizardStep.submit', next_step_url)\n            .then(function() {\n                return WizardStep.prototype.submit.apply(self, args);\n            })\n            .fail(function(jqXhr) {\n                const error_container = jQuery('[data-type=\"alert-placeholder-module\"]:first');\n                const error_container_parent = error_container.parents('.module-rendered:last');\n\n                if (error_container_parent.length) {\n                    Utils.animatedScroll(error_container_parent[0]);\n                }\n            });\n    },\n\n    _submit: function _submit() {\n        const self = this;\n        const args = arguments;\n\n        return WizardStep.prototype._submit\n            .apply(self, args)\n            .then(jQuery.noop)\n            .fail(function fail(error) {\n                return {\n                    error: error,\n                    step_url: self.step_url\n                };\n            });\n    },\n\n    previousStep: function previousStep() {\n        const self = this;\n        const args = arguments;\n        const order_wizard = this.wizard.orderWizardModel;\n        const prev_step_url = this.wizard.getPreviousStepUrl();\n\n        return order_wizard\n            .cancelableTrigger('before:OrderWizardStep.previousStep', prev_step_url)\n            .then(function() {\n                return WizardStep.prototype.previousStep.apply(self, args);\n            });\n    },\n\n    _previousStep: function _previousStep() {\n        const self = this;\n        const args = arguments;\n\n        return WizardStep.prototype._previousStep\n            .apply(self, args)\n            .then(jQuery.noop, function fail(error) {\n                return {\n                    error: error,\n                    step_url: self.step_url\n                };\n            });\n    },\n\n    // @method render\n    render: function(...args) {\n        const layout = this.wizard.application.getLayout();\n\n        this.profileModel = ProfileModel.getInstance();\n\n        WizardStep.prototype.render.apply(this, args);\n\n        const { checkoutApp } = this.wizard.application.getConfig();\n        if (\n            this.wizard.isCurrentStepFirst() && // only in the first step\n            this.profileModel.get('isLoggedIn') === 'F' && // only if the user doesn't already have a session\n            checkoutApp.skipLogin\n        ) {\n            const message = Utils.translate(\n                '<p>Checking out as a Guest. Using an account, you will enjoy a faster checkout experience.<p><a href=\"login\" data-toggle=\"show-in-modal\" data-id=\"skip-login-modal\">Login</a><a class=\"order-wizard-step-skip-login-register\" href=\"register\" data-toggle=\"show-in-modal\" data-id=\"skip-login-register-modal\">Register</a>'\n            );\n            const global_view_message = new GlobalViewsMessageView({\n                message: message,\n                type: 'info',\n                closable: true\n            });\n\n            this.$('[data-action=\"skip-login-message\"]')\n                .empty()\n                .append(global_view_message.render().$el.html());\n        }\n\n        if (this.wizard.currentStep !== 'confirmation') {\n            Tracker.getInstance().trackPageviewForCheckoutStep(\n                this.wizard.getStepPosition().fromBegining + 2\n            );\n        }\n\n        // Also trigger the afterRender event so the site search module can load the typeahead.\n        layout.trigger('afterRender');\n    },\n    // @method getContext @returns OrderWizard.Step.Context\n    getContext: function() {\n        // @class OrderWizard.Step.Context\n        return {\n            // @property {Boolean} showTitle\n            showTitle: !!this.getName(),\n            // @property {String} title\n            title: this.getName(),\n            // @property {Boolean} showContinueButton\n            showContinueButton: !this.hideContinueButton,\n            // @property {String} continueButtonLabel\n            continueButtonLabel: this.getContinueButtonLabel() || '',\n            // @property {Boolean} showSecondContinueButtonOnPhone\n            showSecondContinueButtonOnPhone: !!this.hideSecondContinueButtonOnPhone,\n            // @property {Boolean} showBackButton\n            showBackButton: !(this.hideBackButton || this.wizard.isCurrentStepFirst()),\n            // @property {Boolean} showBottomMessage\n            showBottomMessage: !!this.bottomMessage,\n            // @property {String} bottomMessage\n            bottomMessage: _.isFunction(this.bottomMessage)\n                ? this.bottomMessage()\n                : this.bottomMessage || '',\n            // @property {String} bottomMessageClass\n            bottomMessageClass: _.isFunction(this.bottomMessageClass)\n                ? this.bottomMessageClass()\n                : this.bottomMessageClass || ''\n        };\n    }\n});\n\nexport = OrderWizardStep;\n"]}
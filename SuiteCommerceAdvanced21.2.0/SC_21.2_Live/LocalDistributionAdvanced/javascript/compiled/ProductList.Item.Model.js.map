{"version":3,"sources":["ProductList.Item.Model.ts"],"names":[],"mappings":"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","file":"ProductList.Item.Model.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"ProductList.Item.Model\"/>\n\nimport * as _ from 'underscore';\nimport * as Utils from '../../Utilities/JavaScript/Utils';\n\nimport ProductModel = require('../../Product/JavaScript/Product.Model');\nimport Item = require('../../Item/JavaScript/Item.Model');\nimport Backbone = require('../../../Commons/Utilities/JavaScript/backbone.custom');\n\nfunction validateLength(value, name) {\n    const max_length = 300;\n\n    if (value && value.length > max_length) {\n        return Utils.translate('$(0) must be at most $(1) characters', name, max_length);\n    }\n}\n\n// @class ProductList.Item.Model @extends Product.Model\nconst ProductListItemModel = ProductModel.extend(\n    {\n        urlRoot: Utils.getAbsoluteUrl('services/ProductList.Item.Service.ss'),\n\n        defaults: {\n            priority: { id: '2', name: 'medium' },\n            options: ''\n        },\n\n        // Name is required\n        validation: _.extend({}, ProductModel.prototype.validation, {\n            name: {\n                required: true,\n                msg: Utils.translate('Name is required')\n            },\n            description: { fn: validateLength }\n        }),\n\n        className: 'ProductList.Item.Model',\n\n        // redefine url to avoid possible cache problems from browser\n        url: function () {\n            const base_url = Backbone.Model.prototype.url.apply(this, arguments);\n            const product_list = this.get('productList');\n            const url_params: any = {\n                t: new Date().getTime()\n            };\n\n            if (product_list && product_list.owner) {\n                url_params.user = product_list.owner;\n            }\n\n            return Utils.addParamsToUrl(base_url, url_params);\n        },\n\n        // @method initialize Overrides default method because in vinson optional item options with undefined value\n        // were not accepted and now they are.\n        // @constructor\n        initialize: function (attributes) {\n            // This workaround is made to maintain the compatility with product lists saving the child item in the record\n            if (attributes && attributes.item && attributes.item.matrix_parent) {\n                attributes.item = _.extend(attributes.item, attributes.item.matrix_parent);\n                delete attributes.item.matrix_parent;\n            }\n\n            const item_aux = new Item(attributes.item);\n            const item_options = item_aux.get('options');\n\n            item_options.each(function (item_option, i) {\n                const option: any = _.findWhere(attributes.options, {\n                    cartOptionId: item_option.get('cartOptionId')\n                });\n\n                if (!option) {\n                    attributes.options.push(item_option.toJSON());\n                } else if (_.isObject(option.value) && _.isEmpty(option.value)) {\n                    attributes.options[i] = item_option.toJSON();\n                }\n            });\n\n            ProductModel.prototype.initialize.apply(this, arguments);\n        },\n\n        // @method getOptionsArray Returns options as an array. This is the way ItemDetailModel expects when initialized. @return {Array<Object>}\n        getOptionsArray: function () {\n            // Iterate on the stored Product List Item options and create an id/value object compatible with the existing options renderer...\n            const option_values = [];\n            const selected_options = this.get('options');\n\n            _.each(selected_options, function (value: any, key) {\n                option_values.push({\n                    id: key,\n                    value: value.value,\n                    displayvalue: value.displayvalue\n                });\n            });\n\n            return option_values;\n        },\n\n        // @method fulfillsMinimumQuantityRequirement Returns true if a product can be purchased due to minimum quantity requirements. @returns {Boolean}\n        fulfillsMinimumQuantityRequirement: function () {\n            return this.get('item').get('_minimumQuantity') <= this.get('quantity');\n        },\n\n        fulfillsMaximumQuantityRequirement: function () {\n            return this.get('item').get('_maximumQuantity')\n                ? this.get('item').get('_maximumQuantity') >= this.get('quantity')\n                : true;\n        },\n\n        // @method getItemForCart Gets the ProductModel for the cart options_details should be passed together with options values,\n        // otherwise they will not be validated and not set!!!\n        // @return {internalid:String,quantity:Number,options:Object,options:Object}\n        getItemForCart: function (id, qty, options_details, options) {\n            return new ProductModel({\n                internalid: id,\n                quantity: qty,\n                _optionsDetails: options_details,\n                options: options\n            });\n        },\n\n        // @method getMatrixItem Gets the subitem which properties has the values passed as parameters\n        // @return matrix subitem model\n        getMatrixItem: function (optionsSelected, optionsAvailable) {\n            const objSearch = {};\n            _.each(_.keys(optionsSelected), function (option) {\n                const optionName = (<any>_.findWhere(optionsAvailable, { cartOptionId: option }))\n                    .itemOptionId;\n                objSearch[optionName] = optionsSelected[option].label;\n            });\n            return _.findWhere(this.item.matrixchilditems_detail, objSearch);\n        },\n\n        // @method isMatrixChild\n        // @return true if this item is matrix\n        isMatrixChild: function () {\n            return !!(this.item && this.item.matrix_parent && this.item.itemoptions_detail);\n        },\n\n        clone: function clone() {\n            return new ProductListItemModel(this.toJSON());\n        },\n\n        toJSON: function toJSON() {\n            const result = ProductModel.prototype.toJSON.apply(this, arguments);\n            const self = this;\n\n            result.description = this.get('description');\n            result.productList = this.get('productList');\n            result.priority = this.get('priority');\n            result.created = this.get('created');\n            result.createddate = this.get('createddate');\n            result.lastmodified = this.get('lastmodified');\n            result.item.internalid = this.getItem().get('internalid');\n\n            _.each(result.options, function (option: any) {\n                const opt = self.get('options').findWhere({ cartOptionId: option.cartOptionId });\n                option.values = opt && opt.get('values');\n            });\n\n            return result;\n        },\n\n        getItemId: function () {\n            // We override this method from the Product.Model so when generating the JSON representation of this model\n            // we always return the parent item id\n            return this.get('item').get('internalid');\n        }\n    },\n    {\n        // @method createFromProduct\n        // @param {Product.Model} product\n        // @return {ProductList.Item.Model}\n        createFromProduct: function (product) {\n            const attributes = product.toJSON();\n\n            delete attributes.internalid;\n\n            _.each(attributes.options, function (option: any) {\n                option.values = product\n                    .get('options')\n                    .findWhere({ cartOptionId: option.cartOptionId })\n                    .get('values');\n            });\n\n            attributes.item = product.get('item').toJSON();\n\n            return new ProductListItemModel(attributes);\n        },\n\n        // @method createFromProduct\n        // @param {Product.Model} product\n        // @return {ProductList.Item.Model}\n        createFromTransactionLine: function (transaction_line) {\n            const attributes = transaction_line.toJSON();\n\n            delete attributes.internalid;\n\n            _.each(attributes.options, function (option: any) {\n                option.values = transaction_line\n                    .get('options')\n                    .findWhere({ cartOptionId: option.cartOptionId })\n                    .get('values');\n            });\n\n            return new ProductListItemModel(attributes);\n        }\n    }\n);\n\nexport = ProductListItemModel;\n"]}
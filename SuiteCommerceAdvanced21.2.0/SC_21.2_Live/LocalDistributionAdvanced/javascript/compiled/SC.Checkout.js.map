{"version":3,"sources":["SC.Checkout.ts"],"names":[],"mappings":"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","file":"SC.Checkout.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"SC.Checkout\"/>\n\nimport * as _ from 'underscore';\n\nimport '../../../Commons/BackboneExtras/JavaScript/Backbone.Model';\nimport '../../../Commons/BackboneExtras/JavaScript/Backbone.Sync';\nimport '../../../Commons/Core/JavaScript/backbone/BackboneExtras';\nimport '../../../Commons/BackboneExtras/JavaScript/Backbone.View';\nimport '../../../Commons/BackboneExtras/JavaScript/Backbone.View.render';\nimport '../../../Commons/BackboneExtras/JavaScript/Backbone.View.saveForm';\nimport '../../../Commons/BackboneExtras/JavaScript/Backbone.View.toggleReset';\nimport '../../../Commons/BootstrapExtras/JavaScript/Bootstrap.Slider';\nimport '../../../Commons/NativesExtras/JavaScript/String.format';\nimport { jQuery } from '../../jQuerySCAExtras/JavaScript/jQuerySCAExtras';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport { ApplicationOnline } from '../../SCA/JavaScript/ApplicationOnline';\nimport { CheckoutLayout } from './SC.Checkout.Layout';\nimport { CheckoutStepsFactory } from './CheckoutStepsFactory';\n\nimport Configuration = require('./SC.Checkout.Configuration');\nimport Session = require('../../../Commons/Session/JavaScript/Session');\n\n/* !\n * Description: SuiteCommerce Reference Checkout\n *\n * @copyright (c) 2000-2013, NetSuite Inc.\n * @version 1.0\n */\n\n// Application.js\n// --------------\n// Extends the application with Checkout specific core methods\n\nexport class Checkout extends ApplicationOnline {\n    private appPromise: any = jQuery.Deferred();\n    protected static instance: Checkout;\n\n    private constructor() {\n        super();\n        this.layout = new CheckoutLayout(this);\n        this.configuration = Configuration.get();\n        // This is only to avoid break extensions in 20.2 release. Should be deleted asap\n        this.Configuration = this.configuration;\n\n        // This makes that Promo codes and GC travel to different servers (secure and unsecure)\n        this.on('afterStart', (): void => this.afterStart());\n\n        // Setup global cache for this application\n        jQuery.ajaxSetup({ cache: false });\n    }\n\n    public start(modules: any[], done?: Function): void {\n        const checkoutPromise = CheckoutStepsFactory.getInstance().loadCheckoutSteps();\n        checkoutPromise.then((): void => super.start(modules, done));\n    }\n\n    public static getInstance(): Checkout {\n        this.instance = this.instance || new Checkout();\n        return this.instance;\n    }\n\n    private afterStart(): void {\n        // Fix sitebuilder links, Examines the event target to check if its a touchpoint\n        // and replaces it with the new version ot the touchpoint\n\n        // As this fixCrossDomainNavigation only alters the href of the a we can append it\n        // to the mouse down event, and not to the click thing will make us work a lot more :)\n        jQuery(document.body).on('mousedown', 'a', this.fixCrossDomainNavigation);\n        jQuery(document.body).on('touchstart', 'a', this.fixCrossDomainNavigation);\n    }\n\n    private fixCrossDomainNavigation(e): void {\n        const $element = jQuery(e.target).closest('a');\n        if (!$element.closest('#main').length) {\n            const { href } = e.target;\n            const url_prefix = href && href.split('?')[0];\n            // get the value of the \"is\" url parameter\n            const href_parameter_value_is = Utils.getParameterByName(href, 'is');\n            const touchpoints = Session.get('touchpoints');\n\n            _.each(touchpoints, function(touchpoint: any) {\n                const touchpoint_parameter_value_is = Utils.getParameterByName(touchpoint, 'is');\n                // If the href of the link is equal to the current touchpoint\n                // then update the link with the\n                // parameters of the touchpoint. To check if are equals is been used the url without\n                // parameters and the parameter \"is\"\n                if (url_prefix && ~touchpoint.indexOf(url_prefix)) {\n                    // If the \"is\" parameter exist in the link, then must exist in the\n                    // touchpoint and his values need to be equals.\n                    if (\n                        !(\n                            href_parameter_value_is &&\n                            (!touchpoint_parameter_value_is ||\n                                touchpoint_parameter_value_is !== href_parameter_value_is)\n                        )\n                    ) {\n                        e.target.href = touchpoint;\n                    }\n                }\n            });\n        }\n    }\n\n    public getName(): string {\n        return 'Checkout';\n    }\n}\n"]}
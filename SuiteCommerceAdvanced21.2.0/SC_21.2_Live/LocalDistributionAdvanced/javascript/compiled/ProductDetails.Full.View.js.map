{"version":3,"sources":["ProductDetails.Full.View.ts"],"names":[],"mappings":"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","file":"ProductDetails.Full.View.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"ProductDetails.Full.View\"/>\n\nimport * as _ from 'underscore';\nimport * as product_details_full_tpl from 'product_details_full.tpl';\nimport { Product as JsonldProduct, Offer as JsonldOffer } from 'schema-dts';\nimport { JSONObject } from '../../../Commons/Utilities/JavaScript/Utils.Interfaces';\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\nimport { Configuration } from '../../../Commons/Utilities/JavaScript/Configuration';\nimport { Environment } from '../../../Commons/Core/JavaScript/Environment';\nimport { ProfileModel } from '../../../Commons/Profile/JavaScript/Profile.Model';\n\nimport ProductDetailsBaseView = require('./ProductDetails.Base.View');\nimport ItemRelationsRelatedView = require('../../../Commons/ItemRelations/JavaScript/ItemRelations.Related.View');\nimport ItemRelationsCorrelatedView = require('../../../Commons/ItemRelations/JavaScript/ItemRelations.Correlated.View');\nimport ProductDetailsInformationView = require('./ProductDetails.Information.View');\nimport SocialSharingFlyoutView = require('../../SocialSharing/JavaScript/SocialSharing.Flyout.View');\nimport ProductReviewsCenterView = require('../../../Commons/ProductReviews/JavaScript/ProductReviews.Center.View');\nimport GlobalViewsStarRatingView = require('../../../Commons/GlobalViews/JavaScript/GlobalViews.StarRating.View');\n\n// @class ProductDetails.Full.View Handles the PDP and quick view @extend Backbone.View\nconst ProductDetailsFullView: any = ProductDetailsBaseView.extend({\n    // @property {Function} template\n    template: product_details_full_tpl,\n\n    // @property {Object} attributes List of HTML attributes applied by Backbone into the $el\n    attributes: {\n        id: 'ProductDetails.Full.View',\n        class: 'view product-detail',\n        'data-root-component-id': 'ProductDetails.Full.View'\n    },\n\n    bindings: _.extend({}, ProductDetailsBaseView.prototype.bindings, {}),\n\n    // @method initialize Override default method to update the url on changes in the current\n    // product\n    // @param {ProductDetails.Full.View.Initialize.Options} options\n    // @return {Void}\n    initialize: function initialize(): void {\n        ProductDetailsBaseView.prototype.initialize.apply(this, arguments);\n        this.model.on('change', this.updateURL, this);\n        // Tracker.getInstance().trackProductView(this.model);\n    },\n\n    childViews: _.extend({}, ProductDetailsBaseView.prototype.childViews, {\n        'Correlated.Items': function(): any {\n            return new ItemRelationsCorrelatedView({\n                itemsIds: this.model.get('item').get('internalid'),\n                application: this.application\n            });\n        },\n        'Related.Items': function(): any {\n            return new ItemRelationsRelatedView({\n                itemsIds: this.model.get('item').get('internalid'),\n                application: this.application\n            });\n        },\n        'Product.Information': function(): any {\n            return new ProductDetailsInformationView({\n                model: this.model\n            });\n        },\n        'SocialSharing.Flyout': function(): any {\n            return new SocialSharingFlyoutView({});\n        }\n    }),\n\n    getChildViews: function() {\n        const { childViews } = this;\n        const SC = Environment.getSC();\n        if (SC.ENVIRONMENT.REVIEWS_CONFIG && SC.ENVIRONMENT.REVIEWS_CONFIG.enabled) {\n            childViews['ProductReviews.Center'] = function wrapperFunction(options) {\n                return function() {\n                    return new ProductReviewsCenterView({\n                        item: options.model.get('item'),\n                        application: options.application\n                    });\n                };\n            };\n\n            childViews['Global.StarRating'] = function wrapperFunction(options) {\n                return function() {\n                    return new GlobalViewsStarRatingView({\n                        model: options.model.get('item'),\n                        showRatingCount: true,\n                        showSchemaInfo: true\n                    });\n                };\n            };\n        }\n\n        return childViews;\n    },\n\n    // @method destroy Override default method to detach from change event of the current product\n    // @return {Void}\n    destroy: function destroy(): any {\n        this.model.off('change');\n        return this._destroy();\n    },\n\n    // @method Create JsonLd object with product basic info\n    // @param {JSONObject} childJsonLd\n    // @return {JQuery.Deferred<JsonldProduct>}\n    getJsonLd: function getJsonLd(childJsonLd: JSONObject): JQuery.Deferred<JsonldProduct> {\n        if (Configuration.get('structureddatamarkup.type') !== 'JSON-LD') {\n            return jQuery.Deferred().resolve(null);\n        }\n\n        const priceContainerObject = this.model.getPrice();\n        const isPriceRange = priceContainerObject.min && priceContainerObject.max;\n        const modelItem = this.model.get('item');\n        const stockInfo = this.model.getStockInfo();\n\n        const offers: JsonldOffer = {\n            '@type': 'Offer',\n            url: modelItem.get('_url'),\n            availability: 'http://schema.org/OutOfStock'\n        };\n\n        // Get availability\n        if (stockInfo.isPurchasable && !stockInfo.isInStock) {\n            offers.availability =\n                Configuration.get('structureddatamarkup.availabilityonbackorder') === 'PreOrder'\n                    ? 'http://schema.org/PreOrder'\n                    : 'http://schema.org/InStock';\n        } else if (stockInfo.isInStock) {\n            offers.availability = 'http://schema.org/InStock';\n        }\n\n        // Get price\n        if (!ProfileModel.getInstance().hidePrices()) {\n            if (isPriceRange) {\n                offers.priceSpecification = {\n                    '@type': 'PriceSpecification',\n                    price: this.model.getPrice().price,\n                    minPrice: priceContainerObject.min.price,\n                    maxPrice: priceContainerObject.max.price\n                };\n            } else {\n                offers.price = this.model.getPrice().price;\n            }\n\n            offers.priceCurrency =\n                SC.getSessionInfo('currency') && SC.getSessionInfo('currency').code\n                    ? SC.getSessionInfo('currency').code\n                    : Configuration.get('siteSettings.shopperCurrency.code');\n        }\n\n        const storedetaileddescription = jQuery(\n            `<div>${modelItem.attributes.storedetaileddescription}</div>`\n        ).text();\n\n        const childJsonLdCopy = childJsonLd;\n        delete childJsonLdCopy['@type'];\n\n        const jsonld: JsonldProduct = {\n            '@type': 'Product',\n            name: this.page_header,\n            image: this.model.getImages()[0].url.toString(),\n            offers: offers,\n            description: storedetaileddescription.length > 0 ? storedetaileddescription : undefined,\n            sku: this.model.getSku() ? this.model.getSku() : undefined,\n            ...childJsonLdCopy\n        };\n\n        return jQuery.Deferred().resolve(jsonld);\n    },\n\n    // @method showOptionsPusher Override parent method to allow hide/show the option's pusher on\n    // mobile depending on the configuration value: ItemOptions.maximumOptionValuesQuantityWithoutPusher\n    // @return {Booelan}\n    showOptionsPusher: function showOptionsPusher(): boolean {\n        const options_values_length = _.reduce(\n            this.model.getVisibleOptions().map(function(option) {\n                if (_.isArray(option.get('values'))) {\n                    const invalid_values = _.filter(option.get('values'), (value: any) => {\n                        return !value.internalid;\n                    });\n\n                    return option.get('values').length - invalid_values.length;\n                }\n                return 0;\n            }),\n            (memo: any, num: any) => {\n                return memo + num;\n            },\n            0\n        );\n\n        return (\n            options_values_length >\n            Configuration.get('ItemOptions.maximumOptionValuesQuantityWithoutPusher', 1)\n        );\n    },\n\n    // @method getContext\n    // @return {ProductDetails.Full.View.Context}\n    getContext: function getContext(): any {\n        // @class ProductDetails.Full.View.Context @extend ProductDetails.Base.View.Context\n        return _.extend(ProductDetailsBaseView.prototype.getContext.apply(this, arguments), {});\n        // @class ProductDetails.Full.View\n    }\n});\n\nexport = ProductDetailsFullView;\n\n// @class ProductDetails.Full.View.Initialize.Options\n// @extend ProductDetails.Base.View.Initialize.Options\n"]}
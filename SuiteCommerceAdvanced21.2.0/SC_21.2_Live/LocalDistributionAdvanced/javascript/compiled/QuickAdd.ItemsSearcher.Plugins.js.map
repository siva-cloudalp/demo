{"version":3,"sources":["QuickAdd.ItemsSearcher.Plugins.ts"],"names":[],"mappings":"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","file":"QuickAdd.ItemsSearcher.Plugins.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"QuickAdd.ItemsSearcher.Plugins\"/>\n\nimport * as _ from 'underscore';\n\nimport ItemModel = require('../../../Commons/Item/JavaScript/Item.Model');\nimport ProductModel = require('../../../Commons/Product/JavaScript/Product.Model');\nimport ProductCollection = require('../../../Commons/Product/JavaScript/Product.Collection');\n\n// @class QuickAdd.ItemsSearcher.Plugins\nconst QuickAddItemsSearcherPlugins: any = {\n    // @property {QuickAdd.ItemsSearcher.Pluguns.flatItemsMatrixResult} flatItemsMatrixResult\n    // @class QuickAdd.ItemsSearcher.Pluguns.flatItemsMatrixResult @extend Plugin\n    flatItemsMatrixResult: {\n        name: 'flatItemsMatrixResult',\n        priotity: 10,\n        // @method execute\n        // @param {ItemsSearcher.Collection} collection\n        // @param {ItemsSearcher.View.Options} configuration\n        // @return {ItemsSearcher.Collection}\n        execute: function(collection, configuration) {\n            // Current item that is begin processed\n            let products = [];\n            // Variable that contains the new product created from all parent matrix items to generated one items per child\n            // We do this to flat the list of items in the collection\n            let new_product;\n            // List of option for the current child item\n            let item_options;\n            // Counter used to emulate the ids of the new products. This is required so the ItemSearcher can identify selected products in the result list\n            let internalid_counter = 1;\n            collection.each(function(item) {\n                if (\n                    item.get('isinstock') ||\n                    (item.get('isbackorderable') || configuration.showBackorderables)\n                ) {\n                    if (item.get('_matrixChilds') && item.get('_matrixChilds').length) {\n                        item_options = item.get('options').where({ isMatrixDimension: true });\n\n                        item.get('_matrixChilds').each(function(child_item) {\n                            new_product = new ProductModel({\n                                item: new ItemModel(_.extend({}, item.attributes))\n                            });\n\n                            _.each(item_options, function(option: any) {\n                                const selected_child_item_option_label = child_item.get(\n                                    option.get('itemOptionId')\n                                );\n                                const selected_option_value_object: any = _.findWhere(\n                                    option.get('values'),\n                                    { label: selected_child_item_option_label }\n                                );\n\n                                new_product.setOption(\n                                    option.get('cartOptionId'),\n                                    selected_option_value_object.internalid\n                                );\n                            });\n\n                            // Give than the behavior to extract thumbnail images is based on the current selected item (thought for lines)\n                            // we provide all children with the image object\n                            new_product\n                                .getItem()\n                                .set('itemimages_detail', item.get('itemimages_detail'));\n\n                            new_product.set('isfulfillable', item.get('isfulfillable'));\n                            new_product.set('internalid', internalid_counter++);\n\n                            products.push(new_product);\n                        });\n                    } else {\n                        products.push(\n                            new ProductModel({\n                                item: item,\n                                internalid: internalid_counter++\n                            })\n                        );\n                    }\n                }\n            });\n\n            products = _.filter(products, function(product) {\n                const query_on_sku =\n                    (product.getSku() ? product.getSku().toUpperCase() : '').indexOf(\n                        configuration.query.toUpperCase()\n                    ) >= 0;\n                const query_on_name =\n                    (product.get('item').get('_name')\n                        ? product\n                              .get('item')\n                              .get('_name')\n                              .toUpperCase()\n                        : ''\n                    ).indexOf(configuration.query.toUpperCase()) >= 0;\n                const item_not_gift_certificate =\n                    product.get('item').get('itemtype') !== 'GiftCert';\n\n                return item_not_gift_certificate && (query_on_name || query_on_sku);\n            });\n\n            return new ProductCollection(_.first(products, configuration.limit));\n        }\n    }\n    // @class QuickAdd.ItemsSearcher.Plugins\n};\n\nexport = QuickAddItemsSearcherPlugins;\n"]}
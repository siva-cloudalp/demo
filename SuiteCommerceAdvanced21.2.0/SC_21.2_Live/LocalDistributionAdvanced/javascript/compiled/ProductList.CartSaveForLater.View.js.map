{"version":3,"sources":["ProductList.CartSaveForLater.View.ts"],"names":[],"mappings":"AAAA;;;;;EAKE;;;IAkBF,IAAM,mBAAmB,GAAG,gBAAgB,CAAC,SAAS,CAAC,UAAU,CAAC;IAClE,IAAM,kBAAkB,GAAG,IAAI,gBAAgB,EAAE,CAAC;IAElD,CAAC,CAAC,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE;QACjC,UAAU,EAAE;YACR,IAAM,IAAI,GAAG,IAAI,CAAC;YAElB,mBAAmB,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;YAE3C,IAAI,CAAC,gBAAgB,GAAG,kBAAkB,CAAC;YAE3C,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,iBAAiB,IAAI,IAAI,CAAC,WAAW,CAAC,iBAAiB,CAAC,KAAK,CAAC;YAE5F,4BAAY,CAAC,UAAU,EAAE,CAAC,IAAI,CAAC;gBAC3B,IAAI,CAAC,MAAM,EAAE,CAAC;YAClB,CAAC,CAAC,CAAC;QACP,CAAC;QAED,UAAU,EAAE,CAAC,CAAC,MAAM,CAAC,EAAE,EAAE,gBAAgB,CAAC,SAAS,CAAC,UAAU,EAAE;YAC5D,aAAa,EAAE;gBACX,IAAI,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,KAAK,CAAC,oBAAoB,EAAE,EAAE;oBACjD,OAAO,IAAI,2BAA2B,CAAC;wBACnC,WAAW,EAAE,IAAI,CAAC,OAAO,CAAC,WAAW;wBACrC,KAAK,EAAE,IAAI,CAAC,gBAAgB;qBAC/B,CAAC,CAAC;iBACN;gBAED,OAAO,IAAI,CAAC;YAChB,CAAC;SACJ,CAAC;QAEF,kBAAkB;QAClB,uDAAuD;QACvD,yEAAyE;QACzE,gBAAgB,EAAE,UAAS,CAAC;YACxB,CAAC,CAAC,cAAc,EAAE,CAAC;YAEnB,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,EAAE;gBACvB,OAAO;aACV;YAED,IAAM,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;YACnF,IAAM,UAAU,GAAG,SAAS,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;YAC/C,IAAM,aAAa,GAAG,MAAM,CAAC,QAAQ,EAAE,CAAC;YACxC,IAAM,IAAI,GAAG,IAAI,CAAC;YAElB,MAAM;iBACD,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,SAAS,CAAC,EAAE,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC;iBACrE,IAAI,CAAC;gBACF,IAAI,CAAC,uBAAuB,CACxB,KAAK,CAAC,SAAS,CACX,oHAAoH,CACvH,CACJ,CAAC;gBAEF,aAAa,CAAC,OAAO,EAAE,CAAC;YAC5B,CAAC,CAAC,CAAC;YAEP,IAAI,CAAC,wBAAwB,CAAC,aAAa,EAAE,MAAI,UAAU,YAAS,CAAC,CAAC;QAC1E,CAAC;QAED,kDAAkD;QAClD,aAAa,EAAE,UAAS,SAAS;YAC7B,IAAM,KAAK,GAAG,MAAM,CAAC,QAAQ,EAAE,CAAC;YAChC,IAAM,IAAI,GAAG,IAAI,CAAC;YAElB,IAAI,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,EAAE;gBAC/B,IAAI,CAAC,gBAAgB,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC;oBAC9B,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,YAAY,CAAC,EAAE,SAAS,EAAE,KAAK,CAAC,CAAC;gBACpF,CAAC,CAAC,CAAC;aACN;iBAAM;gBACH,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,YAAY,CAAC,EAAE,SAAS,EAAE,KAAK,CAAC,CAAC;aACnF;YAED,OAAO,KAAK,CAAC,OAAO,EAAE,CAAC;QAC3B,CAAC;QACD,sCAAsC;QACtC,eAAe,EAAE,UAAS,eAAe,EAAE,SAAS,EAAE,gBAAgB;YAClE,IAAM,IAAI,GAAG,IAAI,CAAC;YAElB,IAAM,YAAY,GAAG,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,UAAA,OAAO;gBAChE,OAAO,CACH,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC,KAAK,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC,CACpF,CAAC;YACN,CAAC,CAAC,CAAC;YAEH,IAAI,YAAY,EAAE;gBACd,IAAM,WAAW,GAAW,YAAY,CAAC,GAAG,CAAC,UAAU,CAAC,GAAG,SAAS,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;gBACrF,YAAY,CAAC,GAAG,CAAC,UAAU,EAAE,WAAW,CAAC,CAAC;gBAE1C,YAAY,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC,CAAC,IAAI,CAAC;oBAC9C,OAAO,CAAC,WAAW,EAAE,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC;oBACpD,gBAAgB,CAAC,OAAO,EAAE,CAAC;gBAC/B,CAAC,CAAC,CAAC;aACN;iBAAM;gBACH,IAAM,yBAAuB,GAAG,oBAAoB,CAAC,yBAAyB,CAC1E,SAAS,CACZ,CAAC;gBAEF,yBAAuB,CAAC,GAAG,CAAC,aAAa,EAAE,EAAE,EAAE,EAAE,eAAe,EAAE,CAAC,CAAC;gBAEpE,yBAAuB,CAAC,GAAG,CAAC,aAAa,EAAE,EAAE,CAAC,CAAC;gBAE/C,yBAAuB,CAAC,GAAG,CAAC,MAAM,EAAE,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;gBAE7E,yBAAuB,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC,CAAC,IAAI,CAAC;oBACzD,yBAAuB,CAAC,GAAG,CAAC,MAAM,EAAE,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;oBAE7E,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,yBAAuB,EAAE,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC;oBAE3E,OAAO,CAAC,WAAW,EAAE,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC;oBAEpD,gBAAgB,CAAC,OAAO,EAAE,CAAC;gBAC/B,CAAC,CAAC,CAAC;aACN;QACL,CAAC;QACD,aAAa,EAAE;YACX,IAAI,4BAAY,CAAC,WAAW,EAAE,CAAC,GAAG,CAAC,YAAY,CAAC,KAAK,GAAG,EAAE;gBACtD,IAAM,UAAU,GAAG;oBACf,MAAM,EAAE,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC,iBAAiB;oBACtD,WAAW,EAAE,kBAAkB,CAAC,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC;iBAC7D,CAAC;gBAEF,MAAM,CAAC,QAAQ,CAAC,IAAI,GAAG,KAAK,CAAC,cAAc,CACvC,OAAO,CAAC,GAAG,CAAC,mBAAmB,CAAC,EAChC,UAAU,CACb,CAAC;gBAEF,OAAO,KAAK,CAAC;aAChB;YAED,OAAO,IAAI,CAAC;QAChB,CAAC;KACJ,CAAC,CAAC;IAEH,gBAAgB,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,MAAM,CAAC,EAAE,EAAE,gBAAgB,CAAC,SAAS,CAAC,MAAM,EAAE;QAChF,2CAA2C,EAAE,kBAAkB;KAClE,CAAC,CAAC;IAEH,OAAS,gBAAgB,CAAC","file":"ProductList.CartSaveForLater.View.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"ProductList.CartSaveForLater.View\"/>\n\nimport '../../../Commons/Utilities/JavaScript/Configuration';\nimport * as _ from 'underscore';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\nimport { ProfileModel } from '../../../Commons/Profile/JavaScript/Profile.Model';\n\nimport ProductListDetailsLaterView = require('./ProductList.DetailsLater.View');\nimport ProductListModel = require('../../../Commons/ProductList/JavaScript/ProductList.Model');\nimport ProductListItemModel = require('../../../Commons/ProductList/JavaScript/ProductList.Item.Model');\nimport CartDetailedView = require('../../../Commons/Cart/JavaScript/Cart.Detailed.View');\nimport Session = require('../../../Commons/Session/JavaScript/Session');\nimport Tracker = require('../../../Commons/Tracker/JavaScript/Tracker');\nimport Backbone = require('../../../Commons/Utilities/JavaScript/backbone.custom');\n\nconst original_initialize = CartDetailedView.prototype.initialize;\nconst product_list_model = new ProductListModel();\n\n_.extend(CartDetailedView.prototype, {\n    initialize: function() {\n        const self = this;\n\n        original_initialize.apply(this, arguments);\n\n        this.productListModel = product_list_model;\n\n        this.utils = this.application.ProductListModule && this.application.ProductListModule.Utils;\n\n        ProfileModel.getPromise().done(function() {\n            self.render();\n        });\n    },\n\n    childViews: _.extend({}, CartDetailedView.prototype.childViews, {\n        SavedForLater: function() {\n            if (this.utils && this.utils.isProductListEnabled()) {\n                return new ProductListDetailsLaterView({\n                    application: this.options.application,\n                    model: this.productListModel\n                });\n            }\n\n            return null;\n        }\n    }),\n\n    // save for later:\n    // handles the click event of the save for later button\n    // removes the item from the cart and adds it to the saved for later list\n    saveForLaterItem: function(e) {\n        e.preventDefault();\n\n        if (!this.validateLogin()) {\n            return;\n        }\n\n        const cart_line = this.model.get('lines').get(jQuery(e.target).data('internalid'));\n        const internalid = cart_line.get('internalid');\n        const whole_promise = jQuery.Deferred();\n        const self = this;\n\n        jQuery\n            .when(this.model.removeLine(cart_line), self.addItemToList(cart_line))\n            .then(function() {\n                self.showConfirmationMessage(\n                    Utils.translate(\n                        'Good! You saved the item for later. If you want to add it back to your cart, see below in <b>\"Saved for later\"</b>'\n                    )\n                );\n\n                whole_promise.resolve();\n            });\n\n        this.disableElementsOnPromise(whole_promise, `#${internalid} button`);\n    },\n\n    // Add a new product list item into a product list\n    addItemToList: function(cart_line) {\n        const defer = jQuery.Deferred();\n        const self = this;\n\n        if (this.productListModel.isNew()) {\n            this.productListModel.save().done(function() {\n                self.doAddItemToList(self.productListModel.get('internalid'), cart_line, defer);\n            });\n        } else {\n            self.doAddItemToList(self.productListModel.get('internalid'), cart_line, defer);\n        }\n\n        return defer.promise();\n    },\n    // Adds the new item to the collection\n    doAddItemToList: function(product_list_id, cart_line, internal_promise) {\n        const self = this;\n\n        const existingItem = self.productListModel.get('items').find(element => {\n            return (\n                element.get('item').get('internalid') === cart_line.get('item').get('internalid')\n            );\n        });\n\n        if (existingItem) {\n            const newQuantity: number = existingItem.get('quantity') + cart_line.get('quantity');\n            existingItem.set('quantity', newQuantity);\n\n            existingItem.save(null, { validate: false }).then(() => {\n                Tracker.getInstance().trackAddToWishlist(cart_line);\n                internal_promise.resolve();\n            });\n        } else {\n            const product_list_item_model = ProductListItemModel.createFromTransactionLine(\n                cart_line\n            );\n\n            product_list_item_model.set('productList', { id: product_list_id });\n\n            product_list_item_model.set('description', '');\n\n            product_list_item_model.set('item', cart_line.get('item'), { silent: true });\n\n            product_list_item_model.save(null, { validate: false }).done(function() {\n                product_list_item_model.set('item', cart_line.get('item'), { silent: true });\n\n                self.productListModel.get('items').add(product_list_item_model, { at: 0 });\n\n                Tracker.getInstance().trackAddToWishlist(cart_line);\n\n                internal_promise.resolve();\n            });\n        }\n    },\n    validateLogin: function(): boolean {\n        if (ProfileModel.getInstance().get('isLoggedIn') === 'F') {\n            const parameters = {\n                origin: this.application.getConfig().currentTouchpoint,\n                origin_hash: encodeURIComponent(Backbone.history.fragment)\n            };\n\n            window.location.href = Utils.addParamsToUrl(\n                Session.get('touchpoints.login'),\n                parameters\n            );\n\n            return false;\n        }\n\n        return true;\n    }\n});\n\nCartDetailedView.prototype.events = _.extend({}, CartDetailedView.prototype.events, {\n    'click [data-action=\"save-for-later-item\"]': 'saveForLaterItem'\n});\n\nexport = CartDetailedView;\n"]}
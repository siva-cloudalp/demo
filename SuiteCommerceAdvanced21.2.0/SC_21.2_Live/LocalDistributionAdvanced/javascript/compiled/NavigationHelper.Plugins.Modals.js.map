{"version":3,"sources":["NavigationHelper.Plugins.Modals.ts"],"names":[],"mappings":"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","file":"NavigationHelper.Plugins.Modals.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"NavigationHelper.Plugins.Modals\"/>\n\nimport * as _ from 'underscore';\nimport '../../UrlHelper/JavaScript/UrlHelper';\nimport * as Utils from '../../Utilities/JavaScript/Utils';\n\nimport * as jQuery from '../../Core/JavaScript/jQuery';\n\nimport BackboneView = require('../../BackboneExtras/JavaScript/Backbone.View');\nimport Backbone = require('../../Utilities/JavaScript/backbone.custom');\n\n// @class NavigationHelper.Plugins.Modals Contains the plugins that implement the show in modal for links behavior.\n// This means a link with the attribute data-toggle=\"show-in-modal\" will be opened in a modal. Supports both internal and external URLs.\n// @extends ApplicationModule\nconst modalsPlugin: any = {\n    // @method showInternalLinkInModal for links that has the data-toggle=\"show-in-modal\" we will open them in a modal,\n    // we do this by overriding the showContent function of the layout\n    // and by disabling the overrideViewSettings of the Content.EnhancedViews package\n    // Then we just navigate to that URL to call the router and execute the logic as normal\n    // layout_overlay prevents the user from calling the overridden showContent by clicking another element\n    // @param {jQuery.Event} e\n    // @param {String} href\n    // @param {jQuery} $target\n    // @param {ApplicationSkeleton.Layout} layout\n    // @return {Void}\n    showInternalLinkInModal: function(e, href, $target, layout) {\n        const current_fragment = Backbone.history.fragment || '/';\n        let original_view;\n\n        layout.isShowContentRewritten = true;\n        layout.originalShowContent = layout.showContent;\n\n        if (modalsPlugin.ContentEnhancedViews) {\n            modalsPlugin.originalOverrideViewSettings =\n                modalsPlugin.ContentEnhancedViews.overrideViewSettings;\n        }\n\n        const layout_overlay = jQuery('<div class=\"layout-overlay\"></div>');\n        layout.$el.append(layout_overlay);\n\n        layout.showContent = function(view) {\n            return layout\n                .getCancelableEmitter()\n                .emitUnsafe('beforeAppendView', view)\n                .then(() => _showContent(view))\n                .fail(function() {\n                    layout_overlay.remove();\n                    modalsPlugin.undoNavigationHelperFunctionRewrite(layout);\n                });\n        };\n\n        // Here we override the showContent function\n        var _showContent = function _showContent(view) {\n            layout_overlay.remove();\n\n            let promise = jQuery.Deferred();\n            // If you ever try to set a view that is not the original one\n            // this code will catch it an do an undo\n            if (!original_view) {\n                original_view = view;\n            } else if (original_view !== view) {\n                promise = layout.originalShowContent.apply(layout, arguments);\n\n                original_view &&\n                    original_view.$containerModal &&\n                    original_view.$containerModal\n                        .removeClass('fade')\n                        .modal('hide')\n                        .data('bs.modal', null);\n                return promise;\n            }\n\n            let modalFunction;\n            if (view) {\n                if (_.isFunction(view.showInModal)) {\n                    modalFunction = view.showInModal;\n                } else if (_.isFunction(view.modalNavigation)) {\n                    modalFunction = view.modalNavigation;\n                }\n            }\n\n            if (modalFunction) {\n                // Then we just call the show in modal of the same view that we were passed in.\n                promise = modalFunction.call(view, {\n                    className: $target.data('modal-class-name'),\n                    silence: true\n                });\n\n                // once this model closes we undo the override of the function\n                view.$containerModal.on('hide.bs.modal', function() {\n                    modalsPlugin.undoNavigationHelperFunctionRewrite(layout);\n                });\n            } else {\n                modalsPlugin.undoNavigationHelperFunctionRewrite(layout);\n                Backbone.history.navigate(href, { trigger: false, replace: true });\n            }\n\n            return promise;\n        };\n\n        if (href.indexOf('?') === -1) {\n            href += '?showinmodal=T';\n        } else {\n            href += '&showinmodal=T';\n        }\n\n        // Here we navigate to the url and we then change the url to what it was originaly set in page that opened the modal\n        Backbone.history.navigate(href, { trigger: true, replace: true });\n        Backbone.history.navigate(current_fragment, { trigger: false, replace: true });\n    },\n\n    // @method undoNavigationHelperFunctionRewrite Helper method to undo the override performed by showInternalLinkInModal\n    // @param {ApplicationSkeleton.Layout} layout\n    // @return {Void}\n    undoNavigationHelperFunctionRewrite: function(layout) {\n        if (layout.isShowContentRewritten) {\n            layout.showContent = layout.originalShowContent;\n\n            if (modalsPlugin.ContentEnhancedViews) {\n                modalsPlugin.ContentEnhancedViews.overrideViewSettings =\n                    modalsPlugin.originalOverrideViewSettings;\n            }\n\n            layout.isShowContentRewritten = false;\n        }\n    },\n\n    // @method showExternalLinkInModal Opens an external page in a modal, by rendering an iframe in it\n    // @param {String} href\n    // @param {NavigationContext} context\n    // @param {ApplicationSkeleton} application\n    // @return {Void}\n    showExternalLinkInModal: function(href, context, application) {\n        const view = new BackboneView({\n            application: application\n        });\n\n        view.template = function() {\n            return `<iframe src=\"${href}\"></iframe>`;\n        };\n        view.page_header = context.$target.data('page-header') || '';\n\n        application\n            .getLayout()\n            .getCancelableEmitter()\n            .emitUnsafe('beforeAppendView', view)\n            .then(function() {\n                view.showInModal({\n                    className: `${context.$target.data('modal-class-name') || ''} iframe-modal`\n                });\n            });\n    },\n\n    // @method clickNavigation Handle standard click navigation for the cases were the target DO IS not a modal\n    // @param {ApplicationSkeleton.Layout} layout General application layout\n    // @param {jQuery.Event} e jQuery event\n    // @param {ApplicationSkeleton} application\n    // @return {jQuery.Event} e\n    clickNavigation: function(layout, e, application) {\n        // Grabs info from the event element\n        const context = layout.generateNavigationContext(e);\n        let href = layout.getUrl(context) || '';\n        const target_is_blank = layout.isTargetBlank(e) || e.button === 1;\n        const target_is_modal = context.target_data.toggle === 'show-in-modal';\n        const is_disabled = context.$target.attr('disabled');\n        const is_dropdown = context.target_data.toggle === 'dropdown';\n        let is_external;\n\n        if (is_disabled) {\n            e.stopPropagation();\n            return e;\n        }\n\n        if (context.target_data.originalHref && !target_is_blank) {\n            href = context.target_data.originalHref;\n        }\n\n        if (href === '#' || href === '' || is_dropdown) {\n            return e;\n        }\n\n        // The navigation is within the same browser window\n        if (!target_is_blank) {\n            // if there is a modal open\n            if (layout.$containerModal) {\n                layout.$containerModal\n                    .removeClass('fade')\n                    .modal('hide')\n                    .data('bs.modal', null);\n            }\n\n            // Wants to open this link in a modal\n            if (target_is_modal) {\n                is_external =\n                    ~href.indexOf('http:') ||\n                    ~href.indexOf('https:') ||\n                    ~href.indexOf('mailto:') ||\n                    ~href.indexOf('tel:');\n\n                if (is_external) {\n                    modalsPlugin.showExternalLinkInModal(href, context, application);\n                } else {\n                    modalsPlugin.showInternalLinkInModal(e, href, context.$target, layout);\n                }\n            }\n        }\n\n        return e;\n    },\n\n    // @property {Boolean} ContentEnhancedViews\n    ContentEnhancedViews: false,\n\n    // @method mountToApp\n    // @param {ApplicationSkeleton} application\n    mountToApp: function(application) {\n        const layout = application.getLayout();\n\n        // there is a soft dependency with Content.EnhancedViews\n        // we only want it to disable the function that sets the title of the page,\n        // we don't want to do that pages that open in modals\n        try {\n            modalsPlugin.ContentEnhancedViews = Utils.requireModules('Content.EnhancedViews');\n        } catch (e) {}\n\n        // Install Modal Navigation Plugins\n\n        layout.click.install({\n            name: 'modalNavigation',\n            priority: 10,\n            execute: function(e) {\n                return modalsPlugin.clickNavigation(layout, e, application);\n            }\n        });\n    }\n};\n\nexport = modalsPlugin;\n"]}
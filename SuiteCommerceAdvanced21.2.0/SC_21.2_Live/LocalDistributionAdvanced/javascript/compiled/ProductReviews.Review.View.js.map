{"version":3,"sources":["ProductReviews.Review.View.ts"],"names":[],"mappings":"AAAA;;;;;EAKE;;;IAoBF,OAAS,YAAY,CAAC,MAAM,CAAC;QACzB,QAAQ,EAAE,sBAAsB;QAEhC,MAAM,EAAE;YACJ,kCAAkC,EAAE,YAAY;SACnD;QAED,UAAU,EAAE,UAAS,OAAO;YACxB,IAAI,CAAC,UAAU,GAAG,OAAO,CAAC,UAAU,CAAC;YACrC,IAAI,CAAC,iBAAiB,GAAG,OAAO,CAAC,iBAAiB,CAAC;YACnD,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACvB,CAAC;QAED,8FAA8F;QAC9F,4BAA4B;QAC5B,wFAAwF;QACxF,oDAAoD;QACpD,4EAA4E;QAC5E,iBAAiB,EAAE,UAAS,SAAS,EAAE,MAAM,EAAE,MAAM,EAAE,QAAQ;YAC3D,IAAM,oBAAoB,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC,IAAI,IAAI,CAAC,CAAC;YAE/E,+EAA+E;YAC/E,IAAI,CAAC,oBAAoB,CAAC,SAAS,CAAC,EAAE;gBAClC,oBAAoB,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC;gBACrC,oBAAoB,CAAC,SAAS,CAAC,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC;gBAC/C,OAAO,CAAC,GAAG,CAAC,gBAAgB,EAAE,IAAI,CAAC,SAAS,CAAC,oBAAoB,CAAC,EAAE,EAAE,OAAO,EAAE,GAAG,EAAE,CAAC,CAAC;gBAEtF,IAAM,KAAK,GAAQ,EAAE,CAAC;gBACtB,KAAK,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC;gBACrB,KAAK,CAAC,KAAK,GAAG,IAAI,CAAC;gBACnB,MAAM,CAAC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;aAC9B;YAED,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC;YAEpB,IAAM,mBAAmB,GAAG,IAAI,iDAAsB,CAAC;gBACnD,OAAO,EAAE,KAAK,CAAC,SAAS,CAAC,oDAAoD,CAAC;gBAC9E,IAAI,EAAE,SAAS;gBACf,QAAQ,EAAE,IAAI;aACjB,CAAC,CAAC;YAEH,QAAQ,CAAC,IAAI,CACT,MAAM,KAAK,gBAAgB;gBACvB,CAAC,CAAC,KAAK,CAAC,SAAS,CAAC,YAAY,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;gBAC/D,CAAC,CAAC,KAAK,CAAC,SAAS,CAAC,WAAW,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC,CACzE,CAAC;YAEF,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,QAAQ,CAAC,8BAA8B,CAAC,CAAC;YAEjE,IAAI,CAAC,GAAG;iBACH,IAAI,CAAC,iCAAiC,CAAC;iBACvC,IAAI,CAAC,mBAAmB,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC;QACvD,CAAC;QAED,kEAAkE;QAClE,4EAA4E;QAC5E,mBAAmB;QACnB,kEAAkE;QAClE,eAAe,EAAE,UAAS,UAAU;YAChC,IAAM,mBAAmB,GAAG,IAAI,iDAAsB,CAAC;gBACnD,OAAO,EAAE,KAAK,CAAC,SAAS,CACpB,uEAAuE,CAC1E;gBACD,IAAI,EAAE,SAAS;gBACf,QAAQ,EAAE,IAAI;aACjB,CAAC,CAAC;YAEH,qCAAqC;YACrC,UAAU;iBACL,IAAI,CAAC,sBAAsB,CAAC;iBAC5B,WAAW,CAAC,UAAU,CAAC;iBACvB,GAAG,EAAE;iBACL,IAAI,CAAC,iCAAiC,CAAC;iBACvC,IAAI,CAAC,mBAAmB,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC;QACvD,CAAC;QAED,uFAAuF;QACvF,UAAU,EAAE,UAAS,CAAC;YAClB,IAAM,QAAQ,GAAG,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC;YAElC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;gBAC/C,IAAM,KAAK,GAAG,EAAE,CAAC;gBACT,IAAA,KAAK,GAAK,MAAM,MAAX,CAAY;gBACzB,IAAM,MAAM,GAAG,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBACrC,IAAM,UAAU,GAAG,QAAQ,CAAC,OAAO,CAAC,mBAAmB,CAAC,CAAC;gBACzD,wCAAwC;gBACxC,IAAM,SAAS,GAAG,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;gBAC7C,IAAM,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;gBAE9C,QAAQ,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;gBAE9B,uBAAuB;gBACvB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;gBAElB,8CAA8C;gBAC9C,MAAM,CAAC,GAAG,CAAC;oBACP,MAAM,EAAE,MAAM;oBACd,KAAK,EAAE,KAAK;iBACf,CAAC,CAAC;gBAEH,qCAAqC;gBACrC,MAAM;qBACD,IAAI,EAAE;qBACN,IAAI,CACD,KAAK,CAAC,IAAI,CAAC,iBAAiB,EAAE,IAAI,EAAE,SAAS,EAAE,MAAM,EAAE,MAAM,EAAE,QAAQ,CAAC,EACxE,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,EAAE,UAAU,CAAC,CAChD,CAAC;aACT;QACL,CAAC;QAED,UAAU,EAAE;YACR,wCAAwC,EAAE;gBACtC,OAAO,IAAI,yBAAyB,CAAC;oBACjC,KAAK,EAAE,IAAI,CAAC,KAAK;oBACjB,eAAe,EAAE,KAAK;iBACzB,CAAC,CAAC;YACP,CAAC;YACD,4BAA4B,EAAE;gBAC1B,IAAM,UAAU,GAAG,IAAI,QAAQ,CAAC,UAAU,CACtC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,sBAAsB,CAAC,EAAE,UAAS,KAAK,EAAE,GAAG;oBAC7D,OAAO;wBACH,KAAK,EAAE,GAAG;wBACV,MAAM,EAAE,KAAK;qBAChB,CAAC;gBACN,CAAC,CAAC,CACL,CAAC;gBAEF,OAAO,IAAI,sBAAsB,CAAC;oBAC9B,UAAU,EAAE,UAAU;oBACtB,SAAS,EAAE,yBAAyB;oBACpC,gBAAgB,EAAE;wBACd,eAAe,EAAE,KAAK;wBACtB,SAAS,EAAE,kBAAkB;qBAChC;oBACD,WAAW,EAAE,CAAC;iBACjB,CAAC,CAAC;YACP,CAAC;SACJ;QAED,mEAAmE;QACnE,UAAU,EAAE;YACR,IAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;YAC5C,KAAK,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;YAEzB,4CAA4C;YAC5C,OAAO;gBACH,qCAAqC;gBACrC,eAAe,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,YAAY,CAAC,IAAI,IAAI,IAAI,EAAE,CAAC,YAAY,EAAE;gBAC1E,iCAAiC;gBACjC,WAAW,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC;gBACpC,kCAAkC;gBAClC,YAAY,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,IAAI,IAAI,KAAK,CAAC,SAAS,CAAC,WAAW,CAAC;gBAC3E,uCAAuC;gBACvC,gBAAgB,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,YAAY,CAAC;gBAChD,gCAAgC;gBAChC,UAAU,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,OAAO,EAAE,IAAI,CAAC;gBACzD,mEAAmE;gBACnE,4CAA4C,EAAE,CAAC,CAAC,CAAC,CAAC,MAAM,CACpD,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,sBAAsB,CAAC,CACzC,CAAC,MAAM;gBACR,wCAAwC;gBACxC,iBAAiB,EAAE,IAAI,CAAC,iBAAiB;gBACzC,uCAAuC;gBACvC,iBAAiB,EAAE,KAAK,CAAC,KAAK;oBAC1B,CAAC,CAAC,cAAW,KAAK,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAE;oBAC5D,CAAC,CAAC,EAAE;gBACR,8BAA8B;gBAC9B,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,YAAY,CAAC;gBACtC,8CAA8C;gBAC9C,uBAAuB,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,cAAc,CAAC,GAAG,CAAC;gBAC3D,iCAAiC;gBACjC,WAAW,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,cAAc,CAAC;gBAC3C,0CAA0C;gBAC1C,oBAAoB,EAAE,KAAK,CAAC,KAAK;oBAC7B,CAAC,CAAC,cAAW,KAAK,CAAC,oBAAoB,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAE;oBAChE,CAAC,CAAC,EAAE;gBACR,4CAA4C;gBAC5C,qBAAqB,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,kBAAkB,CAAC,GAAG,CAAC;gBAC7D,oCAAoC;gBACpC,cAAc,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,kBAAkB,CAAC;aACrD,CAAC;QACN,CAAC;KACJ,CAAC,CAAC","file":"ProductReviews.Review.View.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"ProductReviews.Review.View\"/>\n\nimport * as _ from 'underscore';\nimport * as product_reviews_review from 'product_reviews_review.tpl';\nimport * as Utils from '../../Utilities/JavaScript/Utils';\nimport * as jQuery from '../../Core/JavaScript/jQuery';\nimport { GlobalViewsMessageView } from '../../GlobalViews/JavaScript/GlobalViews.Message.View';\n\nimport GlobalViewsStarRatingView = require('../../GlobalViews/JavaScript/GlobalViews.StarRating.View');\nimport Backbone = require('../../Utilities/JavaScript/backbone.custom');\nimport BackboneView = require('../../BackboneExtras/JavaScript/Backbone.View');\nimport BackboneCollectionView = require('../../Backbone.CollectionView/JavaScript/Backbone.CollectionView');\nimport Cookies = require('../../../Commons/Utilities/JavaScript/js.cookie');\n\n// @class ProductReviews.Review.View This view is shown when listing\n// the reviews of an item contains event handlers for voting helpfulness\n// and flaging a review @extend {BackboneView}\n\nexport = BackboneView.extend({\n    template: product_reviews_review,\n\n    events: {\n        'click button[data-action=\"vote\"]': 'markReview'\n    },\n\n    initialize: function(options) {\n        this.collection = options.collection;\n        this.showActionButtons = options.showActionButtons;\n        this.voted = false;\n    },\n\n    // @method handleMarkSuccess Handle async logic after marking a review as useful or not useful\n    // @param {Number} review_id\n    // @param {string} action Indicate if the action was marking the review as useful or not\n    // @param {ProductReviews.Model} review Review Model\n    // @param {jQuery.Element} $element jQuery element that represent the button\n    handleMarkSuccess: function(review_id, action, review, $element) {\n        const currentReviewedItems = JSON.parse(Cookies.get('votedReviewsId') || '{}');\n\n        // this should be always false because you cannot mark an already marked review\n        if (!currentReviewedItems[review_id]) {\n            currentReviewedItems[review_id] = {};\n            currentReviewedItems[review_id][action] = true;\n            Cookies.set('votedReviewsId', JSON.stringify(currentReviewedItems), { expires: 365 });\n\n            const rated: any = {};\n            rated[action] = true;\n            rated.voted = true;\n            review.set('rated', rated);\n        }\n\n        this.model = review;\n\n        const global_view_message = new GlobalViewsMessageView({\n            message: Utils.translate('<strong>Thank You!</strong> We love your feedback.'),\n            type: 'success',\n            closable: true\n        });\n\n        $element.html(\n            action === 'mark-as-useful'\n                ? Utils.translate('Yes ($(0))', this.model.get('useful_count'))\n                : Utils.translate('No ($(0))', this.model.get('not_useful_count'))\n        );\n\n        this.$el.find($element).addClass('product-reviews-review-voted');\n\n        this.$el\n            .find('[data-type=\"alert-placeholder\"]')\n            .html(global_view_message.render().$el.html());\n    },\n\n    // @method handleMarkError Handle the logic after marking a review\n    // as useful or not useful in the case the synchronization with the back-end\n    // produce an error\n    // @param {jQuery} $container jQuery element containing the review\n    handleMarkError: function($container) {\n        const global_view_message = new GlobalViewsMessageView({\n            message: Utils.translate(\n                '<b>We are sorry!</b> There has been an error, please try again later.'\n            ),\n            type: 'warning',\n            closable: true\n        });\n\n        // otherwise we show an error message\n        $container\n            .find('[data-action=\"vote\"]')\n            .removeClass('disabled')\n            .end()\n            .find('[data-type=\"alert-placeholder\"]')\n            .html(global_view_message.render().$el.html());\n    },\n\n    // @method markReview Handles the ajax call to vote or flag a review //@param {Event} e\n    markReview: function(e) {\n        const $element = jQuery(e.target);\n\n        if (!$element.hasClass('disabled') && !this.voted) {\n            const rated = {};\n            const { proxy } = jQuery;\n            const action = $element.data('type');\n            const $container = $element.closest('.review-container');\n            // we get the review from the collection\n            const review_id = $element.data('review-id');\n            const review = this.collection.get(review_id);\n\n            $element.addClass('disabled');\n\n            // lock buttons reviews\n            this.voted = true;\n\n            // we set the action that we are going to call\n            review.set({\n                action: action,\n                rated: rated\n            });\n\n            // and then we do the save the review\n            review\n                .save()\n                .then(\n                    proxy(this.handleMarkSuccess, this, review_id, action, review, $element),\n                    proxy(this.handleMarkError, this, $container)\n                );\n        }\n    },\n\n    childViews: {\n        'ProductReview.Review.Global.StarRating': function() {\n            return new GlobalViewsStarRatingView({\n                model: this.model,\n                showRatingCount: false\n            });\n        },\n        'Global.StarRatingAttribute': function() {\n            const collection = new Backbone.Collection(\n                _.map(this.model.get('rating_per_attribute'), function(value, key) {\n                    return {\n                        label: key,\n                        rating: value\n                    };\n                })\n            );\n\n            return new BackboneCollectionView({\n                collection: collection,\n                childView: GlobalViewsStarRatingView,\n                childViewOptions: {\n                    showRatingCount: false,\n                    className: 'pegs text-center'\n                },\n                viewsPerRow: 1\n            });\n        }\n    },\n\n    // @method getContext @returns {ProductReviews.Review.View.Context}\n    getContext: function() {\n        const rated = this.model.get('rated') || {};\n        rated.voted = this.voted;\n\n        // @class ProductReviews.Review.View.Context\n        return {\n            // @property {String} reviewCreatedOn\n            reviewCreatedOn: this.model.get('created_on') || new Date().toDateString(),\n            // @property {String} reviewTitle\n            reviewTitle: this.model.get('title'),\n            // @property {String} reviewAuthor\n            reviewAuthor: this.model.get('writer').name || Utils.translate('anonymous'),\n            // @property {Boolean} isReviewVerified\n            isReviewVerified: !!this.model.get('isVerified'),\n            // @property {String} reviewText\n            reviewText: this.model.get('text').replace(/<br>/g, '\\n'),\n            // @property {Boolean} isReviewRatingPerAttributesLegthGreaterThan0\n            isReviewRatingPerAttributesLegthGreaterThan0: !!_.values(\n                this.model.get('rating_per_attribute')\n            ).length,\n            // @property {Boolean} showActionButtons\n            showActionButtons: this.showActionButtons,\n            // @property {String} usefulButtonClass\n            usefulButtonClass: rated.voted\n                ? `disabled${rated['mark-as-useful'] ? ' btn-success' : ''}`\n                : '',\n            // @property {Number} reviewId\n            reviewId: this.model.get('internalid'),\n            // @property {Boolean} usefulCountGreaterThan0\n            usefulCountGreaterThan0: this.model.get('useful_count') > 0,\n            // @property {Number} usefulCount\n            usefulCount: this.model.get('useful_count'),\n            // @property {String} notUsefulButtonClass\n            notUsefulButtonClass: rated.voted\n                ? `disabled${rated['mark-as-not-useful'] ? ' btn-success' : ''}`\n                : '',\n            // @property {Boolean} notusefulCountGreater\n            notusefulCountGreater: this.model.get('not_useful_count') > 0,\n            // @property {Number} notUsefulCount\n            notUsefulCount: this.model.get('not_useful_count')\n        };\n    }\n});\n"]}
{"version":3,"sources":["OrderWizard.Module.Address.Shipping.ts"],"names":[],"mappings":"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","file":"OrderWizard.Module.Address.Shipping.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"OrderWizard.Module.Address.Shipping\"/>\n/// <reference path=\"../../../Commons/Utilities/JavaScript/UnderscoreExtended.d.ts\" />\n\nimport * as _ from 'underscore';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\n\nimport OrderWizardModuleAddress = require('./OrderWizard.Module.Address');\n\n// @class OrderWizard.Module.Address.Shipping @extend OrderWizard.Module.Address\nconst OrderWizardModuleAddressShipping: any = OrderWizardModuleAddress.extend({\n    manage: 'shipaddress',\n    sameAsManage: 'billaddress',\n\n    className: 'OrderWizard.Module.Address.Shipping',\n\n    errors: [\n        'ERR_CHK_INCOMPLETE_ADDRESS',\n        'ERR_CHK_SELECT_SHIPPING_ADDRESS',\n        'ERR_CHK_INVALID_SHIPPING_ADDRESS',\n        'ERR_WS_INVALID_SHIPPING_ADDRESS'\n    ],\n    sameAsMessage: Utils.translate('Same as billing address'),\n\n    selectAddressErrorMessage: {\n        errorCode: 'ERR_CHK_SELECT_SHIPPING_ADDRESS',\n        errorMessage: Utils.translate('Please select a shipping address')\n    },\n\n    invalidAddressErrorMessage: {\n        errorCode: 'ERR_CHK_INVALID_SHIPPING_ADDRESS',\n        errorMessage: Utils.translate('The selected shipping address is invalid')\n    },\n\n    selectMessage: Utils.translate('Ship to this Address'),\n\n    isActive: function(): boolean {\n        return (\n            !this.wizard.model.get('ismultishipto') && this.wizard.model.shippingAddressIsRequired()\n        );\n    },\n\n    eventHandlersOn: function() {\n        OrderWizardModuleAddress.prototype.eventHandlersOn.apply(this, arguments);\n\n        this.model.on('change:tempshipaddress', jQuery.proxy(this, 'estimateShipping'), this);\n        this.wizard.model.on('ismultishiptoUpdated', this.render, this);\n    },\n\n    eventHandlersOff: function() {\n        OrderWizardModuleAddress.prototype.eventHandlersOff.apply(this, arguments);\n\n        this.model.off('change:tempshipaddress', null, this);\n        this.model.off('change:ismultishipto', null, this);\n    },\n\n    changeAddress: function() {\n        OrderWizardModuleAddress.prototype.changeAddress.apply(this, arguments);\n\n        if (this.address) {\n            this.model.trigger('change:' + this.manage);\n        }\n    },\n\n    // @method postEvaluateDisablingSameAsCheckBox Override the method in 'OrderWizard.Module.Address' that evaluates whether the 'same as' checkbox should be enabled or not.\n    // This value is saved in the instance variable disableSameAsCheckBox.\n    // If there is only one addresss saved and selected as the shipping address and is the same as the billing address, the checkbox should be disabled. Once a new address is added the checkbox should be enable.\n    postEvaluateDisablingSameAsCheckBox: function(): void {\n        this.disableSameAsCheckBox =\n            this.addresses &&\n            this.addresses.length === 1 &&\n            this.getSelectedAddress().id === this.addresses.models[0].id\n                ? true\n                : this.disableSameAsCheckBox;\n    },\n\n    estimateShipping: function(model, address) {\n        const { siteSettings } = this.wizard.application.getConfig();\n        const { countries } = siteSettings;\n        const country_value = address && address.country;\n        const state_value = address && address.state;\n        const zip_value = address && address.zip;\n        const country_ready = country_value && country_value !== model.previous('country');\n        const state_ready =\n            (country_value && !countries[country_value].states) ||\n            (state_value && state_value !== model.previous('state'));\n        const zip_ready =\n            (country_value && countries[country_value].isziprequired === 'F') ||\n            (zip_value && zip_value !== model.previous('zip'));\n\n        if (country_ready && zip_ready && state_ready) {\n            const addresses = this.model.get('addresses');\n            const address_id =\n                country_value + '-' + (state_value || '-') + '--' + (zip_value || '-') + '----null';\n            const current_address = addresses.get(address_id);\n\n            if (!current_address) {\n                addresses.add({\n                    internalid: address_id,\n                    country: country_value,\n                    state: state_value,\n                    zip: zip_value\n                });\n            } else {\n                current_address.set({\n                    country: country_value,\n                    state: state_value,\n                    zip: zip_value\n                });\n            }\n\n            if (this.addressId !== address_id) {\n                model.set({\n                    shipaddress: address_id,\n                    isEstimating: true\n                });\n            }\n        } else {\n            model.set({ isEstimating: false });\n        }\n    }\n});\n\nexport = OrderWizardModuleAddressShipping;\n"]}
{"version":3,"sources":["SiteSearch.View.ts"],"names":[],"mappings":"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","file":"SiteSearch.View.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"SiteSearch.View\"/>\n\nimport * as _ from 'underscore';\nimport * as site_search_tpl from 'site_search.tpl';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport { Configuration } from '../../SCA/JavaScript/Configuration';\n\nimport Backbone = require('../../../Commons/Utilities/JavaScript/backbone.custom');\nimport BackboneView = require('../../../Commons/BackboneExtras/JavaScript/Backbone.View');\nimport ItemsSearcherView = require('../../ItemsSearcher/JavaScript/ItemsSearcher.View');\nimport Session = require('../../../Commons/Session/JavaScript/Session');\n\n// @class SiteSearch.View @extends Backbone.View\nexport = BackboneView.extend({\n    // @property {Function} template\n    template: site_search_tpl,\n\n    // @property {Object} events\n    events: {\n        'submit [data-action=\"search\"]': 'searchEventHandler',\n        'click [data-type=\"search-reset\"]': 'resetHandle'\n    },\n\n    // @method initialize\n    // @return {Void}\n    initialize: function() {\n        this.itemsSearcherComponent = new ItemsSearcherView({\n            minLength: Configuration.get('typeahead.minLength', 3),\n            maxLength: Configuration.get('searchPrefs.maxLength', 0),\n            limit: Configuration.get('typeahead.maxResults', 10),\n            sort: Configuration.get('typeahead.sort', 'relevance:desc'),\n            highlight: Configuration.get('typeahead.highlight', true)\n        });\n\n        this.itemsSearcherComponent.on('itemSelected', this.onItemSelected, this);\n        this.itemsSearcherComponent.on('keyUp', this.showReset, this);\n        this.itemsSearcherComponent.on('keyDown', this.cleanSearchOnEnter, this);\n\n        this.application = this.options.application;\n        // Listening the magnifying glass interactions\n        this.application.getLayout().on('toggleItemSearcher', this.toggleItemSearcher, this);\n        this.application.getLayout().on('hideItemSearcher', this.hideItemSearcher, this);\n    },\n\n    toggleItemSearcher: function() {\n        const element = this.$('[data-type=\"site-search\"]');\n        element.toggle();\n        if (element.css('display') !== 'none') {\n            this.itemsSearcherComponent.cleanSearch(true);\n            this.itemsSearcherComponent.setFocus();\n        }\n    },\n\n    hideItemSearcher: function() {\n        this.$('[data-type=\"site-search\"]').hide();\n    },\n\n    // @method showReset Handle when to show or hide the reset button\n    // @param {ItemsSearcher.View.KeyDown.Properties} event_properties\n    // @return {Void}\n    showReset: function(event_properties) {\n        if (event_properties.currentQuery) {\n            this.$('[data-type=\"search-reset\"]').show();\n        } else {\n            this.$('[data-type=\"search-reset\"]').hide();\n        }\n    },\n\n    // @method cleanSearchOnEnter Cleans the current search status\n    // @param {ItemsSearcher.View.KeyDown.Properties} event_properties\n    // @return {Void}\n    cleanSearchOnEnter: function(event_properties) {\n        if (event_properties.eventObject.keyCode === 27) {\n            this.$('[data-type=\"search-reset\"]').hide();\n            this.itemsSearcherComponent.cleanSearch();\n        }\n    },\n\n    // @method resetHandle Handle the reset action by hiding it and cleaning the current search status\n    // @return {Void}\n    resetHandle: function() {\n        this.$('[data-type=\"search-reset\"]').hide();\n        this.itemsSearcherComponent.cleanSearch();\n    },\n\n    // @method showSiteSearch Auto-show the site search form\n    showSiteSearch: function(dontFocus) {\n        this.$('[data-type=\"search-reset\"]').hide();\n        this.itemsSearcherComponent.cleanSearch(true);\n\n        if (!dontFocus) {\n            this.itemsSearcherComponent.setFocus();\n        }\n    },\n\n    // @method searchEventHandler Call on submit of the Search form\n    // @param {jQueryElement} e\n    // @return {Void}\n    searchEventHandler: function(e) {\n        e.preventDefault();\n\n        const search_term = this.itemsSearcherComponent.getCurrentQuery();\n\n        if (search_term.length < 1) {\n            return;\n        }\n\n        this.itemsSearcherComponent.cleanSearch();\n\n        this.executeSearch(search_term);\n    },\n\n    // @method search This method handle the navigation to the search result page. This happens when the user press enter or click the 'Go' button\n    // @param {String} keywords\n    // @return {Void}\n    executeSearch: function(keywords) {\n        if (keywords) {\n        const self = this;\n        const plp_component = this.application && this.application.getComponent('PLP');\n\n        if (!plp_component) {\n            self._executeSearch(keywords);\n        } else {\n            plp_component.setSearchText({ searchText: keywords }).fail(function(result) {\n                self._executeSearch(keywords);\n            });\n        }\n        }\n    },\n\n    _executeSearch: function(keywords) {\n        const search_url = Utils.getPathFromObject(Configuration, 'defaultSearchUrl');\n        const delimiters = Utils.getPathFromObject(Configuration, 'facetDelimiters');\n        const keywordsDelimited = delimiters\n            ? delimiters.betweenFacetsAndOptions + 'keywords' + delimiters.betweenOptionNameAndValue\n            : '?keywords=';\n\n        // If we are not in Shopping we have to redirect to it\n        if (Utils.getPathFromObject(Configuration, 'currentTouchpoint') !== 'home') {\n            // we called this using fragment instead of # because bridged domain\n            window.location.href = Utils.addParamsToUrl(Session.get('touchpoints.home'), {\n                fragment: search_url + keywordsDelimited + keywords\n            });\n        }\n        // Else we stay in the same app\n        else {\n            // We navigate to the default search url passing the keywords\n            Backbone.history.navigate(\n                search_url + keywordsDelimited + keywords + this.getCurrentSearchOptions(),\n                { trigger: true }\n            );\n        }\n    },\n\n    // @method onItemSelected Handle the selection of an item of the type-ahead result\n    // @param {ItemsSearcher.View.itemSelected.Properties} result\n    // @return {Void}\n    onItemSelected: function(result) {\n        const item = result.selectedItem;\n        const { collection } = result;\n        const query = result.currentQuery;\n\n        this.$('[data-type=\"search-reset\"]').hide();\n        this.itemsSearcherComponent.cleanSearch(true);\n\n        if (item) {\n            const path = item.get('_url');\n\n            if (Configuration.get('currentTouchpoint', '') !== 'home') {\n                // we called this using fragment instead of # because bridged domain\n                window.location.href = Utils.addParamsToUrl(Session.get('touchpoints.home'), {\n                    fragment: path\n                });\n            } else {\n                Backbone.history.navigate(path, { trigger: true });\n            }\n        } else {\n            if (!collection.length && result.isResultCompleted) {\n                return false;\n            }\n            this.executeSearch(query);\n        }\n    },\n\n    // @method getCurrentSearchOptions Returns current search options formatted as query params.\n    // @return {String}\n    getCurrentSearchOptions: function() {\n        const newOptions = [];\n        const currentOptions = Utils.parseUrlOptions(window.location.href);\n\n        _.each(currentOptions, function(value, key: any) {\n            const lowerCaseKey = key.toLowerCase();\n\n            if (lowerCaseKey === 'order' || lowerCaseKey === 'show' || lowerCaseKey === 'display') {\n                newOptions.push(lowerCaseKey + '=' + value);\n            }\n        });\n\n        let newOptionsStr = newOptions.join('&');\n\n        if (newOptionsStr.length > 0) {\n            newOptionsStr = '&' + newOptionsStr;\n        }\n\n        return newOptionsStr;\n    },\n\n    // @property {Object} childViews\n    childViews: {\n        ItemsSeacher: function() {\n            return this.itemsSearcherComponent;\n        }\n    },\n\n    // @method getContext\n    // @return {SiteSearch.View.Context}\n    getContext: function() {\n        // @class SiteSearch.View.Context\n        return {};\n        // @class SiteSearch.View\n    },\n\n    // @method destroy Override default implementation to clean up all attached events of the initialize\n    // @return {Void}\n    destroy: function() {\n        BackboneView.prototype.destroy.apply(this, arguments);\n\n        this.itemsSearcherComponent.off('itemSelected');\n        this.itemsSearcherComponent.off('keyUp');\n        this.itemsSearcherComponent.off('keyDown');\n    }\n});\n"]}
{"version":3,"sources":["PaymentInstrumentACH.List.View.ts"],"names":[],"mappings":"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","file":"PaymentInstrumentACH.List.View.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"PaymentInstrumentACH.List.View\"/>\n/// <reference path=\"../../../Commons/Utilities/JavaScript/GlobalDeclarations.d.ts\" />\n\nimport * as paymentinstrument_ach_list_tpl from 'paymentinstrument_ach_list.tpl';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport { Configuration } from '../../SCA/JavaScript/Configuration';\nimport { ProfileModel } from '../../../Commons/Profile/JavaScript/Profile.Model';\nimport { Environment } from '../../../Commons/Core/JavaScript/Environment';\n\nimport { PaymentInstrumentACHCollectionView } from './PaymentInstrumentACH.CollectionView';\nimport { PaymentInstrumentACHCollection } from './PaymentInstrumentACH.Collection';\nimport { PaymentInstrumentACHModel } from './PaymentInstrumentACH.Model';\n\nimport {\n    PageTypeView,\n    BreadCrumbPage,\n    PageTypeViewOptions\n} from '../../../Commons/Core/JavaScript/PageTypeView';\nimport { jQuery } from '../../../Commons/Core/JavaScript/jquery/JQueryExtras';\nimport { ChildViews } from '../../../Commons/Core/JavaScript/View';\nimport { AjaxRequestsKiller } from '../../../Commons/AjaxRequestsKiller/JavaScript/AjaxRequestsKiller';\nimport { CollectionEventsDefinitionACH } from '../../../ServiceContract/SC/PaymentInstrumentACH/PaymentInstrumentACH';\n\nimport Backbone = require('../../../Commons/Utilities/JavaScript/backbone.custom');\nimport GlobalViewsConfirmationView = require('../../../Commons/GlobalViews/JavaScript/GlobalViews.Confirmation.View');\n\ninterface PaymentInstrumentACHListViewContext {\n    pageHeader: string;\n    hasACH: number;\n    showBackToAccount: boolean;\n}\n\nexport class PaymentInstrumentACHListView extends PageTypeView<\n    PaymentInstrumentACHListViewContext,\n    CollectionEventsDefinitionACH<PaymentInstrumentACHCollection>\n> {\n    protected template = paymentinstrument_ach_list_tpl;\n\n    protected title = Utils.translate('ACH Payments');\n\n    protected pageHeader = Utils.translate('ACH Payments');\n\n    public attributes = {\n        id: 'PaymentMethodACHList',\n        class: 'PaymentMethodACHListView'\n    };\n\n    protected collection: PaymentInstrumentACHCollection;\n\n    protected profileModel;\n\n    public isPaymentInstrumentEnabled: boolean;\n\n    public events = {\n        'click [data-action=\"remove\"]': 'removeACH'\n    };\n\n    public constructor(options: PageTypeViewOptions) {\n        super(options);\n        this.profileModel = ProfileModel.getInstance();\n        if (!this.profileModel.get('paymentmethodsach')) {\n            this.profileModel.set('paymentmethodsach', new PaymentInstrumentACHCollection());\n        }\n        this.collection = this.profileModel.get('paymentmethodsach');\n        this.isPaymentInstrumentEnabled = Environment.getSC().ENVIRONMENT.paymentInstrumentEnabled;\n    }\n\n    public destroy(): void {\n        this.collection.off('update', this.renderOrNavigate, this);\n        this.collection.off('noconsent', this.updateAndRender, this);\n        super.destroy();\n    }\n\n    private listenCollection(): void {\n        this.collection.on('update', this.renderOrNavigate, this);\n        this.collection.on('noconsent', this.updateAndRender, this);\n    }\n\n    private updateAndRender() {\n        return this.updateCollectionList().then(() => this.render());\n    }\n\n    private renderOrNavigate(): void {\n        if (\n            this.collection.length &&\n            !(this.collection.length === 1 && this.collection.first().get('internalid') === '-1')\n        ) {\n            this.render();\n        } else {\n            Backbone.history.navigate('#ach/new', { trigger: true });\n        }\n    }\n\n    public getBreadcrumbPages = (): BreadCrumbPage[] => {\n        return [\n            {\n                text: Utils.translate('ACH'),\n                href: '/ach'\n            }\n        ];\n    };\n\n    protected getSelectedMenu(): string {\n        return 'ach';\n    }\n\n    public beforeShowContent() {\n        return this.updateCollectionList().then(() => {\n            this.listenCollection();\n        });\n    }\n\n    public updateCollectionList() {\n        const promise = jQuery.Deferred();\n        return this.collection\n            .fetch({\n                killerId: AjaxRequestsKiller.getKillerId()\n            })\n            .then(() => {\n                if (!this.collection.length) {\n                    promise.reject();\n                    Backbone.history.navigate('#ach/new', { trigger: true });\n                } else {\n                    promise.resolve();\n                }\n                return promise;\n            });\n    }\n\n    public getPaymentMethodsToShow(): PaymentInstrumentACHCollection | [] {\n        let payment_methods_to_show;\n\n        if (this.collection && !!this.collection.length) {\n            this.collection.remove('-temporal-');\n            payment_methods_to_show = this.collection.getCollectionForRendering();\n        }\n        return payment_methods_to_show ? payment_methods_to_show.models : [];\n    }\n\n    protected getChildViews(): ChildViews {\n        return {\n            'ACH.Collection': (): PaymentInstrumentACHCollectionView => {\n                if (this.isPaymentInstrumentEnabled) {\n                    let viewsPerRow = Configuration.get('itemsPerRow');\n\n                    if (Utils.isDesktopDevice()) {\n                        viewsPerRow = viewsPerRow || 3;\n                    } else if (Utils.isTabletDevice()) {\n                        viewsPerRow = viewsPerRow || 2;\n                    } else {\n                        viewsPerRow = viewsPerRow || 1;\n                    }\n\n                    if (this.collection && !!this.collection.length) {\n                        this.collection.remove('-temporal-');\n                        this.collection = this.collection.getCollectionForRendering();\n                    }\n\n                    return new PaymentInstrumentACHCollectionView(\n                        <PaymentInstrumentACHModel[]>(<unknown>this.collection) || [],\n                        {\n                            collection: this.collection,\n                            hideSelector: true,\n                            viewsPerRow: viewsPerRow,\n                            showActions: true\n                        }\n                    );\n                }\n                return null;\n            }\n        };\n    }\n\n    public removeACH(e): void {\n        e.preventDefault();\n        const deleteConfirmationView = new GlobalViewsConfirmationView({\n            callBack: this.removeACHFromCollection,\n            callBackParameters: {\n                context: this,\n                achId: jQuery(e.target).data('id')\n            },\n            title: Utils.translate('Remove ACH'),\n            body: Utils.translate('Are you sure you want to remove this ACH?'),\n            autohide: true\n        });\n        this.options.application.getLayout().showInModal(deleteConfirmationView, this.options);\n    }\n\n    private removeACHFromCollection(options): void {\n        options.context.collection\n            .get(options.achId)\n            .destroy({ wait: true })\n            .then(() => options.context.updateAndRender());\n    }\n\n    public getContext(): PaymentInstrumentACHListViewContext {\n        return {\n            pageHeader: this.pageHeader,\n            hasACH: this.collection.length,\n            showBackToAccount: Configuration.get('siteSettings.sitetype') === 'STANDARD'\n        };\n    }\n}\n"]}
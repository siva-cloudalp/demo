{"version":3,"sources":["TrackingServices.ts"],"names":[],"mappings":"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","file":"TrackingServices.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"TrackingServices\"/>\n// @module TrackingServices Implements the feature present in myaccount to physically track an order's items.\n// It support UPS, USPS and FedEx outof the box but others can be added in the services object. It uses google search page as the 'default service'.\n\nimport * as _ from 'underscore';\n\n// sums up all elements in the array\nconst sum = function(numbers) {\n    return _.reduce(\n        numbers,\n        function(memo, num) {\n            return <any>memo + num;\n        },\n        0\n    );\n};\nconst parse = function(string) {\n    if (!string) {\n        return '';\n    }\n\n    return _.isString(string)\n        ? string\n              .replace(' ', '')\n              .replace('\t', '')\n              .replace('-', '')\n              .toUpperCase()\n        : string + '';\n};\n\n// @class TrackingServices\nconst TrackingServices: any = {\n    // @property {Object<String,TrackingService>} services\n    // [Tracking URLs](http://verysimple.com/2011/07/06/ups-tracking-url/)\n    // [Carriers Algorithms](http://answers.google.com/answers/threadview/id/207899.html)\n    services: {\n        UPS: {\n            name: 'UPS',\n            url: 'http://wwwapps.ups.com/WebTracking/track?track=yes&trackNums=',\n            validate: function(numbers) {\n                numbers = parse(numbers);\n\n                if (numbers.substring(0, 2) !== '1Z' || numbers.length !== 18) {\n                    return false;\n                }\n\n                const check_digit = parseInt(_.last(numbers), 10);\n                const ups_chart = {\n                    A: 2,\n                    B: 3,\n                    C: 4,\n                    D: 5,\n                    E: 6,\n                    F: 7,\n                    G: 8,\n                    H: 9,\n                    I: 0,\n                    J: 1,\n                    K: 2,\n                    L: 3,\n                    M: 4,\n                    N: 5,\n                    O: 6,\n                    P: 7,\n                    Q: 8,\n                    R: 9,\n                    S: 0,\n                    T: 1,\n                    U: 2,\n                    V: 3,\n                    W: 4,\n                    X: 5,\n                    Y: 6,\n                    Z: 7\n                };\n\n                return (\n                    check_digit ===\n                    sum(\n                        _.map(numbers.substring(2, numbers.length), function(character, index) {\n                            return (\n                                (ups_chart[<any>character] || parseInt(<any>character, 10)) *\n                                (index % 2 ? 2 : 1)\n                            );\n                        })\n                    ) %\n                        10\n                );\n            }\n        },\n        USPS: {\n            name: 'USPS',\n            url: 'https://tools.usps.com/go/TrackConfirmAction_input?qtc_tLabels1=',\n            validate: function(numbers) {\n                numbers = parse(numbers);\n\n                const { length } = numbers;\n\n                if (length !== 13 && length !== 20 && length !== 22) {\n                    return false;\n                }\n\n                if (_.last(numbers, 2).join('') === 'US') {\n                    numbers = numbers.substring(2, 11);\n                }\n\n                const check_digit = parseInt(_.last(numbers), 10);\n                const validation_1 =\n                    sum(\n                        _.map(numbers, function(num, index) {\n                            return parseInt(<any>num, 10) * (index % 2 ? 1 : 3);\n                        })\n                    ) % 10;\n\n                // Usps\n                if (check_digit === 10 - validation_1 || validation_1 === 0) {\n                    return true;\n                }\n\n                const usps_chart = [8, 6, 4, 2, 3, 5, 9, 7];\n                const validation_map = {\n                    0: 5,\n                    1: 0\n                };\n                let validation_2 =\n                    sum(\n                        _.map(_.initial(numbers), function(num, index) {\n                            return <any>num * usps_chart[index];\n                        })\n                    ) % 11;\n\n                validation_2 = validation_map[validation_2] || 11 - validation_2;\n\n                // Usps Exp\n                return check_digit === validation_2;\n            }\n        },\n        FedEx: {\n            name: 'FedEx',\n            url: 'http://www.fedex.com/Tracking?action=track&tracknumbers=',\n            validate: function(numbers) {\n                numbers = parse(numbers);\n\n                const { length } = numbers;\n\n                if (length !== 12 && length !== 15 && length !== 22) {\n                    return false;\n                }\n\n                if (length === 22) {\n                    if (parseInt(numbers.substring(0, 2), 10) === 96) {\n                        numbers = numbers.substring(0, 7);\n                    } else {\n                        return false;\n                    }\n                }\n\n                // Fedex Ground\n                const check_digit = parseInt(_.last(numbers), 10);\n                // All the numbers but the check_digit in reverse order\n                const initial_numbers = _.initial(numbers).reverse();\n                // math for the check digit\n                const validation_1 =\n                    10 -\n                    (sum(\n                        _.map(initial_numbers, function(number, index) {\n                            return <any>number * (index % 2 ? 1 : 3);\n                        })\n                    ) %\n                        10);\n\n                // Fedex Ground\n                if (check_digit === validation_1) {\n                    return true;\n                }\n\n                let counter = 0;\n                const digits = [1, 3, 7];\n                const getDigit = function() {\n                    const to_be_returned = counter;\n                    counter = counter + 1 < digits.length ? counter + 1 : 0;\n                    return to_be_returned;\n                };\n                const validation_2 =\n                    (sum(\n                        _.map(initial_numbers, function(number) {\n                            return <any>number * digits[getDigit()];\n                        })\n                    ) %\n                        11) %\n                    10;\n\n                // Fedex Express\n                return check_digit === validation_2;\n            }\n        }\n    },\n\n    // @property {String} defaultUrl the default url to resolve unknown service names\n    defaultUrl: 'http://www.google.com/search?q=',\n\n    // @method getServiceUrl @param {String} tracking_number @return {String}\n    getServiceUrl: function(tracking_number) {\n        const service = _.find(this.services, function(service) {\n            return (<any>service).validate(parse(tracking_number));\n        });\n\n        return (service ? (<any>service).url : this.defaultUrl) + tracking_number;\n    },\n\n    // @property {String} defaultName\n    defaultName: null,\n\n    // @method getServiceName @param {String} tracking_number @return {String}\n    getServiceName: function(tracking_number) {\n        const service = _.find(this.services, function(service) {\n            return (<any>service).validate(parse(tracking_number));\n        });\n\n        return service ? (<any>service).name : this.defaultName;\n    }\n};\n\nexport = TrackingServices;\n// @class TrackingService @property {String} name @property {String} url\n// @method validate @param {String} numbers @return {Boolean}\n"]}
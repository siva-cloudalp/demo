{"version":3,"sources":["RequestQuoteWizard.Module.QuickAdd.ts"],"names":[],"mappings":"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","file":"RequestQuoteWizard.Module.QuickAdd.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"RequestQuoteWizard.Module.QuickAdd\"/>\n\nimport * as _ from 'underscore';\nimport * as requestquote_wizard_module_quickadd_tpl from 'requestquote_wizard_module_quickadd.tpl';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\nimport { WizardStepModule } from '../../Wizard/JavaScript/Wizard.StepModule';\n\nimport QuickAddView = require('../../QuickAdd/JavaScript/QuickAdd.View');\n\n// @class RequestQuoteWizard.Module.QuickAdd @extend Wizard.Module\nexport = WizardStepModule.extend({\n    // @property {Function} template\n    template: requestquote_wizard_module_quickadd_tpl,\n\n    // @property {errorCode: String, errorMessage:String} selectItemErrorMessage Specification of the error when no item is selected\n    selectItemErrorMessage: {\n        errorCode: 'ERR_RQW_SELECT_AN_ITEM',\n        errorMessage: Utils.translate('Please select at least one item')\n    },\n\n    // @property {Array<String>} errors\n    errors: ['ERR_RQW_SELECT_AN_ITEM'],\n\n    // @method initialize Override default method to make this module composite\n    // @return {Void}\n    initialize: function() {\n        WizardStepModule.prototype.initialize.apply(this, arguments);\n    },\n\n    // @method getItemQuantitySet Auxiliary method used to provide the amount of already added items into the transaction to the quick add component\n    // @param {Number} item_id\n    // @return {Number}\n    getItemQuantitySet: function(item_id) {\n        const selected_line = this.wizard.model.get('lines').find(function(line) {\n            return line.get('item').id === item_id;\n        });\n\n        return selected_line ? parseInt(selected_line.get('quantity'), 10) : 0;\n    },\n\n    // @method addNewLine\n    // @param {QuickAdd.View.SelectedLine.Properties} options\n    // @return {Void}\n    addNewLine: function(options) {\n        const selected_line = this.wizard.model.get('lines').find(function(line) {\n            // as line save child item it does not matter use getItemId or get('item')\n            return line.get('item').id === options.selectedLine.get('item').id;\n        });\n        let price;\n\n        if (!selected_line) {\n            price = options.selectedLine.getPrice();\n            options.selectedLine.set('rate', price.price);\n            options.selectedLine.set('rate_formatted', price.price_formatted);\n            this.wizard.model.get('lines').add(options.selectedLine, { at: 0 });\n        } else {\n            this.setLineIndex(selected_line, 0, this.wizard.model.get('lines'));\n            selected_line.set(\n                'quantity',\n                selected_line.get('quantity') + options.selectedLine.get('quantity')\n            );\n        }\n    },\n\n    // @method setLineIndex Sets a line in a particular position\n    // @param {Transaction.Line.Model} selected_line\n    // @param {Number} new_position\n    // @param {Transaction.Line.Collection} collection\n    // @return {Void}\n    setLineIndex: function(selected_line, new_position, collection) {\n        const old_index = _.indexOf(collection.models, selected_line);\n\n        new_position = new_position || 0;\n\n        collection.models.splice(old_index, 1);\n        collection.models.splice(new_position, 0, selected_line);\n    },\n\n    // @property {ChildViews} childViews\n    childViews: {\n        QuickAddView: function() {\n            this.quickAddViewComponent = new QuickAddView({\n                getItemQuantitySet: _.bind(this.getItemQuantitySet, this),\n                showBackorderable: true\n            });\n            this.quickAddViewComponent.on('selectedLine', this.addNewLine, this);\n            return this.quickAddViewComponent;\n        }\n    },\n\n    // @method isValid Check if there is at least one item selected\n    // @return {jQuery.Deferred}\n    isValid: function() {\n        return this.wizard.model.get('lines').length\n            ? jQuery.Deferred().resolve()\n            : jQuery.Deferred().reject(this.selectItemErrorMessage);\n    },\n\n    // @method getContext\n    // @return {RequestQuoteWizard.Module.QuickAdd.Context}\n    getContext: function() {\n        // @class RequestQuoteWizard.Module.QuickAdd.Context\n        return {\n            // @property {String} pageHeader\n            pageHeader: this.page_header\n        };\n        // @class RequestQuoteWizard.Module.QuickAdd\n    }\n});\n"]}
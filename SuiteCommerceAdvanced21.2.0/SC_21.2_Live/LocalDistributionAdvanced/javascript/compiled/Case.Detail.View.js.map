{"version":3,"sources":["Case.Detail.View.ts"],"names":[],"mappings":"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","file":"Case.Detail.View.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"Case.Detail.View\"/>\n// @Typescript-full\n\nimport * as _ from 'underscore';\nimport * as case_detail_tpl from 'case_detail.tpl';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\nimport { CaseModel } from './Case.Model';\nimport { CaseFieldsModel } from './Case.Fields.Model';\nimport { AjaxRequestsKiller } from '../../../Commons/AjaxRequestsKiller/JavaScript/AjaxRequestsKiller';\nimport { PageTypeFormView } from '../../../Commons/Core/JavaScript/PageTypeFormView';\nimport { BreadCrumbPage, PageTypeViewOptions } from '../../../Commons/Core/JavaScript/PageTypeView';\nimport { EventsHash } from '../../../Commons/Core/JavaScript/View';\nimport { InferModelServiceContract } from '../../../Commons/Core/JavaScript/backbone/backbone';\nimport { FormFieldsError, FormFieldValue } from '../../../Commons/Core/JavaScript/FormView';\nimport { Errors } from '../../../Commons/Core/JavaScript/Error';\nimport { Case, CaseFields } from '../../../ServiceContract/SC/Case/Case';\nimport { Environment } from '../../../Commons/Core/JavaScript/Environment';\n\ninterface CaseDetailViewContext {\n    model: CaseModel;\n    pageHeader: string;\n    collapseElements: string;\n    closeStatusId: boolean;\n}\n\nexport interface BeforeShowContentPromise {\n    caseResult: Case;\n    caseFieldsResult: CaseFields;\n}\n\nexport class CaseDetailView extends PageTypeFormView<CaseModel, CaseDetailViewContext> {\n    private fields: CaseFieldsModel;\n\n    protected template = case_detail_tpl;\n\n    protected title = Utils.translate('Case Details');\n\n    public attributes = {\n        id: '',\n        class: 'caseDetail'\n    };\n\n    public constructor(options: PageTypeViewOptions) {\n        super(options, new CaseModel());\n\n        const caseInternalId = options.routerArguments[0];\n        this.formModel.set('internalid', caseInternalId);\n\n        this.fields = new CaseFieldsModel();\n    }\n\n    protected getEvents(): EventsHash {\n        return {\n            'submit form': 'saveForm',\n            'click [data-action=\"reset\"]': 'resetForm',\n            'click [data-action=\"close-case\"]': 'closeCase',\n            'blur [name=\"reply\"]': 'onFormFieldChange'\n        };\n    }\n\n    protected saveForm(\n        event: JQuery.TriggeredEvent\n    ): JQuery.jqXHR<InferModelServiceContract<CaseModel>> | false {\n        const saveForm = super.saveForm(event);\n        if (saveForm) {\n            saveForm.then(\n                (): void => {\n                    this.showContent().then(() => {\n                        this.options.application\n                            .getLayout()\n                            .showConfirmationMessage(\n                                Utils.translate(\n                                    'Good! Your message was sent. A support representative should contact you briefly.'\n                                )\n                            );\n                    });\n                }\n            );\n        }\n        return saveForm;\n    }\n\n    protected getFormFieldValue(changedInput: JQuery<HTMLElement>): FormFieldValue<Case> {\n        const newVal = changedInput.val();\n        const fieldName = changedInput.attr('name');\n        if (fieldName === 'reply' && typeof newVal === 'string') {\n            return {\n                name: fieldName,\n                value: newVal\n            };\n        }\n        return {\n            name: fieldName || '',\n            error: Utils.translate(`Please provide a valid ${fieldName}`)\n        };\n    }\n\n    protected getFormValues(\n        $savingForm: JQuery<HTMLElement>\n    ): Partial<Case> | FormFieldsError<Case> {\n        const formValues = $savingForm.serializeObject();\n        let reply = '';\n        const errorsResult: FormFieldsError<Case> = {\n            errorCode: Errors.FormValidation,\n            errors: {}\n        };\n\n        if ('reply' in formValues && typeof formValues.reply === 'string' && formValues.reply) {\n            reply = formValues.reply;\n        } else {\n            errorsResult.errors.reply = Utils.translate('reply is required');\n        }\n\n        if (reply) {\n            return {\n                reply\n            };\n        }\n\n        return errorsResult;\n    }\n\n    public beforeShowContent<BeforeShowContentPromise>(): Promise<BeforeShowContentPromise> {\n        return jQuery\n            .when(\n                this.formModel.fetch({\n                    killerId: AjaxRequestsKiller.getKillerId()\n                }),\n                this.fields.fetch({\n                    killerId: AjaxRequestsKiller.getKillerId()\n                })\n            )\n            .then((caseResult: Case, caseFieldsResult: CaseFields) => {\n                return { caseResult, caseFieldsResult };\n            });\n    }\n\n    public getSelectedMenu(): string {\n        return 'cases';\n    }\n\n    public getBreadcrumbPages = (): BreadCrumbPage[] => {\n        return [\n            {\n                text: Utils.translate('Support Cases'),\n                href: '/cases'\n            },\n            {\n                text: Utils.translate('Case #$(0)', this.formModel.get('internalid') || ''),\n                href: `/case/${this.formModel.get('internalid')}`\n            }\n        ];\n    };\n\n    private showError(message, type?, closable?, disableElements?) {\n        const Application = Environment.getApplication();\n        const layout = Application.getLayout();\n        layout.showError(message, type, closable, disableElements);\n    }\n\n    private closeCase(event: JQuery.TriggeredEvent): void {\n        event.preventDefault();\n\n        this.formModel.set('reply', '');\n        this.formModel.set('status', {\n            id: this.options.application.getConfig().cases.defaultValues.statusClose.id,\n            name: ''\n        });\n\n        this.formModel.isClosing = true;\n\n        const saveResult = this.formModel.save();\n\n        if (saveResult) {\n            saveResult.done(() => {\n                this.formModel.isClosing = false;\n                this.showContent().then(() => {\n                    this.options.application\n                        .getLayout()\n                        .showConfirmationMessage(Utils.translate('Case successfully closed'));\n                });\n            });\n        }\n    }\n\n    private resetForm(event: JQuery.TriggeredEvent): void {\n        event.preventDefault();\n        this.showContent();\n    }\n\n    public getContext(): CaseDetailViewContext {\n        _.each(this.formModel.get('grouped_messages'), function(groupMessage) {\n            _.each(groupMessage.messages, function(message) {\n                message.text = Utils.parseRichText(message.text);\n            });\n        });\n        return {\n            model: this.formModel,\n            pageHeader: Utils.translate('Case #$(0):', this.formModel.get('caseNumber')),\n            collapseElements: this.options.application.getConfig().sca.collapseElements,\n            closeStatusId:\n                this.formModel.get('status').id !==\n                this.options.application.getConfig().cases.defaultValues.statusClose.id\n        };\n    }\n}\n"]}
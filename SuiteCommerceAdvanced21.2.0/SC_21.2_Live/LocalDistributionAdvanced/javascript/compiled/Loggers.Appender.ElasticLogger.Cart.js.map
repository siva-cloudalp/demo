{"version":3,"sources":["Loggers.Appender.ElasticLogger.Cart.ts"],"names":[],"mappings":"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","file":"Loggers.Appender.ElasticLogger.Cart.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"Loggers.Appender.ElasticLogger.Cart\"/>\n\nimport * as _ from 'underscore';\nimport { Loggers } from './Loggers';\n\nimport LiveOrderModel = require('../../LiveOrder/JavaScript/LiveOrder.Model');\n\nexport function mountToApp() {\n    const logger = Loggers.getLogger();\n    const liveOrder = LiveOrderModel.getInstance();\n    let freeItemsBeforeAddLine = [];\n    let freeItemsBeforeRemoveLine = [];\n    let freeItemsBeforeAddPromotion = [];\n    let freeItemsBeforeRemovePromotion = [];\n    let submitLines = [];\n\n    liveOrder.on('before:LiveOrder.addLines', () => {\n        const lines = liveOrder.get('lines');\n        freeItemsBeforeAddLine = [];\n\n        lines.forEach((line: any) => {\n            if (line.get('free_gift') && line.get('item')) {\n                freeItemsBeforeAddLine.push(line.get('item').get('internalid'));\n            }\n        });\n    });\n\n    liveOrder.on('after:LiveOrder.addLines', () => {\n        const lines = liveOrder.get('lines');\n        const obj = {\n            componentArea: 'ADDED_TO_CART',\n            freeGiftQty: 0\n        };\n\n        const newInternalids = [];\n\n        lines.forEach((line: any) => {\n            const newLine =\n                _.indexOf(freeItemsBeforeAddLine, line.get('item').get('internalid')) === -1;\n\n            if (line.get('free_gift') && newLine && line.get('item')) {\n                newInternalids.push(line.get('item').get('internalid'));\n            }\n        });\n\n        if (newInternalids.length) {\n            obj.freeGiftQty = newInternalids.length;\n            // Because afterAddLine is triggered many times consecutively,\n            // we must refresh the old free items.\n            freeItemsBeforeAddLine = [...freeItemsBeforeAddLine, ...newInternalids];\n            logger.info(obj);\n        }\n    });\n\n    liveOrder.on('before:LiveOrder.addPromotion', () => {\n        const lines = liveOrder.get('lines');\n        freeItemsBeforeAddPromotion = [];\n\n        lines.forEach((line: any) => {\n            if (line.get('free_gift') && line.get('item')) {\n                freeItemsBeforeAddPromotion.push(line.get('item').get('internalid'));\n            }\n        });\n    });\n\n    liveOrder.on('after:LiveOrder.addPromotion', () => {\n        const lines = liveOrder.get('lines');\n        const obj = {\n            componentArea: 'ADDED_TO_CART',\n            freeGiftQty: 0\n        };\n\n        const newInternalids = [];\n\n        lines.forEach((line: any) => {\n            const newLine =\n                _.indexOf(freeItemsBeforeAddPromotion, line.get('item').get('internalid')) === -1;\n\n            if (line.get('free_gift') && newLine && line.get('item')) {\n                newInternalids.push(line.get('item').get('internalid'));\n            }\n        });\n\n        if (newInternalids.length) {\n            obj.freeGiftQty = newInternalids.length;\n            freeItemsBeforeAddPromotion = [...freeItemsBeforeAddPromotion, ...newInternalids];\n            logger.info(obj);\n        }\n    });\n\n    liveOrder.on('before:LiveOrder.removePromotion', () => {\n        const lines = liveOrder.get('lines');\n        freeItemsBeforeRemovePromotion = [];\n\n        lines.forEach((line: any) => {\n            if (line.get('free_gift') && line.get('item')) {\n                freeItemsBeforeRemovePromotion.push(line.get('item').get('internalid'));\n            }\n        });\n    });\n\n    liveOrder.on('after:LiveOrder.removePromotion', () => {\n        const lines = liveOrder.get('lines');\n        const obj = {\n            componentArea: 'REMOVED_FROM_CART',\n            freeGiftQty: 0\n        };\n\n        const internalids = [];\n\n        lines.forEach((line: any) => {\n            if (line.get('free_gift') && line.get('item')) {\n                internalids.push(line.get('item').get('internalid'));\n            }\n        });\n\n        const removedInternalids = _.difference(freeItemsBeforeRemovePromotion, internalids);\n\n        if (removedInternalids.length) {\n            obj.freeGiftQty = removedInternalids.length;\n            freeItemsBeforeRemovePromotion = internalids;\n            logger.info(obj);\n        }\n    });\n\n    liveOrder.on('before:LiveOrder.removeLine', () => {\n        const lines = liveOrder.get('lines');\n        freeItemsBeforeRemoveLine = [];\n\n        lines.forEach((line: any) => {\n            if (line.get('free_gift') && line.get('item')) {\n                freeItemsBeforeRemoveLine.push(line.get('item').get('internalid'));\n            }\n        });\n    });\n\n    liveOrder.on('after:LiveOrder.removeLine', () => {\n        const lines = liveOrder.get('lines');\n        const obj = {\n            componentArea: 'REMOVED_FROM_CART',\n            freeGiftQty: 0\n        };\n\n        const internalids = [];\n\n        lines.forEach((line: any) => {\n            if (line.get('free_gift') && line.get('item')) {\n                internalids.push(line.get('item').get('internalid'));\n            }\n        });\n\n        const removedInternalids = _.difference(freeItemsBeforeRemoveLine, internalids);\n\n        if (removedInternalids.length) {\n            obj.freeGiftQty = removedInternalids.length;\n            freeItemsBeforeRemoveLine = internalids;\n            logger.info(obj);\n        }\n    });\n\n    liveOrder.on('before:LiveOrder.submit', () => {\n        submitLines = liveOrder.get('lines');\n    });\n\n    liveOrder.on('after:LiveOrder.submit', () => {\n        const obj = {\n            componentArea: 'PLACED_ORDER',\n            freeGiftQty: 0\n        };\n\n        submitLines.forEach((line: any) => {\n            if (line.get('free_gift')) {\n                obj.freeGiftQty++;\n            }\n        });\n\n        logger.info(obj);\n    });\n}\n"]}
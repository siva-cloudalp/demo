{"version":3,"sources":["CMSadapter.Impl.Categories.ts"],"names":[],"mappings":"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","file":"CMSadapter.Impl.Categories.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"CMSadapter.Impl.Categories\"/>\n\nimport * as _ from 'underscore';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\nimport { CategoriesModel } from '../../../Commons/Categories/JavaScript/Categories.Model';\nimport { CategoriesCollection } from '../../../Commons/Categories/JavaScript/Categories.Collection';\nimport { Configuration } from '../../SCA/JavaScript/Configuration';\nimport { MasterOptionsHelper } from '../../../Commons/SC/JavaScript/MasterOptionsHelper';\nimport { AjaxRequestsKiller } from '../../../Commons/AjaxRequestsKiller/JavaScript/AjaxRequestsKiller';\n\nimport FacetsModel = require('../../../Commons/Facets/JavaScript/Facets.Model');\nimport FacetsHelper = require('../../../Commons/Facets/JavaScript/Facets.Helper');\nimport FacetsBrowseView = require('../../../Commons/Facets/JavaScript/Facets.Browse.View');\nimport FacetsRouter = require('../../../Commons/Facets/JavaScript/Facets.Router');\nimport Categories = require('../../../Commons/Categories/JavaScript/Categories');\n\nimport Backbone = require('../../../Commons/Utilities/JavaScript/backbone.custom');\n\n/*\n\n@module CMSadapter\n\n@class CMSadapter.Impl.Categories the class that do the actual integration job using the CMS API. Usage:\n\n\tvar adapter = new CMSadapterImpl(application, CMS);\n\tadapter.init();\n\nThis will start the cms adapter, for example listening to the ESC key to be pressed to load the CMS\nadministrator and collaborating with with it to accomplish use cases (mostly landing pages).\n\nIn addition the PageRouter must be initialized to implement the full pages experience.\n\n*/\n\nfunction AdapterCategories(application, CMS) {\n    this.CMS = CMS;\n    this.application = application;\n\n    this.listenForCMS();\n}\n\nAdapterCategories.prototype.listenForCMS = jQuery.noop;\n\nAdapterCategories.prototype._convertToCategory = function _convertToCategory(categoryData) {\n    // TODO: manage overrides\n\n    return {\n        name: categoryData.name,\n        description: categoryData.description,\n        pagetitle: categoryData.page_title,\n        pageheading: categoryData.page_header,\n        pagebanner: '',\n        addtohead: categoryData.add_to_head,\n        metakeywords: categoryData.meta_keywords,\n        metadescription: categoryData.meta_description,\n        categories: [],\n        breadcrumb: [\n            {\n                name: categoryData.name,\n                fullurl: ''\n            }\n        ]\n    };\n\n    /*\n\t//TODO: manage add sub category\n\n\tvar category = this.category ? this.category : { 'breadcrumb': [{ 'name': '', 'fullurl': '' }] };\n\n\tcategory.name = categoryData.overrides && categoryData.overrides.name ? categoryData.overrides.name : categoryData.name;\n\tcategory.description = categoryData.overrides && categoryData.overrides.description ? categoryData.overrides.description : categoryData.description;\n\tcategory.pagetitle = categoryData.overrides && categoryData.overrides.page_title ? categoryData.overrides.page_title : categoryData.page_title;\n\tcategory.pageheading = categoryData.overrides && categoryData.overrides.page_header ? categoryData.overrides.page_header : categoryData.page_header;\n\tcategory.addtohead = categoryData.overrides && categoryData.overrides.add_to_head ? categoryData.overrides.add_to_head : categoryData.add_to_head;\n\tcategory.metakeywords = categoryData.overrides && categoryData.overrides.meta_keywords ? categoryData.overrides.meta_keywords : categoryData.meta_keywords;\n\tcategory.metadescription = categoryData.overrides && categoryData.overrides.meta_description ? categoryData.overrides.meta_description : categoryData.meta_description;\n\n\tcategory.breadcrumb[category.breadcrumb.length - 1].name = category.name;\n\n\treturn category;\n\n\t*/\n};\n\nAdapterCategories.prototype.showCategory = function(categoryData, functionToCallback) {\n    const self = this;\n    const { translatorConfig } = this.application;\n    const fullurl =\n        categoryData.urls &&\n        categoryData.urls.length &&\n        categoryData.urls[0] === 'temp_cms_new_category_url'\n            ? ''\n            : (<any>Backbone.history).fragment;\n    const translator = FacetsHelper.parseUrl(fullurl, translatorConfig, true);\n\n    const categoryModel = new CategoriesModel(this._convertToCategory(categoryData));\n    const facetsModel = new FacetsModel({ items: [], facets: [], total: 0 });\n    facetsModel.set('category', categoryModel);\n\n    facetsModel\n        .fetch({\n            data: translator.getApiParams(),\n            killerId: AjaxRequestsKiller.getKillerId()\n        })\n        .done(function() {\n            const view = new FacetsBrowseView({\n                translator,\n                translatorConfig,\n                application: self.application,\n                model: facetsModel\n            });\n\n            translator.setLabelsFromFacets(facetsModel.get('facets') || []);\n            view.showContent();\n\n            functionToCallback();\n        });\n};\n\nAdapterCategories.prototype.updateCategory = function(data, application, functionToCallback) {\n    if (data.saving) {\n        const collection = new CategoriesCollection({\n            level: Configuration.get('categories.menuLevel')\n        });\n\n        collection.fetch().done(function(menu) {\n            Categories.addToNavigationTabs(menu);\n\n            // IF is a root category AND (it was just created OR the fragment url have changed) THEN we add the url to the router\n            if (\n                !data.category.parents.length &&\n                (!data.category.last_modified || data.original_url !== data.category.urls[0])\n            ) {\n                const router = new FacetsRouter(application);\n\n                router.addUrl(data.category.urls, 'categoryLoading');\n            }\n\n            functionToCallback();\n        });\n    } else {\n        // To show the changes before saving it, we need to show the category data that sends the CMS admin\n        this.showCategory(data.category, functionToCallback);\n    }\n};\n\nAdapterCategories.prototype.removeCategory = function(functionToCallback) {\n    const collection = new CategoriesCollection({\n        level: Configuration.get('categories.menuLevel')\n    });\n\n    collection.fetch().done(function(menu) {\n        Categories.addToNavigationTabs(menu);\n\n        Backbone.history.navigate('/', { trigger: true });\n\n        functionToCallback();\n    });\n};\n\nAdapterCategories.prototype.navigate = function(data, functionToCallback) {\n    const categoryModel = new CategoriesModel({\n        data: { fullurl: Utils.correctURL(data.url) },\n        killerId: AjaxRequestsKiller.getKillerId()\n    });\n\n    const self = this;\n\n    categoryModel.fetch({}).done(function(cat) {\n        self.category = cat;\n\n        Backbone.history.navigate(data.url, { trigger: false });\n        Backbone.history.loadUrl(data.url);\n\n        functionToCallback();\n    });\n};\n\nAdapterCategories.prototype.getItems = function(filters, functionToCallback) {\n    const model = new FacetsModel({\n        searchApiMasterOptions: MasterOptionsHelper.getSearchAPIMasterOption('CmsAdapterSearch')\n    });\n\n    model\n        .fetch({\n            data: _.extend(filters, {}),\n            killerId: AjaxRequestsKiller.getKillerId()\n        })\n        .done(function() {\n            const items = [];\n\n            model.get('items').each(function(item) {\n                items.push({\n                    name: item.get('_name'),\n                    internal_id: item.get('internalid'),\n                    unique_identifier: `${item.get('internalid')}`,\n                    price: item.get('_price_formatted'),\n                    image_url: item.get('_thumbnail').url\n                });\n            });\n\n            functionToCallback(items);\n        });\n};\n\nexport = AdapterCategories;\n"]}
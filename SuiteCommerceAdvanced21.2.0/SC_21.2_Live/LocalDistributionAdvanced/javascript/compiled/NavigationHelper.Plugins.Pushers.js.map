{"version":3,"sources":["NavigationHelper.Plugins.Pushers.ts"],"names":[],"mappings":"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","file":"NavigationHelper.Plugins.Pushers.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"NavigationHelper.Plugins.Pushers\"/>\n\nimport * as _ from 'underscore';\nimport '../../UrlHelper/JavaScript/UrlHelper';\nimport * as Utils from '../../Utilities/JavaScript/Utils';\n\nimport * as jQuery from '../../Core/JavaScript/jQuery';\n\nimport BackboneView = require('../../BackboneExtras/JavaScript/Backbone.View');\nimport Backbone = require('../../Utilities/JavaScript/backbone.custom');\n\n// @class NavigationHelper.Plugins.Pushers Contains the plugins that implement the show in pusher for links behavior.\n// This means a link with the attribute data-toggle=\"show-in-pusher\" will be opened in a pusher. Supports both internal and external URLs.\n// @extends ApplicationModule\nconst pushersPlugin: any = {\n    // @method showInternalLinkInModal for links that has the data-toggle=\"show-in-modal\" we will open them in a modal,\n    // we do this by overriding the showContent function of the layout\n    // and by disabling the overrideViewSettings of the Content.EnhancedViews package\n    // Then we just navigate to that URL to call the router and execute the logic as normal\n    // layout_overlay prevents the user from calling the overridden showContent by clicking another element\n    // @param {jQuery.Event} e\n    // @param {String} href\n    // @param {jQuery} $target\n    // @param {ApplicationSkeleton.Layout} layout\n    // @return {Void}\n    showInternalLinkInPusher: function(e, href, $target, layout) {\n        const current_fragment = Backbone.history.fragment || '/';\n\n        layout.isShowContentRewritten = true;\n        layout.originalShowContent = layout.showContent;\n\n        if (pushersPlugin.ContentEnhancedViews) {\n            pushersPlugin.originalOverrideViewSettings =\n                pushersPlugin.ContentEnhancedViews.overrideViewSettings;\n        }\n\n        // Here we override the showContent function\n        layout.showContent = function(view) {\n            let promise = jQuery.Deferred();\n\n            if (view && _.isFunction(view.showInPush)) {\n                // Then we just call the show in modal of the same view that we were passed in.\n                promise = view.showInPush({ className: $target.data('pusher-class-name') });\n\n                // once this model closes we undo the override of the function\n                layout.$pusher_container.on('beforeClose', function() {\n                    pushersPlugin.undoNavigationHelperFunctionRewrite(layout);\n                });\n            } else {\n                pushersPlugin.undoNavigationHelperFunctionRewrite(layout);\n                Backbone.history.navigate(href, { trigger: false, replace: true });\n            }\n\n            promise.done(function() {\n                Backbone.history.navigate(current_fragment, { trigger: false, replace: true });\n            });\n\n            return promise;\n        };\n\n        // Here we navigate to the url and we then change the url to what it was originaly set in page that opened the modal\n        Backbone.history.navigate(href, { trigger: true, replace: true });\n    },\n\n    // @method undoNavigationHelperFunctionRewrite Helper method to undo the override performed by showInternalLinkInModal\n    // @param {ApplicationSkeleton.Layout} layout\n    // @return {Void}\n    undoNavigationHelperFunctionRewrite: function(layout) {\n        if (layout.isShowContentRewritten) {\n            layout.showContent = layout.originalShowContent;\n\n            if (pushersPlugin.ContentEnhancedViews) {\n                pushersPlugin.ContentEnhancedViews.overrideViewSettings =\n                    pushersPlugin.originalOverrideViewSettings;\n            }\n\n            layout.isShowContentRewritten = false;\n        }\n    },\n\n    // @method showExternalLinkInModal Opens an external page in a modal, by rendering an iframe in it\n    // @param {String} href\n    // @param {NavigationContext} context\n    // @param {ApplicationSkeleton} application\n    // @return {Void}\n    showExternalLinkInPusher: function(href, context, application) {\n        const view = new BackboneView({\n            application: application\n        });\n\n        view.template = function() {\n            return '<iframe src=\"' + href + '\"></iframe>';\n        };\n\n        view.page_header = context.$target.data('page-header') || '';\n\n        view.showInPush({\n            className: (context.$target.data('pusher-class-name') || '') + ' iframe-pusher'\n        });\n    },\n\n    // @method clickNavigation Handle standard click navigation for the cases were the target DO IS not a modal\n    // @param {ApplicationSkeleton.Layout} layout General application layout\n    // @param {jQuery.Event} e jQuery event\n    // @param {ApplicationSkeleton} application\n    // @return {jQuery.Event} e\n    clickNavigation: function(layout, e, application) {\n        if (!Utils.isPhoneDevice()) {\n            return e;\n        }\n\n        // Grabs info from the event element\n        const context = layout.generateNavigationContext(e);\n        let href = layout.getUrl(context) || '';\n        const target_is_blank = layout.isTargetBlank(e) || e.button === 1;\n        const target_is_pusher = context.target_data.toggle === 'show-in-pusher';\n        const is_disabled = context.$target.attr('disabled');\n        const is_dropdown = context.target_data.toggle === 'dropdown';\n        let is_external;\n\n        if (is_disabled) {\n            e.stopPropagation();\n            return e;\n        }\n\n        if (context.target_data.originalHref && !target_is_blank) {\n            href = context.target_data.originalHref;\n        }\n\n        if (href === '#' || href === '' || is_dropdown) {\n            return e;\n        }\n\n        // The navigation is within the same browser window\n        if (!target_is_blank) {\n            // if there is a modal open\n            if (layout.$containerModal) {\n                layout.$containerModal\n                    .removeClass('fade')\n                    .modal('hide')\n                    .data('bs.modal', null);\n            }\n\n            // Wants to open this link in a modal\n            if (target_is_pusher) {\n                is_external =\n                    ~href.indexOf('http:') ||\n                    ~href.indexOf('https:') ||\n                    ~href.indexOf('mailto:') ||\n                    ~href.indexOf('tel:');\n\n                if (is_external) {\n                    pushersPlugin.showExternalLinkInPusher(href, context, application);\n                } else {\n                    pushersPlugin.showInternalLinkInPusher(e, href, context.$target, layout);\n                }\n            }\n        }\n\n        return e;\n    },\n\n    // @property {Boolean} ContentEnhancedViews\n    ContentEnhancedViews: false,\n\n    // @method mountToApp\n    // @param {ApplicationSkeleton} application\n    mountToApp: function(application) {\n        const layout = application.getLayout();\n\n        // there is a soft dependency with Content.EnhancedViews\n        // we only want it to disable the function that sets the title of the page,\n        // we don't want to do that pages that open in modals\n        try {\n            pushersPlugin.ContentEnhancedViews = Utils.requireModules('Content.EnhancedViews');\n        } catch (e) {}\n\n        // Install Modal Navigation Plugins\n\n        layout.click.install({\n            name: 'pusherNavigation',\n            priority: 25,\n            execute: function(e) {\n                return pushersPlugin.clickNavigation(layout, e, application);\n            }\n        });\n    }\n};\n\nexport = pushersPlugin;\n"]}
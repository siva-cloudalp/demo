{"version":3,"sources":["Cart.PromocodeForm.View.ts"],"names":[],"mappings":"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","file":"Cart.PromocodeForm.View.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"Cart.PromocodeForm.View\"/>\n\nimport * as _ from 'underscore';\nimport * as cart_promocode_form_tpl from 'cart_promocode_form.tpl';\nimport * as Utils from '../../Utilities/JavaScript/Utils';\nimport * as jQuery from '../../Core/JavaScript/jQuery';\nimport { GlobalViewsMessageView } from '../../GlobalViews/JavaScript/GlobalViews.Message.View';\n\nimport BackboneView = require('../../BackboneExtras/JavaScript/Backbone.View');\n\n// @class Cart.PromocodeForm.View @extends Backbone.View\nexport = BackboneView.extend({\n    // @property {Function} template\n    template: cart_promocode_form_tpl,\n\n    events: {\n        'submit form[data-action=\"apply-promocode\"]': 'applyPromocode'\n    },\n\n    // @method initialize Override default method to define internal\n    // state and make this View composite\n    // @param {Cart.PromocodeForm.View.Initialization.options} options\n    // @return {Void}\n    initialize: function(options) {\n        this.promocode = options.promocode || {};\n\n        this.state = {\n            errorMessage: null,\n            code: '',\n            isSaving: false\n        };\n\n        this.applying_promocode = _.bind(this.applying_promocode, this);\n        this.apply_promocode_succeeded = _.bind(this.apply_promocode_succeeded, this);\n        this.apply_promocode_finished = _.bind(this.apply_promocode_finished, this);\n        this.apply_promocode_failed = _.bind(this.apply_promocode_failed, this);\n\n        this.model.cancelableOn('before:LiveOrder.addPromotion', this.applying_promocode);\n        this.model.cancelableOn('after:LiveOrder.addPromotion', this.apply_promocode_succeeded);\n        this.model.on('apply_promocode_finished', this.apply_promocode_finished);\n        this.model.on('apply_promocode_failed', this.apply_promocode_failed);\n    },\n\n    destroy: function() {\n        this.model.cancelableOff('before:LiveOrder.addPromotion', this.applying_promocode);\n        this.model.cancelableOff('after:LiveOrder.addPromotion', this.apply_promocode_succeeded);\n        this.model.off('apply_promocode_finished', this.apply_promocode_finished);\n        this.model.off('apply_promocode_failed', this.apply_promocode_failed);\n\n        this._destroy();\n    },\n\n    applying_promocode: function applying_promocode() {\n        // @event {Void} applying_promocode\n        this.trigger('applying_promocode');\n    },\n\n    apply_promocode_succeeded: function apply_promocode_succeeded() {\n        // @event {Void} apply_promocode_succeeded\n        this.trigger('apply_promocode_succeeded');\n    },\n\n    apply_promocode_finished: function apply_promocode_finished() {\n        // @event {Void} apply_promocode_finished\n        this.trigger('apply_promocode_finished');\n    },\n\n    apply_promocode_failed: function apply_promocode_failed() {\n        // @event {Void} apply_promocode_failed\n        this.trigger('apply_promocode_failed');\n    },\n\n    // @method applyPromocode Adds a new promocode into the current model (LiveOrder.Model)\n    // @param {DOMEvent} e\n    // @return {Void}\n    applyPromocode: function applyPromocode(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const self = this;\n        const $target = this.$(e.target);\n        const options = $target.serializeObject();\n\n        if (!options.promocode) {\n            this.state.errorMessage = Utils.translate('Promo Code is required');\n            this.render();\n        } else {\n            this.state.errorMessage = null;\n            this.state.isSaving = true;\n\n            this.model\n                .addPromotion(options.promocode)\n                .then(function savePromocodeSuccessed() {\n                    (<any>jQuery('#order-wizard-promocode')).collapse('hide');\n                })\n                .fail(function savePromocodeFailed(jqXhr) {\n                    const layout = self.options.application.getLayout();\n                    self.state.errorMessage = layout.parseErrorMessage(jqXhr);\n                })\n                .always(function savePromocodeEnded() {\n                    self.state.isSaving = false;\n                    self.state.code = '';\n\n                    self.render();\n                });\n        }\n    },\n\n    childViews: {\n        GlobalsViewErrorMessage: function() {\n            const placeholder = jQuery('[data-type=\"promocode-error-placeholder\"]');\n\n            const global_view_message = new GlobalViewsMessageView({\n                message: this.state.errorMessage,\n                type: 'error',\n                closable: true\n            });\n\n            placeholder.html(global_view_message.render().$el.html());\n        }\n    },\n\n    // @method getContext\n    // @return {Cart.PromocodeForm.View.Context}\n    getContext: function getContext() {\n        // @class Cart.PromocodeForm.View.Context\n        return {\n            // @property {Boolean} showErrorMessage\n            showErrorMessage: !!this.state.errorMessage,\n            // @property {String} errorMessage\n            errorMessage: this.state.errorMessage,\n            // @property {String} promocodeCode\n            promocodeCode: this.state.code,\n            // @property {Boolean} isSaving\n            isSaving: this.state.isSaving\n        };\n        // @class Cart.PromocodeForm.View\n    }\n});\n\n// @class Cart.PromocodeForm.View.Initialization.options\n// @property {LiveOrder.Model} model\n// @property {ApplicationSkeleton} application\n"]}
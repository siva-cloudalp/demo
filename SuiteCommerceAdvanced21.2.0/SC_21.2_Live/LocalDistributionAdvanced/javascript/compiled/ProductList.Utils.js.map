{"version":3,"sources":["ProductList.Utils.ts"],"names":[],"mappings":"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","file":"ProductList.Utils.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"ProductList.Utils\"/>\n\nimport * as _ from 'underscore';\nimport { MyAccountMenu } from '../../Header/JavaScript/MyAccountMenu';\nimport './ProductList.CartSaveForLater.View';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\nimport { Environment } from '../../../Commons/Core/JavaScript/Environment';\n\nimport ProductListCollection = require('../../../Commons/ProductList/JavaScript/ProductList.Collection');\nimport ProductListModel = require('../../../Commons/ProductList/JavaScript/ProductList.Model');\nimport ProductListControlSingleView = require('./ProductList.ControlSingle.View');\nimport ProductListControlView = require('../../../Commons/ProductList/JavaScript/ProductList.Control.View');\nimport ProductListItemModel = require('../../../Commons/ProductList/JavaScript/ProductList.Item.Model');\nimport MenuTreeView = require('../../../Commons/MenuTree/JavaScript/MenuTree.View');\n\nlet productListsInstancePromise;\nlet productListsInstance;\n\n// @class ProductList.Utils an utility class to support the ProductList ApplicationModule.\n// It will define shortcut accessors to product lists, render the controls on 'afterAppendView'\n// and show and define the MyAccount menu items.\nexport class ProductListUtils {\n    private application;\n\n    // @property {control:String} placeholder this application will render some of\n    // its views in existing DOM elements (placeholders)\n    private placeholder = { control: '[data-type=\"product-lists-control\"]' };\n\n    private entryId: string;\n\n    public constructor(app) {\n        this.application = app;\n    }\n\n    // @method getProductListsPromise Loads Product Lists collection model\n    // singleton @return {jQuery.Deferred}\n    public getProductListsPromise(): any {\n        const SC = Environment.getSC();\n        if (SC.ENVIRONMENT.PRODUCTLIST_ENABLED) {\n            if (!productListsInstancePromise) {\n                productListsInstancePromise = jQuery.Deferred();\n                productListsInstance = new ProductListCollection();\n                productListsInstance.application = this.application;\n\n                productListsInstance.fetch({ cache: false }).done(function(jsonCollection) {\n                    productListsInstance.reset(jsonCollection);\n                    productListsInstancePromise.resolve(productListsInstance);\n                });\n            }\n        } else {\n            productListsInstancePromise = jQuery\n                .Deferred()\n                .reject('The Product List feature is not enabled in this account');\n        }\n        return productListsInstancePromise;\n    }\n\n    private static buildSubMenuEntry(productlist, entryId) {\n        return {\n            entryId: entryId,\n            id: `productlist_${productlist.get('internalid') ||\n                `tmpl_${productlist.get('templateId')}`}`,\n            url: `wishlist/${productlist.get('internalid') ||\n                `tmpl_${productlist.get('templateId')}`}`,\n            name: `${\n                productlist.get('name') === 'My list'\n                    ? Utils.translate('My list')\n                    : productlist.get('name')\n            } (${productlist.get('items').length})`,\n            index: 2\n        };\n    }\n\n    public updateProductListMenu() {\n        const utils = this;\n        const product_lists = utils.getProductLists();\n        const menu = MyAccountMenu.getInstance();\n        function buildNewEntry() {\n            const actual_object = {\n                id: 'productlists',\n                name: Utils.translate('Wishlist'),\n                url: '',\n                // Index of the menu item for menu order\n                index: 2\n            };\n            return actual_object;\n        }\n        function buildSingleListNewEntry() {\n            const the_single_list = product_lists.at(0);\n            const actual_object = {\n                id: `productlist_${\n                    the_single_list.get('internalid')\n                        ? the_single_list.get('internalid')\n                        : `tmpl_${the_single_list.get('templateId')}`\n                }`,\n                name: the_single_list.get('name'),\n                url: `wishlist/${\n                    the_single_list.get('internalid')\n                        ? the_single_list.get('internalid')\n                        : `tmpl_${the_single_list.get('templateId')}`\n                }`,\n                // Index of the menu item for menu order\n                index: 2\n            };\n            return actual_object;\n        }\n        if (!utils.isProductListEnabled()) {\n            menu.removeEntry('product_list_dummy');\n        } else {\n            const newMenuEntry = utils.isSingleList() ? buildSingleListNewEntry() : buildNewEntry();\n            this.entryId = newMenuEntry.id;\n            menu.replaceEntry('product_list_dummy', {\n                id: newMenuEntry.id,\n                name: newMenuEntry.name,\n                index: newMenuEntry.index,\n                url: newMenuEntry.url\n            });\n            if (!utils.isSingleList()) {\n                menu.addSubEntry({\n                    entryId: newMenuEntry.id,\n                    id: 'productlist_all',\n                    name: Utils.translate('All my lists'),\n                    url: 'wishlist',\n                    index: 1\n                });\n                // Then add all the lists\n                product_lists.each(function(productlist) {\n                    if (productlist.get('internalid') && productlist.get('name') === 'My list') {\n                        menu.removeSubEntry(`productlist_tmpl_${productlist.get('templateId')}`);\n                    }\n                    const subMenuEntry = ProductListUtils.buildSubMenuEntry(\n                        productlist,\n                        newMenuEntry.id\n                    );\n                    menu.replaceSubEntry(subMenuEntry.id, subMenuEntry);\n                    menu.addSubEntry(subMenuEntry);\n                });\n            }\n        }\n        MenuTreeView.getInstance().updateMenuItemsUI();\n    }\n\n    // @method productListsPromiseDone method to be called once the product lists are\n    // loaded to show the MyAccount's menu item\n    private productListsPromiseDone() {\n        const layout = this.application.getLayout();\n        if (this.application.ProductListModule.Utils.isSingleList()) {\n            // Update header profile link for single product list...\n            const the_single_list = this.application.ProductListModule.Utils.getProductLists().at(\n                0\n            );\n            const product_list_menu_item = layout.$('.header-profile-single-productlist');\n\n            if (the_single_list && product_list_menu_item) {\n                const product_list_hashtag = `#wishlist/${\n                    the_single_list.get('internalid')\n                        ? the_single_list.get('internalid')\n                        : `tmpl_${the_single_list.get('templateId')}`\n                }`;\n\n                product_list_menu_item.text(the_single_list.get('name'));\n                product_list_menu_item.attr('data-hashtag', product_list_hashtag);\n            }\n        }\n    }\n\n    // @method profileModelPromiseDone method to be executed once the user\n    // profile has loaded. We need this to start working with product lists.\n    public profileModelPromiseDone() {\n        const utils = this.application.ProductListModule.Utils;\n        // if Product Lists are not enabled, return...\n        if (!utils.isProductListEnabled()) {\n            return;\n        }\n\n        const layout = this.application.getLayout();\n\n        // rendering product lists\n        utils.renderProductLists();\n\n        layout.on('afterAppendView', function(view) {\n            utils.renderProductLists(view);\n        });\n\n        layout.on('afterAppendToDom', function() {\n            utils.renderProductLists();\n        });\n\n        // Put this code block outside afterAppendView to avoid infinite loop!\n        utils.getProductListsPromise().done(() => utils.productListsPromiseDone());\n\n        ProductListItemModel.prototype.keyMapping = this.application.getConfig(\n            'itemKeyMapping',\n            {}\n        );\n        ProductListItemModel.prototype.itemOptionsConfig = this.application.getConfig(\n            'itemOptions',\n            []\n        );\n    }\n\n    // @method getProductLists @return {ProductList.Collection}\n    public getProductLists() {\n        if (!productListsInstance) {\n            productListsInstance = new ProductListCollection();\n            productListsInstance.application = this.application;\n        }\n\n        return productListsInstance;\n    }\n\n    // @method getProductList obtain a single ProductList with all its item's data\n    // @return {ProductList.Model}\n    public getProductList(id) {\n        const productList = new ProductListModel();\n        productList.set('internalid', id);\n        return productList.fetch();\n    }\n\n    // @method getSavedForLaterProductList obtain a single Saved for Later ProductList with\n    // all its item's data @return {jQuery.Deferred}\n    public getSavedForLaterProductList() {\n        const productList = new ProductListModel();\n\n        productList.set('internalid', 'later');\n\n        return productList.fetch();\n    }\n\n    public getRequestAQuoteProductList() {\n        const productList = new ProductListModel();\n\n        productList.set('internalid', 'quote');\n\n        return productList.fetch();\n    }\n\n    // @method isProductListEnabled is the Product-List functionality available for this\n    // application? @return {Boolean}\n    public isProductListEnabled(): boolean {\n        return SC.ENVIRONMENT.PRODUCTLIST_ENABLED && !SC.ENVIRONMENT.standalone;\n    }\n\n    // @method isSingleList are we in the single-list modality ? @return {Boolean}\n    public isSingleList(): boolean {\n        const { productList } = this.application.getConfig();\n        return (\n            !(productList.additionEnabled || false) &&\n            _.filter(productList.listTemplates || [], function(pl: any) {\n                return !pl.typeName || (pl.typeName !== 'later' && pl.typeName !== 'quote');\n            }).length === 1\n        );\n    }\n\n    // @method renderProductLists render all product-lists related widgets\n    // @param {Backbone.View} view\n    public renderProductLists(view) {\n        if (!this.application.ProductListModule.Utils.isProductListEnabled()) {\n            return;\n        }\n\n        this.application.ProductListModule.Utils.renderControl(view);\n    }\n\n    // @method internalGetProductId Gets the internal product id for a store item\n    // considering it could be a matrix child.\t// @param {Item.Model} product\n    // @return {String}\n    public internalGetProductId(product): string {\n        // If its matrix its expected that only 1 item is selected, not more than one nor 0\n        if (product.getPosibleOptions().length) {\n            const selected_options = product.getSelectedMatrixChilds();\n\n            if (selected_options.length === 1) {\n                return `${selected_options[0].get('internalid')}`;\n            }\n        }\n\n        return `${product.get('_id')}`;\n    }\n\n    // @method renderControl renders the control used in shopping pdp and quickview\n    // @param {Backbone.View} view\n    public renderControl(view_) {\n        const utils = this.application.ProductListModule.Utils;\n        jQuery(this.placeholder.control).each(function() {\n            const view = view_ || (<any>this).application.getLayout().currentView;\n            const is_single_list_mode = utils.isSingleList();\n            const $container = jQuery(this);\n            const product_lists_promise = utils.getProductListsPromise();\n\n            product_lists_promise.done(function() {\n                // this control needs a reference to the StoreItem model !\n                if (view && view.model && view.model.getPosibleOptions) {\n                    let control = null;\n\n                    if (is_single_list_mode) {\n                        control = new ProductListControlSingleView({\n                            collection: utils.getProductLists(),\n                            product: view.model,\n                            application: this.application\n                        });\n                    } else {\n                        view.countedClicks = {};\n\n                        control = new ProductListControlView({\n                            collection: utils.getProductLists(),\n                            product: view.model,\n                            application: this.application,\n                            isDisabledWishlistButton: !!jQuery(utils.placeholder.control).data(\n                                'disabledbutton'\n                            ),\n                            countedClicks: view.countedClicks\n                        });\n                    }\n\n                    $container.empty().append(control.$el);\n                    control.render();\n                }\n            });\n\n            if (product_lists_promise.state() === 'pending') {\n                $container\n                    .empty()\n                    .append(\n                        `<button class=\"product-list-control-button-wishlist\">${\n                            is_single_list_mode\n                                ? Utils.translate('Loading List...')\n                                : Utils.translate('Loading Lists...')\n                        }</button>`\n                    );\n            }\n        });\n    }\n}\n"]}
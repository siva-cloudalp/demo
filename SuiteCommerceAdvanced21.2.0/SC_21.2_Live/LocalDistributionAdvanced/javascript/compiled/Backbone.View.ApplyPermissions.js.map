{"version":3,"sources":["Backbone.View.ApplyPermissions.ts"],"names":[],"mappings":"AAAA;;;;;EAKE;;;;;IASF,SAAgB,4BAA4B,CAAC,QAAQ;QACjD,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,EAAE,EAAE,iBAAiB,CAAC,EAAE;YAClC,kEAAkE;YAClE,wEAAwE;YACxE,IAAM,sBAAsB,GAAG,QAAQ,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;YAEnE,sBAAsB,CAAC,IAAI,CAAC;gBACxB,IAAM,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;gBACzB,IAAM,kBAAkB,GAAG,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;gBACnD,IAAM,KAAK,GAAG,kBAAkB,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;gBACjD,IAAM,aAAa,GAAG,GAAG,CAAC,IAAI,CAAC,sBAAsB,CAAC,IAAI,KAAK,CAAC;gBAChE,IAAI,SAAS,CAAC;gBACd,IAAI,eAAe,GAAG,aAAa,KAAK,IAAI,CAAC;gBAE7C,CAAC,CAAC,IAAI,CAAC,KAAK,EAAE,UAAS,IAAS;oBAC5B,IAAM,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;oBAEpC,SAAS,GAAG,CAAC,CACT,WAAW,CAAC,MAAM,KAAK,CAAC;wBACxB,WAAW,CAAC,CAAC,CAAC,GAAG,CAAC;wBAClB,EAAE,CAAC,WAAW,CAAC,WAAW;wBAC1B,EAAE,CAAC,WAAW,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;wBAC1C,EAAE,CAAC,WAAW,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,GAAG,WAAW,CAAC,CAAC,CAAC,CAC9E,CAAC;oBAEF,IAAI,aAAa,KAAK,IAAI,EAAE;wBACxB,eAAe,GAAG,eAAe,IAAI,SAAS,CAAC;qBAClD;yBAAM;wBACH,eAAe,GAAG,eAAe,IAAI,SAAS,CAAC;qBAClD;gBACL,CAAC,CAAC,CAAC;gBAEH,IAAI,CAAC,eAAe,EAAE;oBAClB,GAAG,CAAC,MAAM,EAAE,CAAC;iBAChB;YACL,CAAC,CAAC,CAAC;SACN;QAED,OAAO,QAAQ,CAAC;IACpB,CAAC;IAvCD,oEAuCC","file":"Backbone.View.ApplyPermissions.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"Backbone.View.ApplyPermissions\"/>\n\n/// <reference path=\"../../Utilities/JavaScript/GlobalDeclarations.d.ts\" />\n\nimport * as _ from 'underscore';\nimport * as jQuery from '../../Core/JavaScript/jQuery';\n\nexport function backboneViewApplyPermissions(template): string {\n    if (!_.result(SC, 'isPageGenerator')) {\n        // We need to wrap the template in a container so then we can find\n        // and remove parent nodes also (jQuery.find only works in descendants).\n        const $permissioned_elements = template.find('[data-permissions]');\n\n        $permissioned_elements.each(function() {\n            const $el = jQuery(this);\n            const element_permission = $el.data('permissions');\n            const perms = element_permission.split(/[\\s,]+/);\n            const perm_operator = $el.data('permissions-operator') || 'AND';\n            let perm_eval;\n            let perm_evaluation = perm_operator !== 'OR';\n\n            _.each(perms, function(perm: any) {\n                const perm_tokens = perm.split('.');\n\n                perm_eval = !(\n                    perm_tokens.length === 3 &&\n                    perm_tokens[2] < 5 &&\n                    SC.ENVIRONMENT.permissions &&\n                    SC.ENVIRONMENT.permissions[perm_tokens[0]] &&\n                    SC.ENVIRONMENT.permissions[perm_tokens[0]][perm_tokens[1]] < perm_tokens[2]\n                );\n\n                if (perm_operator === 'OR') {\n                    perm_evaluation = perm_evaluation || perm_eval;\n                } else {\n                    perm_evaluation = perm_evaluation && perm_eval;\n                }\n            });\n\n            if (!perm_evaluation) {\n                $el.remove();\n            }\n        });\n    }\n\n    return template;\n}\n"]}
{"version":3,"sources":["RequestQuoteWizard.Router.ts"],"names":[],"mappings":"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","file":"RequestQuoteWizard.Router.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"RequestQuoteWizard.Router\"/>\n\nimport * as _ from 'underscore';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\nimport { AjaxRequestsKiller } from '../../../Commons/AjaxRequestsKiller/JavaScript/AjaxRequestsKiller';\n\nimport WizardRouter = require('../../Wizard/JavaScript/Wizard.Router');\nimport RequestQuoteWizardView = require('./RequestQuoteWizard.View');\nimport RequestQuoteWizardStep = require('./RequestQuoteWizard.Step');\nimport RequestQuoteWizardPermissionErrorView = require('./RequestQuoteWizard.Permission.Error.View');\nimport Backbone = require('../../../Commons/Utilities/JavaScript/backbone.custom');\n\n// @class RequestQuoteWizard.Router @extends Wizard.Router\nexport = WizardRouter.extend({\n    // @property {RequestQuoteWizardStep.Step} step\n    step: RequestQuoteWizardStep,\n\n    // @property {RequestQuoteWizardStep.View} view\n    view: RequestQuoteWizardView,\n\n    initialize: function() {\n        const init_promise = WizardRouter.prototype.initialize.apply(this, arguments);\n\n        this.application.waitForPromise(init_promise);\n    },\n\n    _registerPageType: function _registerPageType(options) {\n        const pageType = this.application.getComponent('PageType');\n\n        pageType.registerPageType({\n            name: 'request-quote-wizard',\n            routes: options.routes,\n            view: RequestQuoteWizardView,\n            defaultTemplate: {\n                name: 'requestquote_wizard_layout.tpl',\n                displayName: 'Request quote wizard default',\n                thumbnail: Utils.getThemeAbsoluteUrlOfNonManagedResources(\n                    'img/default-layout-request-quote-wizard.png'\n                )\n            }\n        });\n    },\n\n    // @method runStep override default runstep method to validate that a quote id has been specified in the URL and the corresponding quote is already loaded\n    // @return {Void}\n    runStep: function() {\n        // Computes the position of the user in the flow\n        const fragments = Backbone.history.fragment.split('?');\n        const url = fragments[0];\n        const str_options = fragments.length ? fragments[1] : '';\n        const position = this.getStepPosition(url); // this.getStepPosition(url)\n        let content = '';\n        let page_header = '';\n        const layout = this.application.getLayout();\n        const options = Utils.parseUrlOptions(str_options);\n        const self = this;\n        const quoteid = str_options && ~str_options.indexOf('quoteid=');\n        const promise = jQuery.Deferred();\n\n        if (SC.ENVIRONMENT.permissions.transactions.tranEstimate < 2) {\n            const error_view = new RequestQuoteWizardPermissionErrorView({\n                application: this.application\n            });\n\n            error_view.showContent();\n\n            return promise.reject();\n        }\n        if (quoteid) {\n            // wizard just finished and user refreshed the page\n            page_header = Utils.translate('Your Quote Request has been Placed');\n            content +=\n                Utils.translate(\n                    'You can review your quote request at <a href=\"/quotes/$(0)\">Your Account</a> ',\n                    options.quoteid\n                ) +\n                Utils.translate(\n                    'or continue Shopping on our <a data-touchpoint=\"home\" data-hashtag=\"#/\" href=\"/\">Home Page</a>.'\n                );\n\n            layout.internalError &&\n                layout.internalError(content, page_header, Utils.translate('My Account'));\n\n            return promise.reject();\n        }\n        if (position.fromBegining === 0) {\n            self.model.clear();\n            // this is done because many OrderWizard Modules dont check if the summary is set\n            self.model.set('summary', {}, { silent: true });\n            self.model.set('internalid', 'null');\n\n            return self.model\n                .fetch({\n                    killerId: AjaxRequestsKiller.getKillerId()\n                })\n                .then(function() {\n                    self.model.trigger('init');\n                    return WizardRouter.prototype.runStep.apply(self);\n                });\n        }\n        return WizardRouter.prototype.runStep.apply(self, arguments);\n    }\n});\n"]}
{"version":3,"sources":["GoogleUniversalAnalytics.ts"],"names":[],"mappings":"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","file":"GoogleUniversalAnalytics.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"GoogleUniversalAnalytics\"/>\n\nimport * as _ from 'underscore';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\nimport { Configuration } from '../../SCA/JavaScript/Configuration';\n\nimport Tracker = require('../../../Commons/Tracker/JavaScript/Tracker');\nimport Backbone = require('../../../Commons/Utilities/JavaScript/backbone.custom');\n\nexport = (function(win: any, name) {\n    // [Google Universal Analytics](https://developers.google.com/analytics/devguides/collection/analyticsjs/)\n    // We customized the tracking default start script so it doesn't loads analytics.js\n    // (Tracking Start)[https://developers.google.com/analytics/devguides/collection/analyticsjs/#quickstart]\n    win.GoogleAnalyticsObject = name;\n    win[name] =\n        win[name] ||\n        function() {\n            (win[name].q = win[name].q || []).push(arguments);\n        };\n    const date: any = new Date();\n    win[name].l = 1 * date;\n\n    // @class GoogleUniversalAnalytics @extends ApplicationModule\n    // ------------------\n    // Loads google analytics script and extends application with methods:\n    // * trackPageview\n    // * trackEvent\n    // * trackTransaction\n    // Also wraps layout's showInModal\n    const GoogleUniversalAnalytics: any = {\n        // @method doCallback Indicates if this module do a callback after some particular events\n        // @return {Boolean}\n        doCallback: function() {\n            return !win[name].q;\n        },\n\n        // @method trackPageview\n        // @param {String} url\n        // @return {GoogleUniversalAnalytics}\n        trackPageview: function(url) {\n            if (_.isString(url)) {\n                // [Page Tracking](https://developers.google.com/analytics/devguides/collection/analyticsjs/pages#overriding)\n                win[name]('send', 'pageview', url);\n            }\n\n            return this;\n        },\n\n        trackLogin: function(event) {\n            return this.trackEvent(event);\n        },\n\n        trackRegister: function(event) {\n            return this.trackEvent(event);\n        },\n        trackCheckoutAsGuest: function(event) {\n            return this.trackEvent(event);\n        },\n\n        // @method trackEvent\n        // @param {TrackEvent} event\n        // @return {GoogleUniversalAnalytics}\n        trackEvent: function(event) {\n            if (event && event.category && event.action) {\n                // [Event Tracking](https://developers.google.com/analytics/devguides/collection/analyticsjs/events#implementation)\n                win[name](\n                    'send',\n                    'event',\n                    event.category,\n                    event.action,\n                    event.label,\n                    parseFloat(event.value) || 0,\n                    {\n                        hitCallback: event.callback,\n                        page: event.page || '/' + Backbone.history.fragment\n                    }\n                );\n            }\n\n            return this;\n        },\n\n        // @method addItem\n        // @param {Object<String:id,String:name>} item\n        // @return {GoogleUniversalAnalytics}\n        addItem: function(item) {\n            if (item && item.id && item.name) {\n                // [Adding Items](https://developers.google.com/analytics/devguides/collection/analyticsjs/ecommerce#addItem)\n                win[name]('ecommerce:addItem', item);\n            }\n\n            return this;\n        },\n\n        // @method addTrans\n        // @param {Object} transaction\n        // @return {GoogleUniversalAnalytics}\n        addTrans: function(transaction) {\n            if (transaction && transaction.id) {\n                // [Adding a Transaction](https://developers.google.com/analytics/devguides/collection/analyticsjs/ecommerce#addTrans)\n                win[name]('ecommerce:addTransaction', transaction);\n            }\n\n            return this;\n        },\n\n        // @method trackTrans\n        // @return {GoogleUniversalAnalytics}\n        trackTrans: function() {\n            // [Sending Data](https://developers.google.com/analytics/devguides/collection/analyticsjs/ecommerce#sendingData)\n            win[name]('ecommerce:send');\n            return this;\n        },\n\n        // @method trackTransaction\n        // Based on the created SalesOrder we trigger each of the analytics\n        // ecommerce methods passing the required information\n        // [Ecommerce Tracking](https://developers.google.com/analytics/devguides/collection/analyticsjs/ecommerce)\n        // @param {Tracker.Transaction.Model} @extends Backbone.Model transaction\n        // @return {GoogleUniversalAnalytics|Void}\n        trackTransaction: function(transaction) {\n            const transaction_id = transaction.get('confirmationNumber');\n\n            GoogleUniversalAnalytics.addTrans({\n                id: transaction_id,\n                revenue: transaction.get('subTotal'),\n                shipping: transaction.get('shippingCost') + transaction.get('handlingCost'),\n                tax: transaction.get('taxTotal'),\n                currency:\n                    (SC.ENVIRONMENT.currentCurrency && SC.ENVIRONMENT.currentCurrency.code) || '',\n\n                page: '/' + Backbone.history.fragment\n            });\n\n            transaction.get('products').each(function(product) {\n                GoogleUniversalAnalytics.addItem({\n                    id: transaction_id,\n                    affiliation: Configuration.get('siteSettings.displayname'),\n                    sku: product.get('sku'),\n                    name: product.get('name'),\n                    category: product.get('category') || '',\n                    price: product.get('rate'),\n                    quantity: product.get('quantity')\n                });\n            });\n\n            return GoogleUniversalAnalytics.trackTrans();\n        },\n\n        // @method setAccount\n        // @param {SC.Configuration} config\n        // @return {Void}\n        setAccount: function(config) {\n            if (!config) {\n                return this;\n            }\n\n            const domainName = Utils.isCheckoutDomain()\n                ? config.domainNameSecure\n                : config.domainName;\n\n            if (_.isString(config.propertyID) && _.isString(domainName)) {\n                this.propertyID = config.propertyID;\n                this.domainName = domainName;\n\n                // [Multiple Trackers on The Same Domain](https://developers.google.com/analytics/devguides/collection/analyticsjs/domains#multitrackers)\n                // https://support.google.com/analytics/answer/1034342?hl=en\n                win[name]('create', this.propertyID, {\n                    cookieDomain: this.domainName,\n                    allowLinker: true\n                });\n            }\n\n            return this;\n        },\n\n        // @method addCrossDomainParameters\n        // [Decorating HTML Links](https://developers.google.com/analytics/devguides/collection/analyticsjs/cross-domain#decoratelinks)\n        // @param {string} url\n        // @return {String} url\n        addCrossDomainParameters: function(url) {\n            // We only need to add the parameters if the URL we are trying to go\n            // is not a sub domain of the tracking domain\n            if (_.isString(url)) {\n                win[name](function(tracker) {\n                    win.linker =\n                        win.linker || new win.gaplugins.Linker(tracker || win.ga.getAll()[0]);\n                    const track_url = win.linker.decorate(url);\n\n                    // This validation is due to Tracking Blockers overriding the default analytics methods\n                    if (typeof track_url === 'string') {\n                        url = track_url;\n                    }\n                });\n            }\n\n            return url;\n        },\n\n        // @method loadScript\n        // @return {jQuery.Promise|Void}\n        loadScript: function() {\n            return jQuery.getScript('//www.google-analytics.com/analytics.js');\n        },\n\n        // @method mountToApp\n        // @param {ApplicationSkeleton} application\n        // @return {Void}\n        mountToApp: function(application) {\n            const configuration = application.getConfig();\n            const tracking = configuration.tracking.googleUniversalAnalytics;\n\n            // if track page view needs to be tracked\n            if (tracking && tracking.propertyID && !SC.isPageGenerator()) {\n                // we get the account and domain name from the configuration file\n                GoogleUniversalAnalytics.setAccount(tracking);\n\n                // Please keep this statement here or the first pageView on site load\n                // will not be triggered (ApplicationSkeleton.Layout._showContent)\n                Tracker.getInstance().trackers.push(GoogleUniversalAnalytics);\n\n                // the analytics script is only loaded if we are on a browser\n                application.getLayout().once('afterAppendView', function() {\n                    GoogleUniversalAnalytics.loadScript()\n                        .done(function() {\n                            win[name]('require', 'ecommerce', 'ecommerce.js');\n                        })\n                        .fail(function(jqXhr) {\n                            jqXhr.preventDefault = true;\n                            console.warn('Google Universal Analytics was unable to load');\n                        });\n                });\n            }\n        }\n    };\n\n    return GoogleUniversalAnalytics;\n})(window, 'ga');\n"]}
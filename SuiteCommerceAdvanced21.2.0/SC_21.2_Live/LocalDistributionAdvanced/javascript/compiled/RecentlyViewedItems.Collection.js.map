{"version":3,"sources":["RecentlyViewedItems.Collection.ts"],"names":[],"mappings":"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","file":"RecentlyViewedItems.Collection.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n///<amd-module name=\"RecentlyViewedItems.Collection\"/>\n\nimport * as _ from 'underscore';\nimport '../../Utilities/JavaScript/Utils';\n\nimport * as jQuery from '../../Core/JavaScript/jQuery';\nimport { Configuration } from '../../Utilities/JavaScript/Configuration';\nimport { MasterOptionsHelper } from '../../SC/JavaScript/MasterOptionsHelper';\n\nimport ItemCollection = require('../../Item/JavaScript/Item.Collection');\nimport Tracker = require('../../Tracker/JavaScript/Tracker');\nimport Cookies = require('../../../Commons/Utilities/JavaScript/js.cookie');\n\n// @class RecentlyViewedItems.Collection @extends Item.Collection\nconst RecentlyViewedItemsModel = ItemCollection.extend({\n    // @method initialize\n\t\tinitialize: function () {\n\t\t\tthis.useCookie =\n\t\t\t\tConfiguration.recentlyViewedItems && Configuration.recentlyViewedItems.useCookie;\n\t\t\tthis.searchApiMasterOptions = MasterOptionsHelper.getSearchAPIMasterOption('Facets');\n\t\t\tthis.track_on = false;\n\n\t\t\tif (this.useCookie) {\n\t\t\t\tthis.promise = this.loadItemsFromCookie();\n\t\t\t} else {\n\t\t\t\tthis.promise = jQuery.Deferred().resolveWith(this);\n\t\t\t}\n\t\t},\n\t\t// @method addHistoryItem\n\t\taddHistoryItem: function (item) {\n\t\t\tif (this.useCookie) {\n            const self = this;\n\n\t\t\t\tthis.promise.done(function () {\n\t\t\t\t\t// If the item is already in the recently viewed, we remove it\n\t\t\t\t\tself.remove(item);\n\n\t\t\t\t\t// we add the item at the beginning of a collection\n\t\t\t\t\tself.unshift(item);\n\n\t\t\t\t\tif (self.useCookie) {\n                    const current_items = Cookies.get('recentlyViewedIds');\n                    const news_items = _.union(self.pluck('internalid'), current_items);\n\n                    Cookies.set('recentlyViewedIds', news_items, { path: '/', expires: 365 });\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t// @method loadItemsFromCookie\n\t\tloadItemsFromCookie: function () {\n\t\t\t// create an array of ID items to get only the elements that are present in the cookie but are not present in memory\n\n        let cookie_ids = Cookies.get('recentlyViewedIds') || [];\n\n\t\t\tif (typeof cookie_ids === 'string') {\n\t\t\t\tcookie_ids = [cookie_ids.replace(/[\\[\\]]+/g, '')];\n\t\t\t} else if (!_.isArray(cookie_ids)) {\n\t\t\t\tcookie_ids = [cookie_ids];\n\t\t\t}\n\n        const items_ids = _.difference(cookie_ids, this.pluck('internalid')).join(',');\n\n\t\t\tif (items_ids) {\n\t\t\t\treturn this.fetch({ data: { id: items_ids } }, { silent: true });\n        }\n\t\t\t\treturn jQuery.Deferred().resolveWith(this);\n\t\t},\n\t\tturnOnTracking: function () {\n\t\t\tthis.track_on = true;\n    },\n\t\ttrackCollection: function () {\n        const self = this;\n\n\t\t\tthis.promise.done(function () {\n\t\t\t\t\tif(self.track_on){\n\t\t\t\t\tTracker.getInstance().trackProductListEvent(self, 'Recently Viewed Items');\n\t\t\t\t\tself.track_on = false;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n});\n\nconst RecentlyViewedItemsCollection:any = {\n    getInstance: function() {\n\t\tthis.instance = this.instance || new RecentlyViewedItemsModel();\n\n\t\tthis.instance.trackCollection();\n\n\t\treturn this.instance;\n\t}\n};\n\nexport = RecentlyViewedItemsCollection;\n"]}
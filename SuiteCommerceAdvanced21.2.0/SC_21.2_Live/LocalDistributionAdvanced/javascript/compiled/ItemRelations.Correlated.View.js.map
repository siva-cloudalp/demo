{"version":3,"sources":["ItemRelations.Correlated.View.ts"],"names":[],"mappings":"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","file":"ItemRelations.Correlated.View.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"ItemRelations.Correlated.View\"/>\n\nimport * as _ from 'underscore';\nimport * as item_relations_cell_tpl from 'item_relations_cell.tpl';\nimport * as item_relations_row_tpl from 'item_relations_row.tpl';\nimport * as item_relations_correlated_tpl from 'item_relations_correlated.tpl';\nimport * as Utils from '../../Utilities/JavaScript/Utils';\nimport * as jQuery from '../../Core/JavaScript/jQuery';\n\nimport BackboneCollectionView = require('../../Backbone.CollectionView/JavaScript/Backbone.CollectionView');\nimport ItemRelationsRelatedItemView = require('./ItemRelations.RelatedItem.View');\nimport ItemRelationsCorrelatedCollection = require('./ItemRelations.Correlated.Collection');\nimport Tracker = require('../../Tracker/JavaScript/Tracker');\nimport Backbone = require('../../Utilities/JavaScript/backbone.custom');\n\n// @class ItemRelations.Correlated.View @extends Backbone.CollectionView\nconst ItemRelationsCorrelatedView = BackboneCollectionView.extend({\n    initialize: function() {\n        const { siteSettings } = this.options.application.getConfig();\n        this.is_sca_advanced = siteSettings.sitetype === 'ADVANCED';\n        const collection = this.is_sca_advanced\n            ? new ItemRelationsCorrelatedCollection({ itemsIds: this.options.itemsIds })\n            : new Backbone.Collection();\n\n        BackboneCollectionView.prototype.initialize.call(this, {\n            collection: collection,\n            viewsPerRow: Infinity,\n            cellTemplate: item_relations_cell_tpl,\n            rowTemplate: item_relations_row_tpl,\n            childView: ItemRelationsRelatedItemView,\n            template: item_relations_correlated_tpl\n        });\n\n        this.view_tracked = false;\n        this.loadRelatedItems();\n    },\n    render: function() {\n        BackboneCollectionView.prototype.render.call(this);\n        if (this.is_sca_advanced) {\n            const layout = this.options.application.getLayout();\n            if (!jQuery.contains(document.documentElement, this.$el[0])) {\n                layout.once('afterAppendView', this.carouselInitialize, this);\n            } else {\n                this.carouselInitialize();\n            }\n        }\n        return this;\n    },\n    carouselInitialize: function carouselInitialize() {\n        const carousel = this.$el.find('[data-type=\"carousel-items\"]');\n        const {\n            siteSettings,\n            imageSizeMapping,\n            bxSliderDefaults\n        } = this.options.application.getConfig();\n\n        if (carousel.length > 0) {\n            if (Utils.isPhoneDevice() === false && siteSettings.imagesizes) {\n                const img_min_height = (<any>_.where(siteSettings.imagesizes, {\n                    name: imageSizeMapping.thumbnail\n                })[0]).maxheight;\n\n                carousel\n                    .find('.item-relations-related-item-thumbnail')\n                    .css('minHeight', img_min_height);\n            }\n\n            Utils.initBxSlider(carousel, bxSliderDefaults);\n        }\n    },\n\n    loadRelatedItems: function loadRelatedItems() {\n        const self = this;\n\n        self.collection.fetchItems().then(function() {\n            if (self.collection.length) {\n                if (!self.view_tracked) {\n                    Tracker.getInstance().trackProductListEvent(\n                        self.collection,\n                        'Correlated Items'\n                    );\n                    self.view_tracked = true;\n                }\n            }\n\n            self.render();\n        });\n    },\n\n    destroy: function destroy() {\n        this._destroy();\n        this.off('afterCompositeViewRender', this.loadRelatedItems, this);\n    }\n});\n\nexport = ItemRelationsCorrelatedView;\n"]}
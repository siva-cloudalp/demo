{"version":3,"sources":["Location.ts"],"names":[],"mappings":"AAAA;;;;;EAKE;;;IAaF,IAAM,eAAe,GAAG,EAAE,CAAC;IAE3B,SAAS,cAAc,CAAC,YAAY;QAChC,YAAY,GAAG,CAAC,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC;QAEvE,IAAM,oBAAoB,GAAG,CAAC,CAAC,MAAM,CAAC,YAAY,EAAE,UAAS,UAAe;YACxE,OAAO,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,KAAK,CAAC;QAC7D,CAAC,CAAC,CAAC;QACH,IAAI,OAAO,GAAG,MAAM,CAAC,QAAQ,EAAE,CAAC;QAEhC,YAAY,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,CAAC;QAEjD,IAAI,oBAAoB,CAAC,MAAM,EAAE;YAC7B,IAAI,oBAAoB,CAAC,MAAM,KAAK,CAAC,EAAE;gBACnC,OAAO,GAAG,IAAI,aAAa,CAAC,EAAE,UAAU,EAAE,oBAAoB,CAAC,CAAC,CAAC,EAAE,CAAC;qBAC/D,KAAK,EAAE;qBACP,IAAI,CAAC,UAAS,QAAQ;oBACnB,eAAe,CAAC,QAAQ,CAAC,UAAU,CAAC,GAAG,QAAQ,CAAC;gBACpD,CAAC,CAAC,CAAC;aACV;iBAAM;gBACH,OAAO,GAAG,IAAI,kBAAkB,EAAE;qBAC7B,KAAK,CAAC;oBACH,IAAI,EAAE;wBACF,UAAU,EAAE,oBAAoB,CAAC,IAAI,CAAC,GAAG,CAAC;qBAC7C;iBACJ,CAAC;qBACD,IAAI,CAAC,UAAS,SAAS;oBACpB,CAAC,CAAC,IAAI,CAAC,SAAS,EAAE,UAAS,QAAa;wBACpC,eAAe,CAAC,QAAQ,CAAC,UAAU,CAAC,GAAG,QAAQ,CAAC;oBACpD,CAAC,CAAC,CAAC;gBACP,CAAC,CAAC,CAAC;aACV;SACJ;aAAM;YACH,OAAO,CAAC,OAAO,EAAE,CAAC;SACrB;QAED,OAAO,OAAO,CAAC;IACnB,CAAC;IAED,wDAAwD;IACxD,IAAM,QAAQ,GAAG;QACb,cAAc;QACd,8BAA8B;QAC9B,mBAAmB;QACnB,GAAG,EAAE,UAAS,WAAW;YACrB,OAAO,eAAe,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;QAC9C,CAAC;QACD,yBAAyB;QACzB,wCAAwC;QACxC,4BAA4B;QAC5B,cAAc,EAAE,cAAc;QAC9B,qBAAqB;QACrB,2CAA2C;QAC3C,iBAAiB;QACjB,UAAU,EAAE,SAAS,UAAU;YAC3B,IAAM,6BAA6B,GAAG,gBAAgB,CAAC,SAAS,CAAC,UAAU,CAAC;YAE5E,gBAAgB,CAAC,SAAS,CAAC,UAAU,GAAG,SAAS,UAAU;gBACvD,6BAA6B,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;gBAErD,IAAI,CAAC,EAAE,CAAC,cAAc,EAAE,UAAS,KAAK;oBAClC,IAAM,mBAAmB,GAAG,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;oBACnD,IAAM,KAAK,GAAG,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;oBACjC,IAAM,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,YAAY,CAAC,KAAK,MAAM,CAAC;oBAClD,IAAM,YAAY,GAAG,KAAK,CAAC,GAAG,CAAC,UAAS,IAAI;wBACxC,OAAO,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;oBAC1E,CAAC,CAAC,CAAC;oBAEH,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE;wBACtB,OAAO;qBACV;oBAED,IAAI,OAAO,IAAI,mBAAmB,EAAE;wBAChC,YAAY,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;qBAC1C;oBAED,cAAc,CAAC,YAAY,CAAC,CAAC,IAAI,CAAC;wBAC9B,KAAK,CAAC,IAAI,CAAC,UAAS,IAAI;4BACpB,IAAM,UAAU,GACZ,CAAC,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;gCAChE,CAAC,OAAO,CAAC,CAAC,CAAC,mBAAmB,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;4BAE3C,IAAI,UAAU,EAAE;gCACZ,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,GAAG,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC,CAAC;6BACzD;wBACL,CAAC,CAAC,CAAC;oBACP,CAAC,CAAC,CAAC;gBACP,CAAC,CAAC,CAAC;YACP,CAAC,CAAC;QACN,CAAC;KACJ,CAAC;IAEF,OAAS,QAAQ,CAAC","file":"Location.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"Location\"/>\n\nimport * as _ from 'underscore';\nimport './Location.ProductLine';\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\n\nimport LocationCollection = require('./Location.Collection');\nimport LocationModel = require('./Location.Model');\nimport TransactionModel = require('../../../Commons/Transaction/JavaScript/Transaction.Model');\nimport Cookies = require('../../../Commons/Utilities/JavaScript/js.cookie');\n\nconst locations_cache = {};\n\nfunction fetchLocations(location_ids) {\n    location_ids = _.isArray(location_ids) ? location_ids : [location_ids];\n\n    const location_id_to_fetch = _.filter(location_ids, function(internalid: any) {\n        return !locations_cache[internalid] ? internalid : false;\n    });\n    let promise = jQuery.Deferred();\n\n    location_ids = _.unique(_.compact(location_ids));\n\n    if (location_id_to_fetch.length) {\n        if (location_id_to_fetch.length === 1) {\n            promise = new LocationModel({ internalid: location_id_to_fetch[0] })\n                .fetch()\n                .done(function(location) {\n                    locations_cache[location.internalid] = location;\n                });\n        } else {\n            promise = new LocationCollection()\n                .fetch({\n                    data: {\n                        internalid: location_id_to_fetch.join(',')\n                    }\n                })\n                .done(function(locations) {\n                    _.each(locations, function(location: any) {\n                        locations_cache[location.internalid] = location;\n                    });\n                });\n        }\n    } else {\n        promise.resolve();\n    }\n\n    return promise;\n}\n\n// @class ProductDetailToQuote @extend ApplicationModule\nconst Location = {\n    // @method get\n    // @param {String} location_id\n    // @return {Object}\n    get: function(location_id) {\n        return locations_cache[location_id] || {};\n    },\n    // @method fetchLocations\n    // @param {Array || String} location_ids\n    // @return {jQuery.Deferred}\n    fetchLocations: fetchLocations,\n    // @method mountToApp\n    // @param {ApplicationSkeleton} application\n    // @return {Void}\n    mountToApp: function mountToApp() {\n        const original_transaction_model_fn = TransactionModel.prototype.initialize;\n\n        TransactionModel.prototype.initialize = function initialize() {\n            original_transaction_model_fn.apply(this, arguments);\n\n            this.on('change:lines', function(model) {\n                const default_location_id = Cookies.get('myStore');\n                const lines = model.get('lines');\n                const is_cart = this.get('internalid') === 'cart';\n                const location_ids = lines.map(function(line) {\n                    return line.get('location') && line.get('location').get('internalid');\n                });\n\n                if (!location_ids.length) {\n                    return;\n                }\n\n                if (is_cart && default_location_id) {\n                    location_ids.push(default_location_id);\n                }\n\n                fetchLocations(location_ids).done(function() {\n                    lines.each(function(line) {\n                        const internalid =\n                            (line.get('location') && line.get('location').get('internalid')) ||\n                            (is_cart ? default_location_id : null);\n\n                        if (internalid) {\n                            line.get('location').set(locations_cache[internalid]);\n                        }\n                    });\n                });\n            });\n        };\n    }\n};\n\nexport = Location;\n"]}
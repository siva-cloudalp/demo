{"version":3,"sources":["Backbone.FormView.ts"],"names":[],"mappings":"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","file":"Backbone.FormView.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"Backbone.FormView\"/>\n/// <reference path=\"../../Utilities/JavaScript/UnderscoreExtended.d.ts\" />\n\n/*\n@module BackboneExtras\n#Form Views\n\nSee @?ref Backbone.FormView\n\n@class Backbone.FormView\n\nThis class add two main utilities to classes that contains forms:\n\nOn one side it provides the method saveForm that can be binded with a form submit and it will\nautomatically serialize the form data and save() the backbone model associated with this view.\nModel validation is implemented by library backbone.validation.\n\nOn the other side, if 'bindings' property is found it will setup the double binding so when\ninput elements are modified b the user the model is automatically validated. This will trigger\nvalidation error messages while the user types instead of only doing it when user submits the form.\nCurrently binding is implemented by library backbone.stickit.\n\nThis class is meant to be used as a mixing to add the functionality to other classes.\nInstead Class.extend() please use Backbone.FormView.add(my_instance)\n\n@extends Backbone.View\n*/\n\nimport '../../Utilities/JavaScript/backbone.stickit';\nimport '../../Utilities/JavaScript/backbone.validation';\nimport * as _ from 'underscore';\nimport * as Utils from '../../Utilities/JavaScript/Utils';\nimport * as jQuery from '../../Core/JavaScript/jQuery';\nimport { ResponseError } from './Backbone.FormView.Type';\nimport { Loggers } from '../../Loggers/JavaScript/Loggers';\n\nimport Backbone = require('../../../Commons/Utilities/JavaScript/backbone.custom');\n\n// Wrapper to Logging customers usage into Kibana to analyze data to remove Stickit library\n// Check if are properties into binding that SC are not using\n// by default or are events that SC are not using by default.\n// WE USE:\n// onSet()\n// onGet()\n// observe: ....\n// setOptions: ...\n// events:['blur', 'change']\n\nfunction addBindingStickitLogger(fn, optionalModel, selector, binding) {\n    const posibleBindings = [\n        ':el',\n        'getVal',\n        'updateModel',\n        'updateView',\n        'afterUpdate',\n        'updateMethod',\n        'escape',\n        'initialize',\n        'destroy',\n        'visibleFn',\n        'visible'\n    ];\n    if (!_.isEmpty(binding)) {\n        if (\n            !_.isEmpty(_.intersection(Object.keys(binding), posibleBindings)) ||\n            (binding.events &&\n                !_.isEmpty(binding.events) &&\n                !(\n                    binding.events[0] === 'blur' ||\n                    (binding.events.length === 2 &&\n                        (binding.events.includes('blur') && binding.events.includes('change')))\n                ))\n        ) {\n            Loggers.getLogger().info({\n                componentArea: 'BACKBONE_STICKIT_ADD_BINDING',\n                stickitSelector: selector,\n                stickitBinding: binding\n            });\n        }\n    }\n    var args = Array.prototype.slice.call(arguments, 1);\n    return fn.apply(this, args);\n}\n\nfunction addHandlerStickitLogger(fn, handlers) {\n    Loggers.getLogger().info({\n        componentArea: 'BACKBONE_STICKIT_ADD_HANDLER',\n        stickitHandlers: handlers\n    });\n    var args = Array.prototype.slice.call(arguments, 1);\n    return fn.apply(this, args);\n}\n\nfunction getConfigurationStickitLogger(fn, $el, binding) {\n    Loggers.getLogger().info({\n        componentArea: 'BACKBONE_STICKIT_GET_CONFIGURATION',\n        stickitElement: $el,\n        stickitBinding: binding\n    });\n    var args = Array.prototype.slice.call(arguments, 1);\n    return fn.apply(this, args);\n}\n\nBackbone.Stickit.addHandler = _.wrap(Backbone.Stickit.addHandler, addHandlerStickitLogger);\n\nBackbone.View.prototype.addBinding = _.wrap(\n    Backbone.View.prototype.addBinding,\n    addBindingStickitLogger\n);\n\nBackbone.Stickit.getConfiguration = _.wrap(\n    Backbone.Stickit.getConfiguration,\n    getConfigurationStickitLogger\n);\n\nfunction buttonSubmitProgress(savingForm) {\n    savingForm.find('[type=\"submit\"]').each(function() {\n        const element = <any>jQuery(this);\n        element.attr('disabled', true);\n        element.data('default-text', String(element.text()).trim());\n        element.text(Utils.translate('Processing...'));\n    });\n}\n\nfunction buttonSubmitDone(savingForm) {\n    savingForm.find('[type=\"submit\"]').each(function() {\n        const element = <any>jQuery(this);\n        element.attr('disabled', false);\n        element.text(element.data('default-text'));\n    });\n}\n// override default handler to uncheck radio buttons.\nconst handler_radio = <any>(\n    _.findWhere(Backbone.Stickit._handlers, { selector: 'input[type=\"radio\"]' })\n);\n\nif (handler_radio) {\n    handler_radio.update = function($el, val) {\n        if (val) {\n            $el.filter('[value=\"' + val + '\"]').prop('checked', true);\n        } else {\n            $el.prop('checked', false);\n        }\n    };\n}\n\nconst BackboneFormView: any = {\n    // override render() to add support to double binding using Backbone.stickit:\n    bindViewToStickit: function() {\n        const view = this;\n\n        Backbone.Validation.bind(view, {\n            model: view.validationModel,\n            forceUpdate: true\n        });\n        view.stickit(view.validationModel, view.bindings);\n    },\n\n    formatBindings: function(view) {\n        // we want to automatically add default desired configuration to stickit bindings without deleting stickit passed config.\n        // The default action is 'blur' and model modifications will be silent - this can be customized for particular inputs\n        _(view.bindings).each(function(binding: any, name) {\n            if (_(binding).isString()) {\n                view.bindings[name] = {\n                    observe: binding,\n                    setOptions: {\n                        validate: true,\n                        silent: true\n                    },\n                    events: ['blur']\n                };\n            } else if (!binding.setOptions || typeof binding.setOptions.validate === 'undefined') {\n                binding.setOptions = binding.setOptions || {};\n                binding.setOptions.validate = true;\n                binding.setOptions.silent = true;\n            }\n        });\n    },\n\n    // @method add makes the passed view a Form View. Views that want to be form views should call this method at initialize @static\n    // @param {Backbone.View} view the view instance we want to transform in a FormView.\n    add: function(view, options) {\n        options = options || {};\n\n        this.formatBindings(view);\n\n        view.validationModel = options.noCloneModel ? view.model : view.model.clone();\n        !options.noCloneModel && view.model.on('change', this.synchronizeModels, view);\n\n        view.on(\n            view.childViews ? 'afterCompositeViewRender' : 'afterViewRender',\n            this.bindViewToStickit\n        );\n\n        const self = this;\n        // overrides destroy() so we unstickit (remove bindings event listeners)\n        view.destroy = _.wrap(view.destroy, function(fn) {\n            this.unstickit();\n            view.model.off('change', self.synchronizeModels);\n\n            return fn.apply(this, Array.prototype.slice.call(arguments));\n        });\n\n        view.model.bind('validated', function(isValid) {\n            // user clicked on submit AND there are validation errors -> focus on first error.\n            if (view.isSavingForm && isValid === false) {\n                const $first_input_error = jQuery('body [data-validation-error]:first input');\n\n                if ($first_input_error) {\n                    if (\n                        !jQuery('.global-views-message-error').length &&\n                        $first_input_error.closest('[data-validation=\"control-group\"]').length\n                    ) {\n                        jQuery('body').animate(\n                            {\n                                scrollTop: $first_input_error\n                                    .closest('[data-validation=\"control-group\"]')\n                                    .offset().top\n                            },\n                            600\n                        );\n                    }\n\n                    $first_input_error.focus();\n                }\n            }\n\n            // user clicked on submit AND form is OK -> show progress button.\n            if (view.isSavingForm && isValid === true) {\n                buttonSubmitProgress(view.$savingForm);\n            }\n\n            view.isSavingForm = false;\n        });\n\n        // when we have two FormViews and we switch focus from one to another we want to erase the validation error messages from the first one:\n        view.events = view.events || {};\n        view.events['focusin *'] = 'formViewFocusHandler';\n\n        const removeValidationErrors = function($el) {\n            $el.find('[data-validation-error=\"block\"]').remove();\n            $el.find('[data-validation-error]').removeAttr('data-validation-error');\n        };\n\n        // @method removeValidationErrors remove all visual validation errors of this form view if any\n        view.removeValidationErrors = function() {\n            removeValidationErrors(this.$el);\n        };\n\n        view.formViewFocusHandler = function(e) {\n            const closestForm = jQuery(e.target).closest('form');\n\n            if (!closestForm.hasClass('focused-form-view')) {\n                removeValidationErrors(jQuery('.focused-form-view'));\n                jQuery('.focused-form-view').removeClass('focused-form-view');\n            }\n\n            closestForm.addClass('focused-form-view');\n        };\n\n        view.saveForm = this.saveForm;\n\n        view.transformResponseText = view.transformResponseText || this.transformResponseText;\n\n        return view.validationModel;\n    },\n\n    // @method synchronizeModels Auxiliary method used to keep sync all changes made on the view's model and the cloned model\n    // It is important to notice that this method is expected to run in the context of the view\n    // @param {Backbone.Model} view_model Original view's model\n    // @return {Void}\n    synchronizeModels: function(view_model) {\n        if (!view_model) {\n            return;\n        }\n\n        const changed_attributes = view_model.changedAttributes();\n        const view = this;\n\n        _.each(changed_attributes, function(value, attribute) {\n            view.validationModel.set(attribute, value);\n        });\n    },\n\n    // @method transformResponseText transformResponseText allow to modify the response when an error is thrown\n    // @param {ResponseError} response\n    // @return {Void}\n    transformResponseText: (response: ResponseError): void => {},\n\n    // @method saveForm will serialize the input of some form and save() the given model using it\n    // @param {HTMLEvent} e @param {Backbone.Model} model @param {Object} props properties to pass to model.save()\n    // @return {jQuery.Deferred}\n    saveForm: function(e, model, props) {\n        e.preventDefault();\n\n        // Add validate method into the view.model\n        Backbone.Validation.bind(this);\n\n        model = model || this.model;\n\n        this.$savingForm = jQuery(e.target).closest('form');\n        this.isSavingForm = true;\n\n        if (this.$savingForm.length) {\n            // and hides reset buttons\n            this.$savingForm.find('input[type=\"reset\"], button[type=\"reset\"]').hide();\n        }\n\n        this.hideError();\n\n        const self = this;\n        const options = self.selector ? { selector: self.selector } : {};\n        // Returns the promise of the save action of the model\n        const result = model.save(\n            props || this.$savingForm.serializeObject(),\n            _.extend(\n                {\n                    wait: true,\n\n                    forceUpdate: false,\n\n                    // Hides error messages, re enables buttons and triggers the save event\n                    // if we are in a modal this also closes it\n                    success: function(model, response) {\n                        if (self.inModal && self.$containerModal) {\n                            self.$containerModal\n                                .removeClass('fade')\n                                .modal('hide')\n                                .data('bs.modal', null);\n                        }\n\n                        if (self.$savingForm.length) {\n                            self.hideError(self.$savingForm);\n                            buttonSubmitDone(self.$savingForm);\n\n                            model.trigger('save', model, response);\n                        }\n                        model.trigger('saveCompleted');\n                    },\n\n                    // Re enables all button and shows an error message\n                    error: function(model, response) {\n                        buttonSubmitDone(self.$savingForm);\n\n                        if (response.responseText) {\n                            self.transformResponseText(response);\n                            model.trigger('error', JSON.parse(response.responseText || 'null'));\n                        }\n                    }\n                },\n                options\n            )\n        );\n\n        if (result === false) {\n            this.$savingForm.find('input[type=\"reset\"], button[type=\"reset\"]').show();\n            this.$savingForm.find('*[type=submit], *[type=reset]').attr('disabled', false);\n        }\n\n        return result;\n    }\n};\n\nexport = BackboneFormView;\n"]}
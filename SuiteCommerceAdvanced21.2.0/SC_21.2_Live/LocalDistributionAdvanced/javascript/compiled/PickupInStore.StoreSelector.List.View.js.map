{"version":3,"sources":["PickupInStore.StoreSelector.List.View.ts"],"names":[],"mappings":"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","file":"PickupInStore.StoreSelector.List.View.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"PickupInStore.StoreSelector.List.View\"/>\n\nimport * as _ from 'underscore';\nimport * as pickup_in_store_store_selector_list_tpl from 'pickup_in_store_store_selector_list.tpl';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\n\nimport { GlobalViewsMessageView } from '../../../Commons/GlobalViews/JavaScript/GlobalViews.Message.View';\n\nimport PickupInStoreStoreSelectorListRowView = require('./PickupInStore.StoreSelector.List.Row.View');\nimport PickupInStoreStoreSelectorItemDetailView = require('./PickupInStore.StoreSelector.ItemDetail.View');\nimport BackboneView = require('../../../Commons/BackboneExtras/JavaScript/Backbone.View');\nimport BackboneCollectionView = require('../../../Commons/Backbone.CollectionView/JavaScript/Backbone.CollectionView');\n\nconst PickupInStoreStoreSelectorListView: any = BackboneView.extend({\n    // @property {Function} template\n    template: pickup_in_store_store_selector_list_tpl,\n\n    // @property {Object} events\n    events: {\n        'click [data-action=\"refine-search\"]': 'refineSearch'\n    },\n\n    // @method initialize\n    // @param {PickupInStore.StoreSelector.List.View.InitializeParameters} options\n    initialize: function initialize(options) {\n        this.store_collection = options.store_collection;\n        this.model = options.model;\n        this.application = options.application;\n        this.source = options.source;\n\n        this.reference_map = options.reference_map;\n\n        this.store_collection.on('reset', this.render, this);\n    },\n\n    // @property {ChildViews} childViews\n    childViews: {\n        'StoresList.Rows': function() {\n            return new BackboneCollectionView({\n                collection: this.stores,\n                viewsPerRow: 1,\n                childView: PickupInStoreStoreSelectorListRowView,\n                childViewOptions: {\n                    product: this.model,\n                    application: this.application,\n                    source: this.source\n                }\n            });\n        },\n\n        GlobalMessageStoresStockUnavailable: function() {\n            return new GlobalViewsMessageView({\n                message: Utils.translate(\n                    \"We're sorry, it looks like the stores nearby that offer pickup are out of stock today.\"\n                ),\n                type: 'warning',\n                closable: false\n            });\n        },\n\n        GlobalMessageStoresUnavailable: function() {\n            return new GlobalViewsMessageView({\n                message: Utils.translate(\n                    \"We're sorry, it looks like there are no stores nearby that offer pickup.\"\n                ),\n                type: 'warning',\n                closable: false\n            });\n        },\n\n        'Line.Item.Information': function() {\n            if (this.source && this.source === 'cart') {\n                return new PickupInStoreStoreSelectorItemDetailView({\n                    model: this.model,\n                    application: this.application\n                });\n            }\n        }\n    },\n\n    // @method refineSearch\n    refineSearch: function refineSearch(e) {\n        e.preventDefault();\n\n        this.reference_map.myposition = null;\n\n        this.store_collection.reset();\n    },\n\n    // @method render\n    render: function render() {\n        const self = this;\n\n        this.item = this.model.getItem();\n\n        this.stock_information_per_location = this.item.get(\n            '_quantityavailableforstorepickup_detail'\n        );\n\n        this.stores = _.compact(\n            _.map(this.stock_information_per_location, function(location) {\n                const store_information = self.store_collection.get((<any>location).internalid);\n                return store_information && store_information.set(location);\n            })\n        );\n\n        // sort stores by stock and distance\n        this.stores.sort(function(store, other_store) {\n            if (\n                store.get('qtyavailableforstorepickup') === 0 &&\n                other_store.get('qtyavailableforstorepickup') > 0\n            ) {\n                return 1;\n            }\n            if (\n                store.get('qtyavailableforstorepickup') > 0 &&\n                other_store.get('qtyavailableforstorepickup') === 0\n            ) {\n                return -1;\n            }\n\n            return store.get('distance') - other_store.get('distance');\n        });\n\n        this.stock_pickup = false;\n        _.each(this.stores, function(stores) {\n            if ((<any>stores).get('qtyavailableforstorepickup') > 0) {\n                self.stock_pickup = true;\n            }\n        });\n\n        if (this.stores.length || this.store_collection.length) {\n            this._render();\n        } else {\n            this.$el.empty();\n        }\n    },\n\n    // @method getContext @return {PickupInStore.StoreSelector.List.View.Context}\n    getContext: function getContext() {\n        return {\n            // @property {Object} stores\n            stores: this.stores,\n            // @property {Object} storesLenth\n            storesLength: this.stores.length,\n            // @property {Boolean} isOneStore\n            isOneStore: this.stores.length === 1,\n            // @property {Boolean} isEmptyStores\n            isEmptyStores: this.stores.length === 0,\n            // @property {Object} stockPickup\n            stockPickup: this.stock_pickup,\n            // @property {Object} model\n            model: this.model,\n            // @property {Number} maxHeight\n            maxHeight: window.innerHeight / 2 - 60,\n            // @property {Object} myPosition\n            myPosition:\n                this.reference_map.myposition && this.reference_map.myposition.address\n                    ? this.reference_map.myposition.address\n                    : ''\n        };\n    }\n});\n\nexport = PickupInStoreStoreSelectorListView;\n"]}
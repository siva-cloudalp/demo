{"version":3,"sources":["CMSadapter.Impl.Enhanced.ts"],"names":[],"mappings":"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","file":"CMSadapter.Impl.Enhanced.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"CMSadapter.Impl.Enhanced\"/>\n/// <reference path=\"../../../Commons/Utilities/JavaScript/GlobalDeclarations.d.ts\" />\n\nimport * as _ from 'underscore';\n\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\n\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\n/*\n\n@module CMSadapter\n@class CMSadapterImpl.Enhanced the class that  the enhanced pages of CMS\n*/\n\nfunction AdapterEnhanced(application, router) {\n    this.application = application;\n    this.router = router;\n\n    const self = this;\n    const layout = application.getLayout();\n    const show_content_wrapper = function(fn, view) {\n        const promise = jQuery.Deferred();\n        const args = arguments;\n        const page = router && router.getPageForFragment();\n\n        view.enhancedPage = true;\n\n        const pageTypeComponent = application.getComponent('PageType');\n        const pageContext = pageTypeComponent.getContext();\n        const pageType = pageTypeComponent._getPageType(pageContext.page_type);\n\n        const pageTypeTemplate = pageType && pageType.get('template');\n        const pageTemplate = String(page && page.get('template') || '').trim();\n\n        const templateKey = (pageTemplate !== 'default' && pageTemplate) || pageTypeTemplate || '';\n\n        if (templateKey) {\n            let template;\n\n            try {\n                template = Utils.requireModules(templateKey);\n            } catch (error) {}\n\n            if (template) {\n                view.template = template;\n            }\n        }\n\n        // Calls the original function with all the parameters (slice to exclude fn)\n        fn.apply(layout, Array.prototype.slice.call(args, 1)).done(function() {\n            // once the original function is done this reads the attributes of the view and\n            // sets title, metas and adds banners\n            self.enhancePage(view, layout, page);\n\n            // only after enhancing the view we resolve the promise\n            promise.resolveWith(this, arguments);\n        });\n\n        return promise;\n    };\n\n    // Wraps the layout.showContent and Layout.showInModal methods\n    // This make sure that every time you try to show content in the\n    // application the page will be enhanced by setting title, header, meta tags and banners\n    layout.showContent = _.wrap(layout.showContent, show_content_wrapper);\n    layout.showInModal = _.wrap(layout.showInModal, show_content_wrapper);\n}\n\n_.extend(AdapterEnhanced.prototype, {\n    enhancePage: function(view, _layout, page) {\n        const $head = jQuery('head');\n\n        // first, initialize head tags if they are not present\n        $head\n            .not(':has(title)')\n            .append('<title/>')\n            .end()\n            .not(':has(link[rel=\"canonical\"])')\n            .append('<link rel=\"canonical\"/>')\n            .end()\n            .not(':has(meta[name=\"keywords\"])')\n            .append('<meta name=\"keywords\"/>')\n            .end()\n            .not(':has(meta[name=\"description\"])')\n            .append('<meta name=\"description\"/>')\n            .end();\n\n        view.setTitle((page && page.get('page_title')) || view.getTitle());\n        view.setMetaDescription(\n            (page && page.get('meta_description')) || view.getMetaDescription()\n        );\n        view.setMetaKeywords((page && page.get('meta_keywords')) || view.getMetaKeywords());\n\n        // set title in DOM\n        const title = view.getTitle();\n\n        if (title) {\n            document.title = title;\n        }\n\n        // Sets the text of the title element if we are in the server\n        // we only do it on the server side due to an issue modifying\n        // the title tag on IE :(\n        if (SC.ENVIRONMENT.jsEnvironment === 'server') {\n            $head.find('title').text(title);\n        }\n\n        // meta keywords and meta description. We aren't adding the tags but reusing existing ones\n        $head\n            .find('meta[name=\"description\"]')\n            .attr('content', view.getMetaDescription())\n            .end()\n            .find('meta[name=\"keywords\"]')\n            .attr('content', view.getMetaKeywords())\n            .end()\n            .append(\n                view\n                    .getMetaTags()\n                    .not('[name=\"description\"]')\n                    .not('[name=\"keywords\"]')\n            );\n\n        $head\n            .find('link[rel=\"canonical\"]')\n            .attr('href', view.getCanonical())\n            .end()\n            // we remove any existing next/prev tags every time\n            // a page is rendered in case the previous view was paginated\n            .find('link[rel=\"next\"], link[rel=\"prev\"]')\n            .remove();\n\n        // if the current page is paginated\n        // set prev/next link rel\n        this.setLinkRel('prev', view.getRelPrev(), $head);\n        this.setLinkRel('next', view.getRelNext(), $head);\n\n        // addition to head. Heads up! Each element added is stored and when the view is destroyed we remove these\n        // elements from the DOM. If not the head will be polluted each time the user navigates.\n        const additionToHead = (page && page.get('addition_to_head')) || view.getAddToHead();\n\n        view.enhancedNodes = [];\n\n        if (additionToHead && String(additionToHead + '').trim()) {\n            const $additionToHead = jQuery(additionToHead);\n            $additionToHead.each(function() {\n                const $node = jQuery(this);\n                $head.append($node);\n                view.enhancedNodes.push($node);\n            });\n        }\n\n        view.destroy = _.wrap(view.destroy, function(fn) {\n            const args = Array.prototype.slice.call(arguments, 1);\n            fn.apply(this, args);\n\n            _.each(this.enhancedNodes, function($node: any) {\n                $node.remove();\n            });\n        });\n    },\n\n    setLinkRel: function(rel, link, $head) {\n        link &&\n            jQuery('<link />', {\n                rel: rel,\n                href: link\n            }).appendTo($head);\n    }\n});\n\nexport = AdapterEnhanced;\n"]}
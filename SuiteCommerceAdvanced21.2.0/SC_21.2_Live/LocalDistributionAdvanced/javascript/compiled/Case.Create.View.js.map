{"version":3,"sources":["Case.Create.View.ts"],"names":[],"mappings":"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","file":"Case.Create.View.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"Case.Create.View\"/>\n// @Typescript-full\n\nimport * as case_new_tpl from 'case_new.tpl';\nimport { CaseModel } from './Case.Model';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport { CaseFieldsModel } from './Case.Fields.Model';\nimport { AjaxRequestsKiller } from '../../../Commons/AjaxRequestsKiller/JavaScript/AjaxRequestsKiller';\nimport { PageTypeFormView } from '../../../Commons/Core/JavaScript/PageTypeFormView';\nimport { BreadCrumbPage, PageTypeViewOptions } from '../../../Commons/Core/JavaScript/PageTypeView';\nimport { EventsHash } from '../../../Commons/Core/JavaScript/View';\nimport { InferModelServiceContract } from '../../../Commons/Core/JavaScript/backbone/backbone';\nimport { FormFieldsError, FormFieldValue } from '../../../Commons/Core/JavaScript/FormView';\nimport { Errors } from '../../../Commons/Core/JavaScript/Error';\nimport { Case, CaseFieldText } from '../../../ServiceContract/SC/Case/Case';\nimport { ProfileModel } from '../../../Commons/Profile/JavaScript/Profile.Model';\nimport * as Backbone from '../../../Commons/Core/JavaScript/backbone/BackboneExtras';\nimport { Environment } from '../../../Commons/Core/JavaScript/Environment';\n\ninterface CaseCreateViewContext {\n    pageHeader: string;\n    categories: CaseFieldText[];\n    showBackToAccount: boolean;\n}\n\nexport class CaseCreateView extends PageTypeFormView<CaseModel, CaseCreateViewContext> {\n    protected template = case_new_tpl;\n\n    protected title = Utils.translate('How can we help you?');\n\n    protected pageHeader = Utils.translate('How can we help you?');\n    private readonly fields: CaseFieldsModel;\n    private user: ProfileModel;\n    protected newCaseId: string;\n    protected newCaseMessage: string;\n    public attributes = {\n        id: 'NewCase',\n        class: 'newCase'\n    };\n\n    public constructor(options: PageTypeViewOptions) {\n        super(options, new CaseModel());\n        this.fields = new CaseFieldsModel();\n        this.user = ProfileModel.getInstance();\n        this.formModel.set('isNewCase', true);\n        this.newCaseId = '';\n        this.newCaseMessage = '';\n    }\n\n    protected getEvents(): EventsHash {\n        return {\n            'submit form': 'saveForm',\n            'click [data-action=\"include_email\"]': 'includeAnotherEmail',\n            'keypress [data-action=\"text\"]': 'preventEnter',\n            'blur [name=\"title\"]': 'onFormFieldChange',\n            'blur [name=\"category\"]': 'onFormFieldChange',\n            'blur [name=\"message\"]': 'onFormFieldChange',\n            'blur [name=\"email\"]': 'onFormFieldChange'\n        };\n    }\n\n    public beforeShowContent<CaseFields>(): Promise<CaseFields> {\n        return this.fields.fetch({\n            killerId: AjaxRequestsKiller.getKillerId()\n        });\n    }\n\n    protected getFormValues(\n        $savingForm: JQuery<HTMLElement>\n    ): Partial<Case> | FormFieldsError<Case> {\n        const formValues = $savingForm.serializeObject();\n        let title = '';\n        let category = '';\n        let message = '';\n        let email = '';\n        let includeEmail = false;\n        const errorsResult: FormFieldsError<Case> = {\n            errorCode: Errors.FormValidation,\n            errors: {}\n        };\n        if ('title' in formValues && typeof formValues.title === 'string' && formValues.title) {\n            title = formValues.title;\n        } else {\n            errorsResult.errors.title = Utils.translate('Subject is required');\n        }\n        if (\n            'category' in formValues &&\n            typeof formValues.category === 'string' &&\n            formValues.category\n        ) {\n            category = formValues.category;\n        }\n        if (\n            'message' in formValues &&\n            typeof formValues.message === 'string' &&\n            formValues.message\n        ) {\n            message = formValues.message;\n        } else {\n            errorsResult.errors.message = Utils.translate('message is required');\n        }\n        if (\n            'include_email' in formValues &&\n            typeof formValues.include_email === 'string' &&\n            formValues.include_email === 'on'\n        ) {\n            includeEmail = true;\n            if ('email' in formValues && typeof formValues.email === 'string' && formValues.email) {\n                email = formValues.email;\n            } else {\n                errorsResult.errors.email = Utils.translate('Please provide a valid email');\n            }\n        }\n        if (title && category && message) {\n            const result: Partial<Case> = {\n                title,\n                category,\n                message\n            };\n            if (includeEmail) {\n                result.email = email;\n            }\n            return result;\n        }\n        return errorsResult;\n    }\n\n    protected saveForm(\n        event: JQuery.TriggeredEvent\n    ): JQuery.jqXHR<InferModelServiceContract<CaseModel>> | false {\n        const saveForm = super.saveForm(event);\n        if (saveForm) {\n            saveForm.then(\n                (): void => {\n                    this.showSuccess();\n                }\n            );\n        }\n        return saveForm;\n    }\n\n    protected getFormFieldValue(changedInput: JQuery<HTMLElement>): FormFieldValue<Case> {\n        const newVal = changedInput.val();\n        const fieldName = changedInput.attr('name');\n        if (fieldName === 'title' && typeof newVal === 'string') {\n            return {\n                name: fieldName,\n                value: newVal\n            };\n        }\n        if (fieldName === 'email' && typeof newVal === 'string') {\n            return {\n                name: fieldName,\n                value: newVal\n            };\n        }\n        if (fieldName === 'message' && typeof newVal === 'string') {\n            return {\n                name: fieldName,\n                value: newVal\n            };\n        }\n        if (fieldName === 'category' && typeof newVal === 'string') {\n            return {\n                name: fieldName,\n                value: newVal\n            };\n        }\n\n        return {\n            name: fieldName || '',\n            error: Utils.translate(`Please provide a valid ${fieldName}`)\n        };\n    }\n\n    private preventEnter(event: JQuery.TriggeredEvent): void {\n        if (event.key === 'Enter') {\n            event.preventDefault();\n        }\n    }\n\n    private showSuccess(): void {\n        const caseLinkName = Utils.translate(\n            'support case #$(0)',\n            this.formModel.get('caseNumber')\n        );\n        const newCaseInternalId = `${this.formModel.get('internalid')}`;\n        const newCaseMessage = Utils.translate(\n            'Good! your <a href=\"/cases/$(0)\">$(1)</a> was submitted. We will contact you briefly.',\n            newCaseInternalId,\n            caseLinkName\n        );\n\n        this.newCaseId = newCaseInternalId;\n        this.newCaseMessage = newCaseMessage;\n\n        Backbone.history.navigate('cases', { trigger: true });\n    }\n\n    protected getSelectedMenu(): string {\n        return 'newcase';\n    }\n\n    public getBreadcrumbPages = (): BreadCrumbPage[] => {\n        return [\n            {\n                text: this.title,\n                href: '/newcase'\n            }\n        ];\n    };\n\n    private showError(message, type?, closable?, disableElements?) {\n        const Application = Environment.getApplication();\n        const layout = Application.getLayout();\n        layout.showError(message, type, closable, disableElements);\n    }\n\n    private includeAnotherEmail(): void {\n        const emailInput = this.$('[data-case-email]');\n        const status = emailInput.prop('disabled');\n\n        emailInput.prop('disabled', !status);\n\n        this.$el.find('[data-collapse-content]').collapse(status ? 'show' : 'hide');\n    }\n\n    public getContext(): CaseCreateViewContext {\n        return {\n            pageHeader: this.pageHeader,\n            categories: this.fields.get('categories'),\n            showBackToAccount:\n                this.options.application.getConfig().siteSettings.sitetype === 'STANDARD'\n        };\n    }\n}\n"]}
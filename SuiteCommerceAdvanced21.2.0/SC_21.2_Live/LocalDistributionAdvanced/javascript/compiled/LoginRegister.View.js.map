{"version":3,"sources":["LoginRegister.View.ts"],"names":[],"mappings":"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","file":"LoginRegister.View.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"LoginRegister.View\"/>\n/// <reference path=\"../../../Commons/Utilities/JavaScript/UnderscoreExtended.d.ts\" />\n/// <reference path=\"../../../Commons/Utilities/JavaScript/GlobalDeclarations.d.ts\" />\n\nimport * as _ from 'underscore';\nimport * as login_register_tpl from 'login_register.tpl';\nimport * as notifications_tpl from 'notifications.tpl';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\nimport { Configuration } from '../../SCA/JavaScript/Configuration';\nimport { FooterSimplifiedView } from '../../Footer/JavaScript/Footer.Simplified.View';\nimport { GlobalViewsMessageView } from '../../../Commons/GlobalViews/JavaScript/GlobalViews.Message.View';\nimport { ProfileModel } from '../../../Commons/Profile/JavaScript/Profile.Model';\n\nimport LoginView = require('./LoginRegister.Login.View');\nimport RegisterView = require('./LoginRegister.Register.View');\nimport CheckoutAsGuestView = require('./LoginRegister.CheckoutAsGuest.View');\nimport HeaderSimplifiedView = require('../../Header/JavaScript/Header.Simplified.View');\nimport Tracker = require('../../../Commons/Tracker/JavaScript/Tracker');\nimport Backbone = require('../../../Commons/Utilities/JavaScript/backbone.custom');\nimport BackboneView = require('../../../Commons/BackboneExtras/JavaScript/Backbone.View');\n\n// @class LoginRegister.View This class shows both the Login\n// form and the Register at the same time. @extends BackboneView\nconst LoginRegisterView: any = BackboneView.extend({\n    template: login_register_tpl,\n\n    enhancedEcommercePage: true,\n\n    attributes: {\n        id: 'LoginRegister.View',\n        'data-root-component-id': 'LoginRegister.View'\n    },\n\n    title: Utils.translate('Log in | Register'),\n\n    events: {\n        // login error message could contain link to registration page\n        'click .alert-error a': 'handleErrorLink'\n    },\n\n    beforeShowContent: function beforeShowContent() {\n        const promise = jQuery.Deferred();\n        const profileModel = ProfileModel.getInstance();\n\n        if (profileModel.get('isLoggedIn') === 'T' && profileModel.get('isGuest') === 'F') {\n            Backbone.history.navigate('', { trigger: true });\n\n            promise.reject();\n        } else {\n            promise.resolve();\n        }\n\n        return promise;\n    },\n\n    initialize: function(options) {\n        const { application } = options;\n        // To distinguish between when the login is called from the Register header link or the Proceed to Checkout link, we use the origin URL param (is_checking_out)\n        // origin=checkout when the checkout link is clicked so we show the guest checkout button.\n        const parameters = Utils.parseUrlOptions(location.search);\n        const is_checking_out =\n            (parameters && parameters.is === 'checkout') ||\n            (parameters && parameters.origin === 'checkout') ||\n            false;\n        const profile_model = ProfileModel.getInstance();\n\n        this.child_view_options = {\n            application: application,\n            parentView: this,\n            timedout: options.timedout\n        };\n\n        this.pageTitle = Utils.translate('Log in');\n\n        this.enableLogin = Configuration.getRegistrationType() !== 'disabled';\n\n        this.enableRegister =\n            Configuration.getRegistrationType() === 'optional' ||\n            Configuration.getRegistrationType() === 'required';\n\n        // we only show the CheckoutAsGuest button in 'checkout' touchpoint. Never in login/register touchpoints.\n        this.enableCheckoutAsGuest =\n            is_checking_out &&\n            profile_model.get('isLoggedIn') === 'F' &&\n            (Configuration.getRegistrationType() === 'optional' ||\n                Configuration.getRegistrationType() === 'disabled');\n\n        if (!notifications_tpl) {\n            if (SC.ENVIRONMENT.email_verification_error) {\n                this.message = {\n                    text: Utils.translate(\n                        'The validation process has failed. Please login into your account and click on the validation link again.'\n                    ),\n                    type: 'error'\n                };\n                delete SC.ENVIRONMENT.email_verification_error;\n            } else if (SC.ENVIRONMENT.password_reset_invalid_error) {\n                this.message = {\n                    text: Utils.translate(\n                        'Your reset password link is invalid. Request a new one using the Forgot Password link.'\n                    ),\n                    type: 'error'\n                };\n                delete SC.ENVIRONMENT.password_reset_invalid_error;\n            } else if (SC.ENVIRONMENT.password_reset_expired_error) {\n                this.message = {\n                    text: Utils.translate(\n                        'Your reset password link has expired. Request a new one using the Forgot Password link.'\n                    ),\n                    type: 'error'\n                };\n                delete SC.ENVIRONMENT.password_reset_expired_error;\n            } else if (SC.ENVIRONMENT.reset_password_confirmation_email) {\n                this.message = {\n                    text: Utils.translate(\n                        'Please check your email and get instructions on how to reset your password.'\n                    ),\n                    type: 'success'\n                };\n                delete SC.ENVIRONMENT.reset_password_confirmation_email;\n            } else if (SC.ENVIRONMENT.updated_password_confirmation) {\n                this.message = {\n                    text: Utils.translate('Your password has been reset.'),\n                    type: 'success'\n                };\n                delete SC.ENVIRONMENT.updated_password_confirmation;\n            }\n        }\n\n        this.on('afterViewRender', this.trackStep, this);\n    },\n\n    trackStep: function() {\n        Tracker.getInstance().trackPageviewForCheckoutStep(1);\n    },\n\n    // @method handleErrorLink workaround to native netsuite error links. In particular if error contains a link to the register touch-point we want to show the registration form without navigate.\n    // @return {Void}\n    handleErrorLink: function(e) {\n        // if the link contains the register touch-point\n        if (~e.target.href.indexOf(Configuration.get('siteSettings.touchpoints.register'))) {\n            e.preventDefault();\n            this.showRegistrationForm();\n\n            this.childViewInstances.Login.hideError();\n        }\n    },\n\n    // @method disableButtons\n    // @param {Boolean} state\n    // @return {LoginRegsiter.View} Current instance of the view\n    disableButtons: function(state: boolean) {\n        this.getChildViewInstance('Login')\n            .$('a, input, button')\n            .prop('disabled', state);\n        if (this.getChildViewInstance('CheckoutAsGuest')) {\n            this.getChildViewInstance('CheckoutAsGuest')\n                .$('a, input, button')\n                .prop('disabled', state);\n        }\n        this.getChildViewInstance('Register')\n            .$('a, input, button')\n            .prop('disabled', state);\n\n        return this;\n    },\n\n    // @method showRegistrationForm  make sure the registration form is in the front\n    showRegistrationForm: function() {\n        // show the form\n        this.$('[data-view=\"Register\"]').addClass('in');\n        // hide the container of the link to show it\n        this.$('[data-view=\"CheckoutAsGuest\"]').removeClass('in');\n    },\n\n    getHeaderView: function() {\n        // We've got to disable passwordProtectedSite feature if customer registration is disabled.\n        if (\n            Configuration.getRegistrationType() !== 'disabled' &&\n            SC.ENVIRONMENT.siteSettings.siteloginrequired === 'T'\n        ) {\n            return HeaderSimplifiedView;\n        }\n    },\n\n    getFooterView: function() {\n        // We've got to disable passwordProtectedSite feature if customer registration is disabled.\n        if (\n            Configuration.getRegistrationType() !== 'disabled' &&\n            SC.ENVIRONMENT.siteSettings.siteloginrequired === 'T'\n        ) {\n            return FooterSimplifiedView;\n        }\n    },\n\n    childViews: {\n        Login: function() {\n            return new LoginView(this.child_view_options);\n        },\n        CheckoutAsGuest: function() {\n            return new CheckoutAsGuestView(\n                _.extend({ hideRegister: !this.enableRegister }, this.child_view_options)\n            );\n        },\n        Register: function() {\n            return new RegisterView(this.child_view_options);\n        },\n        Messages: function() {\n            if (this.message) {\n                return new GlobalViewsMessageView({\n                    message: this.message.text,\n                    type: this.message.type || 'error',\n                    closable: true\n                });\n            }\n        }\n    },\n\n    // @method getContext\n    // @return {LoginRegister.View.Context}\n    getContext: function() {\n        // @class LoginRegister.View.Context\n        return {\n            // @property {Boolean} showRegister\n            showRegister: this.enableRegister,\n            // @property {Boolean} showCheckoutAsGuest\n            showCheckoutAsGuest: this.enableCheckoutAsGuest,\n            // @property {Boolean} showLogin\n            showLogin: this.enableLogin,\n            // @property {Boolean} showRegisterOrGuest\n            showRegisterOrGuest: this.enableRegister || this.enableCheckoutAsGuest\n        };\n    }\n});\n\nexport = LoginRegisterView;\n"]}
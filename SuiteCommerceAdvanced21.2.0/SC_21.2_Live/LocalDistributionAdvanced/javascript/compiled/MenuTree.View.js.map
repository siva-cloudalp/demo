{"version":3,"sources":["MenuTree.View.ts"],"names":[],"mappings":"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","file":"MenuTree.View.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"MenuTree.View\"/>\n\nimport * as _ from 'underscore';\nimport * as menu_tree_tpl from 'menu_tree.tpl';\nimport { Menu, MyAccountMenu } from '../../../Advanced/Header/JavaScript/MyAccountMenu';\nimport * as jQuery from '../../Core/JavaScript/jQuery';\n\nimport BackboneCollectionView = require('../../Backbone.CollectionView/JavaScript/Backbone.CollectionView');\nimport MenuTreeNodeView = require('./MenuTree.Node.View');\nimport Singleton = require('../../Main/JavaScript/Singleton');\nimport BackboneView = require('../../BackboneExtras/JavaScript/Backbone.View');\n\n// @class MenuTree.View Implements the tree menu items that is\n// present in MyAccount. It's a Singleton. @extends Backbone.View\nexport = BackboneView.extend(\n    {\n        // @property {Function} template\n        template: menu_tree_tpl,\n\n        events: {\n            'click [data-action=\"expander\"]': 'menuClick'\n        },\n\n        render: function(...args) {\n            this.fixedMenuItems = this.backwardCompatibilitySanitize(\n                MyAccountMenu.getInstance().getEntries()\n            );\n            BackboneView.prototype.render.apply(this, args);\n        },\n\n        backwardCompatibilitySanitize: function(menu: Menu[]) {\n            const entries = [];\n            _.each(menu, entry => {\n                const newSubEntries = [];\n                _.each(entry.children, subEntry => {\n                    const { entryId, ...rest } = subEntry;\n                    newSubEntries.push({ ...rest, children: [] });\n                });\n                entries.push({ ...entry, children: newSubEntries });\n            });\n            return entries;\n        },\n\n        // @method menuClick Note: cant use bootstrap collapse due to the divs\n        // introduced by collection view. @param {HTMLEvent} e\n        menuClick: function(e, synthetic) {\n            const target = jQuery(e.currentTarget);\n            const this_expander = target.next('[data-type=\"menu-tree-node-expander\"]');\n            const this_expander_is_opened = this_expander.hasClass('in');\n            const this_expandable = target.closest('[data-type=\"menu-tree-node-expandable\"]');\n            const all_expandables = this.$('[data-type=\"menu-tree-node-expandable\"]');\n\n            all_expandables.removeClass('open');\n            this_expandable.addClass('open');\n\n            // if inside a closed expander: close others open this one\n            const expanding_expander = this.$(target.data('target'));\n            if (!this_expander_is_opened) {\n                const open_expanders = this.$('[data-type=\"menu-tree-node-expander\"].in');\n\n                (<any>jQuery.fn).collapse.call(open_expanders, 'hide');\n                (<any>jQuery.fn).collapse.call(expanding_expander, 'show');\n            }\n\n            if (synthetic === undefined && this_expander_is_opened) {\n                (<any>jQuery.fn).collapse.call(expanding_expander, 'hide');\n                this_expandable.removeClass('open');\n            }\n        },\n\n        // @method updateSidebar @param {String} label\n        updateSidebar: function(label) {\n            this.currentLabel = label || this.currentLabel;\n\n            const target = this.$('[data-id=\"' + this.currentLabel + '\"]');\n            const target_expandable = target.closest('[data-type=\"menu-tree-node-expandable\"]');\n            const anchors = this.$('[data-id]');\n\n            // remove active for all anchors and add for this one\n            anchors.removeClass('active');\n            target.addClass('active');\n\n            // triggers click for the correct expander\n            target_expandable\n                .find('[data-action=\"expander\"]:first')\n                .trigger('click', { synthetic: true });\n\n            // edge case for home, should close other expanders\n            if (label === 'home') {\n                const all_expandables = this.$('[data-type=\"menu-tree-node-expandable\"]');\n                const open_expanders = this.$('[data-type=\"menu-tree-node-expander\"].in');\n\n                all_expandables.removeClass('open');\n                (<any>jQuery.fn).collapse.call(open_expanders, 'hide');\n            }\n        },\n\n        // @method updateMenuItemsUI re-render the menu items menu - useful for dynamic menu items\n        // that need to re-render when something changes. Each module is responsible of calling\n        // this method when appropiate.\n        updateMenuItemsUI: function() {\n            this.render();\n            this.updateSidebar();\n        },\n\n        // @method getContext @returns MenuTree.View.Context\n        getContext: function() {\n            // @class MenuTree.View.Context\n            return {\n                // @propery {Array} menuItems\n                menuItems: this.fixedMenuItems\n            };\n            // @class MenuTree.View\n        },\n\n        childViews: {\n            'MenuItems.Collection': function() {\n                return new BackboneCollectionView({\n                    collection: this.fixedMenuItems,\n                    childView: MenuTreeNodeView,\n                    viewsPerRow: 1,\n                    childViewOptions: {\n                        level: 1\n                    }\n                });\n            }\n        }\n    },\n    Singleton\n);\n"]}
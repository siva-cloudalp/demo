{"version":3,"sources":["PaymentWizard.EditAmount.View.ts"],"names":[],"mappings":"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","file":"PaymentWizard.EditAmount.View.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"PaymentWizard.EditAmount.View\"/>\n\nimport * as _ from 'underscore';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\n\nimport * as payment_wizard_edit_amount_layout_tpl from 'payment_wizard_edit_amount_layout.tpl';\n\nimport BackboneView = require('../../../Commons/BackboneExtras/JavaScript/Backbone.View');\nimport BackboneFormView = require('../../../Commons/Backbone.FormView/JavaScript/Backbone.FormView');\nimport Handlebars = require('../../../Commons/Utilities/JavaScript/Handlebars');\n\n// @class OrderWizard.EditDeposit.View @extend BackboneView\nconst PaymentWizardEditAmountView: any = BackboneView.extend({\n    template: payment_wizard_edit_amount_layout_tpl,\n\n    events: {\n        'submit [data-action=\"edit-amount-form\"]': 'modifyAmount',\n        'change [data-action=\"edit-amount\"]': 'changedAmount'\n    },\n\n    bindings: {\n        '[name=\"amount\"]': 'amount'\n    },\n\n    initialize: function(options) {\n        this.parentView = options.parentView;\n        this.model = options.model;\n        this.type = options.type;\n        this.selectedInvoicesLength = options.selectedInvoicesLength;\n        this.invoicesTotal = options.invoicesTotal;\n\n        if (options.model) {\n            this.currency = options.model.currency;\n        }\n\n        this.getInvoiceSymbolCurrency();\n\n        if (this.type === 'invoice') {\n            this.original_amount_attribute = 'total';\n            this.amount_due_attribute = 'due';\n            this.input_label = Utils.translate('Amount to Pay');\n            this.original_amount_label = Utils.translate('Original Amount');\n            this.amount_due_label = Utils.translate('Amount Due');\n            this.page_header = Utils.translate('Invoice #$(0)', this.model.get('tranid'));\n            this.title = Utils.translate(\n                'Amount to pay for invoice #$(0)',\n                this.model.get('tranid')\n            );\n        } else if (this.type === 'deposit') {\n            this.input_label = Utils.translate('Amount to apply');\n            this.original_amount_label = Utils.translate('Remaining amount');\n            this.original_amount_attribute = 'remaining';\n            this.page_header = Utils.translate('Deposit #$(0)', this.model.get('refnum'));\n            this.title = Utils.translate(\n                'Amount to apply for deposit #$(0)',\n                this.model.get('refnum')\n            );\n        } else if (this.type === 'credit') {\n            this.input_label = Utils.translate('Amount to apply');\n            this.original_amount_attribute = 'remaining';\n            this.original_amount_label = Utils.translate('Remaining amount');\n            this.page_header = Utils.translate(\n                '$(0) #$(1)',\n                this.model.get('type'),\n                this.model.get('refnum')\n            );\n            this.title = Utils.translate(\n                'Amount to apply for credit #$(0)',\n                this.model.get('refnum')\n            );\n        }\n\n        this.page_header = new Handlebars.SafeString(\n            '<b>' + this.page_header.toUpperCase() + '</b>'\n        );\n        this.clonedModel = BackboneFormView.add(this);\n    },\n\n    getInvoiceSymbolCurrency: function() {\n        const currency = Utils.getCurrencyByName(this.currency);\n        if (currency) {\n            this.currencySymbol = currency.symbol;\n        }\n    },\n\n    _getOriginalDiscountAmount: function _getOriginalDiscountAmount() {\n        !this.model.get('original_discamt') &&\n            this.model.set('original_discamt', this.model.get('discamt'));\n\n        return this.model.get('original_discamt');\n    },\n\n    _getOriginalTransactionAmount: function _getOriginalTransactionAmount() {\n        !this.model.get('original_amount') &&\n            this.model.set('original_amount', this.model.get('amount'));\n\n        return this.model.get('original_amount');\n    },\n\n    changedAmount: function changedAmount(e) {\n        const amount_to_pay_str = (<any>jQuery(e.target).val() || '').replace(',', '.');\n        const amount_to_pay = parseFloat(amount_to_pay_str);\n\n        if (this.model.get('discountapplies') && !isNaN(amount_to_pay)) {\n            const original_discount_ammount = this._getOriginalDiscountAmount();\n            const original_amount = this._getOriginalTransactionAmount();\n            const new_discount_amount =\n                (amount_to_pay * original_discount_ammount) / original_amount;\n            const new_discount_amount_formatted = Utils.formatCurrency(\n                new_discount_amount,\n                this.currencySymbol\n            );\n\n            this.model.set('discamt', new_discount_amount);\n            this.model.set('discamt_formatted', new_discount_amount_formatted);\n\n            this.$('[data-type=\"applied-discount-ammount\"]').text(new_discount_amount_formatted);\n            this.$('[data-type=\"specified-payment-ammount\"]').text(\n                Utils.formatCurrency(amount_to_pay, this.currencySymbol)\n            );\n        }\n    },\n\n    modifyAmount: function(e) {\n        const { model } = this;\n        const original_amount = model.get('amount');\n        let new_amount = parseFloat(this.$('[data-action=\"edit-amount\"]').val());\n        const wizard_model = this.parentView.wizard.model;\n        const original_total = model.get('orderTotal') || wizard_model.calculeTotal(true);\n\n        e.preventDefault();\n\n        if (model.get('discountapplies') && new_amount === model.get('due')) {\n            new_amount = model.get('duewithdiscount');\n        }\n\n        model.set('amount', new_amount).set('orderTotal', wizard_model.calculeTotal(true));\n\n        this.clonedModel.validate();\n\n        if (this.clonedModel.isValid()) {\n            model.set('amount_formatted', Utils.formatCurrency(new_amount, this.currencySymbol));\n\n            if (this.type === 'invoice') {\n                wizard_model.distributeCredits();\n            } else {\n                wizard_model.calculeTotal();\n            }\n\n            this.$containerModal &&\n                this.$containerModal\n                    .removeClass('fade')\n                    .modal('hide')\n                    .data('bs.modal', null);\n            this.destroy();\n        } else {\n            model.set({\n                amount: original_amount,\n                orderTotal: original_total\n            });\n        }\n    },\n\n    // @method getContext @return {OrderWizard.EditDeposit.View.Context}\n    getContext: function() {\n        // @class OrderWizard.EditDeposit.View.Context\n        return {\n            // @property {String} originalAmountLabel\n            originalAmountLabel: this.original_amount_label,\n            // @property {String} originalAmountFormatted\n            originalAmountFormatted: this.model.get(this.original_amount_attribute + '_formatted'),\n            // @property {Boolean} showAmountDue\n            showAmountDue: !!this.amount_due_label,\n            // @property {String} amountDueLabel\n            amountDueLabel: this.amount_due_label,\n            // @property {String} amountDueFormatted\n            amountDueFormatted: this.model.get(this.amount_due_attribute + '_formatted'),\n            // @property {Boolean} showSelectedInvoicesLength\n            showSelectedInvoicesLength: !!this.selectedInvoicesLength,\n            // @property {Number} selectedInvoicesLength\n            selectedInvoicesLength: this.selectedInvoicesLength,\n            // @property {String} invoiceTotalFormatted\n            invoiceTotalFormatted: Utils.formatCurrency(this.invoicesTotal, this.currencySymbol),\n            // @property {String} inputLabel\n            inputLabel: this.input_label,\n            // @property {Number} inputValue\n            inputValue:\n                this.model.get('discountapplies') && this.model.isPayFull()\n                    ? this.model.get('due')\n                    : this.model.get('amount'),\n            // @property {String} currencySymbol\n            currencySymbol: this.currencySymbol,\n            // @property {Boolean} showDiscountApplied\n            showDiscountApplied: !!this.model.get('discountapplies'),\n            // @property {String} discountFormatted\n            discountFormatted: this.model.get('discount_formatted'),\n            // @property {String} discountAmountFormatted\n            discountAmountFormatted: this.model.get('discamt_formatted'),\n            // @property {String} dueWithDiscountFormatted\n            dueWithDiscountFormatted: this.model.get('duewithdiscount_formatted')\n        };\n    }\n});\n\nexport = PaymentWizardEditAmountView;\n"]}
{"version":3,"sources":["Facets.Router.ts"],"names":[],"mappings":"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","file":"Facets.Router.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"Facets.Router\"/>\n\nimport * as _ from 'underscore';\nimport * as Utils from '../../Utilities/JavaScript/Utils';\nimport { Configuration } from '../../Utilities/JavaScript/Configuration';\n\nimport BrowseView = require('./Facets.Browse.View');\n\n// @class Facets.Router Mixes the Translator, Model and View\nconst FacetsRouter: any = function(application) {\n    this.application = application;\n    this.translatorConfig = application.translatorConfig;\n\n    const pageType = this.application.getComponent('PageType');\n\n    pageType.registerPageType({\n        name: 'facet-browse',\n        defaultTemplate: {\n            name: 'facets_facet_browse.tpl',\n            displayName: 'Facets Default',\n            thumbnail: Utils.getThemeAbsoluteUrlOfNonManagedResources(\n                'img/default-layout-facet-browse.png'\n            )\n        }\n    });\n\n    BrowseView.router = this;\n};\n\nFacetsRouter.prototype.addUrl = function(urls, functionToCall) {\n    if (urls.length) {\n        urls = _.map(urls, function(url: any) {\n            return url.replace(/^\\//, '');\n        });\n        const rootRegex = '^\\\\b(' + urls.join('|') + ')\\\\b$';\n        const regex =\n            '^\\\\b(' +\n            urls.join('|') +\n            ')\\\\b[\\\\' +\n            Configuration.get('facetDelimiters.betweenFacetNameAndValue') +\n            '\\\\?].*$';\n\n        const pageType = this.application.getComponent('PageType');\n\n        pageType.registerPageType({\n            name: 'facet-browse',\n            routes: [new RegExp(rootRegex), new RegExp(regex)],\n            view: BrowseView\n        });\n    }\n};\n\n// @method getFacetsAliasesMapping @param {Array<Object>} corrections\nFacetsRouter.prototype.getFacetsAliasesMapping = function(corrections) {\n    const facets_aliases_mapping = {};\n\n    _.each(corrections, function(correction: any) {\n        facets_aliases_mapping[correction.usedAlias] = {\n            url: correction.url,\n            type: correction.type ? correction.type : ''\n        };\n    });\n\n    return facets_aliases_mapping;\n};\n\nFacetsRouter.prototype.unaliasUrlHelper = function(\n    facet_tokens,\n    facets_aliases_mapping,\n    separator_between_facets,\n    separator_between_facet_name_and_value\n) {\n    let translated_facets = '';\n\n    while (facet_tokens.length > 0) {\n        const facet_name = facet_tokens.shift();\n        const facet_value = facet_tokens.shift();\n\n        if (_.isUndefined(facet_name) || _.isUndefined(facet_value)) {\n            continue;\n        }\n\n        const facet_name_correction = facets_aliases_mapping[facet_name];\n        const facet_value_correction = facets_aliases_mapping[facet_value];\n        // Just double check if unalias is correct... not undefined and unalias type matches with the url component being analyzed!\n        const facet_name_correction_url =\n            facet_name_correction && facet_name_correction.type.toUpperCase() === 'FACET'\n                ? facet_name_correction.url\n                : null;\n        const facet_value_correction_url =\n            facet_value_correction && facet_value_correction.type.toUpperCase() === 'FACET_VALUE'\n                ? facet_value_correction.url\n                : null;\n\n        if (facet_name_correction_url && facet_value_correction_url) {\n            translated_facets +=\n                facet_name_correction_url +\n                separator_between_facet_name_and_value +\n                facet_value_correction_url;\n        } else if (facet_name_correction_url && !facet_value_correction_url) {\n            translated_facets +=\n                facet_name_correction_url + separator_between_facet_name_and_value + facet_value;\n        } else if (!facet_name_correction_url && facet_value_correction_url) {\n            translated_facets +=\n                facet_name + separator_between_facet_name_and_value + facet_value_correction_url;\n        } else {\n            translated_facets += facet_name + separator_between_facet_name_and_value + facet_value;\n        }\n\n        if (facet_tokens.length > 0) {\n            translated_facets += separator_between_facets;\n        }\n    }\n\n    return translated_facets;\n};\n\n// @method unaliasUrl @param {String} aliased_url @param {Array<Object>} corrections\nFacetsRouter.prototype.unaliasUrl = function(aliased_url, corrections) {\n    if (aliased_url.indexOf('http://') === 0 || aliased_url.indexOf('https://') === 0) {\n        throw new Error('URL must be relative');\n    }\n\n    aliased_url = aliased_url[0] === '/' ? aliased_url.substr(1) : aliased_url;\n\n    const facet_delimiters = this.translatorConfig.facetDelimiters;\n    const facets_n_options = aliased_url.split(facet_delimiters.betweenFacetsAndOptions);\n    const facets =\n        facets_n_options[0] && facets_n_options[0] !== this.translatorConfig.fallbackUrl\n            ? facets_n_options[0]\n            : '';\n    const options = facets_n_options[1] || '';\n    const facet_tokens = facets.split(\n        new RegExp(\n            '[\\\\' +\n                facet_delimiters.betweenDifferentFacets +\n                '\\\\' +\n                facet_delimiters.betweenFacetNameAndValue +\n                ']+',\n            'ig'\n        )\n    );\n    const facets_aliases_mapping = this.getFacetsAliasesMapping(corrections);\n    let unaliased_url = this.unaliasUrlHelper(\n        facet_tokens,\n        facets_aliases_mapping,\n        facet_delimiters.betweenDifferentFacets,\n        facet_delimiters.betweenFacetNameAndValue\n    );\n\n    if (options) {\n        const option_tokens = [];\n\n        options.replace(\n            new RegExp(\n                '([^' +\n                    facet_delimiters.betweenFacetsAndOptions +\n                    facet_delimiters.betweenOptionNameAndValue +\n                    facet_delimiters.betweenDifferentOptions +\n                    ']+)(' +\n                    facet_delimiters.betweenOptionNameAndValue +\n                    '([^' +\n                    facet_delimiters.betweenDifferentOptions +\n                    ']*))?',\n                'ig'\n            ),\n            function($0, $1, $2, $3) {\n                option_tokens.push($1);\n                option_tokens.push($3);\n            }\n        );\n\n        const unaliased_options = this.unaliasUrlHelper(\n            option_tokens,\n            facets_aliases_mapping,\n            facet_delimiters.betweenDifferentOptions,\n            facet_delimiters.betweenOptionNameAndValue\n        );\n\n        unaliased_url = unaliased_url !== '' ? unaliased_url : this.translatorConfig.fallbackUrl;\n        unaliased_url += facet_delimiters.betweenFacetsAndOptions + unaliased_options;\n    }\n\n    return unaliased_url;\n};\n\nexport = FacetsRouter;\n"]}
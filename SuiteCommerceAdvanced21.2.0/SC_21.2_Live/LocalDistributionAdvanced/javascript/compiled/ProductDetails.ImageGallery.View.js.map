{"version":3,"sources":["ProductDetails.ImageGallery.View.ts"],"names":[],"mappings":"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","file":"ProductDetails.ImageGallery.View.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"ProductDetails.ImageGallery.View\"/>\n\nimport * as _ from 'underscore';\nimport '../../../Commons/Utilities/JavaScript/zoom';\nimport '../../../Commons/Utilities/JavaScript/jQuery.bxslider.custom';\nimport * as product_details_image_gallery_tpl from 'product_details_image_gallery.tpl';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\n\nimport resizeImage = require('../../../Commons/Utilities/JavaScript/Utilities.ResizeImage');\nimport SocialSharingFlyoutHoverView = require('../../SocialSharing/JavaScript/SocialSharing.Flyout.Hover.View');\nimport BackboneView = require('../../../Commons/BackboneExtras/JavaScript/Backbone.View');\n\n// @class ProductDetails.ImageGallery.View @extends Backbone.View\nconst ProductDetailsImageGalleryView: any = BackboneView.extend({\n    template: product_details_image_gallery_tpl,\n\n    initialize: function initialize() {\n        BackboneView.prototype.initialize.apply(this, arguments);\n\n        this.application = this.options.application;\n\n        this.images = this.model.getImages();\n\n        this.model.on(\n            'change',\n            function() {\n                const modelImages = this.model.getImages();\n                const forceInitSlider = true;\n                if (!_.isEqual(this.images, modelImages)) {\n                    this.images = modelImages;\n                    this.render();\n                    this.initSliderZoom(forceInitSlider);\n                }\n            },\n            this\n        );\n        this.isZoomEnabled = SC.CONFIGURATION.isZoomEnabled;\n        this.application.getLayout().on('afterAppendView', this.initSliderZoom, this);\n    },\n\n    initSliderZoom: function initSliderZoom(forceInit) {\n        if (this.isZoomEnabled) {\n            this.initZoom();\n        }\n        this.initSlider(forceInit);\n    },\n\n    // @method destroy\n    // @returns {Void}\n    destroy: function destroy() {\n        this.model.off('change', this.render, this);\n        this.application.getLayout().off('afterAppendView', this.initSliderZoom, this);\n        this._destroy();\n    },\n\n    // @method initSlider Initialize the bxSlider\n    // @return {Void}\n    initSlider: function initSlider(forceInit) {\n        if (this.images.length > 1 && (!this.$slider || forceInit === true)) {\n            this.$slider = Utils.initBxSlider(this.$('[data-slider]'), {\n                buildPager: _.bind(this.buildSliderPager, this),\n                startSlide: 0,\n                adaptiveHeight: true,\n                touchEnabled: true,\n                nextText:\n                    '<a class=\"product-details-image-gallery-next-icon\" data-action=\"next-image\"></a>',\n                prevText:\n                    '<a class=\"product-details-image-gallery-prev-icon\" data-action=\"prev-image\"></a>',\n                controls: true\n            });\n\n            this.$('[data-action=\"next-image\"]').off();\n            this.$('[data-action=\"prev-image\"]').off();\n\n            this.$('[data-action=\"next-image\"]').click(_.bind(this.nextImageEventHandler, this));\n            this.$('[data-action=\"prev-image\"]').click(\n                _.bind(this.previousImageEventHandler, this)\n            );\n        }\n    },\n\n    // @method previousImageEventHandler Handle the clicking over the previous button to show the previous main image. It does it by triggering a cancelable event.\n    // @return {Void}\n    previousImageEventHandler: function previousImageEventHandler() {\n        const self = this;\n        const current_index = self.$slider.getCurrentSlide();\n        const next_index =\n            current_index === 0 ? self.$slider.getSlideCount() - 1 : current_index - 1;\n\n        // IMPORTANT This event is used to notify the ProductDetails.Component that the images have changed\n        // @event {ProductDetails.ImageGallery.ChangeEvent} 'afterChangeImage\n        self.model\n            .cancelableTrigger('beforeChangeImage', {\n                currentIndex: current_index,\n                nextIndex: next_index\n            })\n            .then(function() {\n                self.$slider.goToPrevSlide();\n                self.model.cancelableTrigger('afterChangeImage', next_index);\n            });\n    },\n\n    // @method nextImageEventHandler Handle the clicking over the next button to show the next main image. It does it by triggering a cancelable event\n    // @return {Void}\n    nextImageEventHandler: function nextImageEventHandler() {\n        const self = this;\n        const current_index = self.$slider.getCurrentSlide();\n        const next_index =\n            current_index === self.$slider.getSlideCount() - 1 ? 0 : current_index + 1;\n\n        // IMPORTANT This event is used to notify the ProductDetails.Component that the images have changed\n        // @event {ProductDetails.ImageGallery.ChangeEvent} beforeChangeImage\n        self.model\n            .cancelableTrigger(\n                'beforeChangeImage',\n                // @class ProductDetails.ImageGallery.ChangeEvent Image change event information container\n                {\n                    // @property {Number} currentIndex\n                    currentIndex: current_index,\n                    // @property {Number} nextIndex\n                    nextIndex: next_index\n                }\n                // @class ProductDetails.ImageGallery.View\n            )\n            .then(function() {\n                self.$slider.goToNextSlide();\n                self.model.cancelableTrigger('afterChangeImage', next_index);\n            });\n    },\n\n    // @property {ChildViews} childViews\n    childViews: {\n        'SocialSharing.Flyout.Hover': function() {\n            return new SocialSharingFlyoutHoverView({});\n        }\n    },\n\n    // @method initZoom If this.$Slider exists, the zoom script is already applied,\n    // but it needs to be reapplied as the images in the slider may change due to product characteristics such as color.\n    // @return {Void}\n    initZoom: function() {\n        const self = this;\n        if (!SC.ENVIRONMENT.isTouchEnabled) {\n            const { images } = this;\n            this.$('[data-zoom]:not(.bx-clone)').each(function(slide_index) {\n                self.$(this).zoom(resizeImage(images[slide_index].url, 'zoom'), slide_index);\n            });\n        }\n    },\n\n    // @method buildSliderPager\n    // @param {Number} slide_index\n    // @return {String}\n    buildSliderPager: function(slide_index) {\n        const image = this.images[slide_index];\n        if (image) {\n            return (\n                '<img src=\"' +\n                resizeImage(image.url, 'tinythumb') +\n                '\" alt=\"' +\n                image.altimagetext +\n                '\">'\n            );\n        }\n    },\n\n    // @method getContext\n    // @returns {ProductDetails.ImageGallery.View.Context}\n    getContext: function() {\n        // @class ProductDetails.ImageGallery.View.Context\n        return {\n            // @property {String} imageResizeId\n            imageResizeId: Utils.getViewportWidth() < 768 ? 'thumbnail' : 'main',\n            // @property {Array<ImageContainer>} images\n            images: this.images || [],\n            // @property {ImageContainer} firstImage\n            firstImage: this.images[0] || {},\n            // @property {Boolean} showImages\n            showImages: this.images.length > 0,\n            // @property {Boolean} showImageSlider\n            showImageSlider: this.images.length > 1\n        };\n        // @class ProductDetails.ImageGallery.View\n    }\n});\n\nexport = ProductDetailsImageGalleryView;\n"]}